- #### Use Cloudflare D1 as a backend
    - `npm create cloudflare@latest -- products` # Create a project
    - `npx wrangler d1 create products` # Create a database
    - `vi ~/.config/store/products/wrangler.toml` # Append to end of file
      ```
      [[d1_databases]]
      binding = "DB"
      database_name = "products"
      database_id = "<unique-ID-for-your-database>"
      ```
    - `vi ~/.config/store/products/products.sql` # Configure your D1 database
      ```
      DROP TABLE IF EXISTS products;
      CREATE TABLE IF NOT EXISTS products (
          barcode TEXT PRIMARY KEY,
          name TEXT,
          price TEXT
      );
      INSERT INTO products (barcode, name, price) VALUES
      ('6934567890123','water1','1'),
      ('6934567890124','water2','2'),
      ('6934567890125','water3','3');
      ```
        - `npx wrangler d1 execute products --local --file=./products.sql` # Test locally first
        - `npx wrangler d1 execute products --local --command="SELECT * FROM products"` # Validate your data
    - `vi ~/.config/store/products/src/index.ts` # Configure your Worker
      ```
      export interface Env {
        DB: D1Database;  // The D1 database binding
      }
      
      export default {
        async fetch(request: Request, env: Env): Promise<Response> {
          const url = new URL(request.url);
          const pathname = url.pathname;
          const method = request.method;
      
          if (pathname === "/search_product" && method === "GET") {
            const barcode = url.searchParams.get("barcode");
            const name = url.searchParams.get("name");
      
            // Ensure at least one search parameter is provided
            if (!barcode && !name) {
              return new Response(
                JSON.stringify({ error: "Missing barcode or name" }),
                { status: 400, headers: JSON_HEADERS }
              );
            }
      
            let query = "SELECT barcode, name, price FROM products WHERE ";
            const params: string[] = [];
            try {
              const result = await env.DB.prepare(
                "SELECT barcode, name, price FROM products WHERE barcode = ?"
              ).bind(barcode).first();
      
              if (result) {
                return new Response(
                  JSON.stringify({ barcode: result.barcode, name: result.name, price: result.price }),
                  { headers: { "Content-Type": "application/json" } }
                );
              } else {
                return new Response(
                  JSON.stringify({ error: "Product not found" }),
                  { status: 404, headers: { "Content-Type": "application/json" } }
                );
              }
            } catch (error) {
              return new Response(
                JSON.stringify({ error: "Database error" }),
                { status: 500, headers: { "Content-Type": "application/json" } }
              );
            }
          }

          return new Response(
            "Route not found",
            { status: 404 }
          );
        },
      } satisfies ExportedHandler<Env>;
      ```
        - `npx wrangler dev` # Develop locally
        - `npx wrangler d1 execute products --remote --file=./products.sql` # Import the data into the production version of your database
        - `npx wrangler d1 execute products --remote --command="SELECT * FROM products"` # Validate the data
        - `npx wrangler deploy` # Deploy your Worker on the Internet
- ***Notes***
    - Create (Add the new product to the database)
      ```
      curl --request POST http://localhost:8787/add_product \
          --header "Content-Type: application/json" \
          --data '{
              "barcode": "6934567890123",
              "name": "water",
              "price": 1
          }'
      ```
    - Read (Get product by barcode)
      ```
      curl http://localhost:8787/search_product?barcode=6934567890123
      ```
        - `barcode` # Replace it with `name` to get product by name
    - Update (Update the information of a product)
      ```
      curl --request PUT "http://localhost:8787/update_product" \
          --header "Content-Type: application/json" \
          --data '{
              "barcode": "6934567890123"
              "name": "water2"
              "price": 2
          }'
      ```
    - Delete (Delete product by barcode)
      ```
      curl --request DELETE http://localhost:8787/delete_product?barcode=6934567890123
      ```
    - Because to open the database to the Internet for easy query.
- ***References***
    - https://developers.cloudflare.com/d1/get-started/
    - Artificial intelligence
- ---
