<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Gentoo Linux amd64 Handbook: Installing Gentoo - Gentoo Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"948d24eaadd5bbe10341d449","wgCSPNonce":!1,"wgCanonicalNamespace":"Handbook","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":560,"wgPageName":"Handbook:AMD64/Full/Installation","wgTitle":"AMD64/Full/Installation","wgCurRevisionId":229552,"wgRevisionId":229552,"wgArticleId":72348,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Handbook:AMD64/Full/Installation","wgRelevantArticleId":72348,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[],
"wgULSCurrentAutonym":"English","wgPageFormsTargetName":null,"wgPageFormsAutocompleteValues":[],"wgPageFormsAutocompleteOnAllChars":!1,"wgPageFormsFieldProperties":[],"wgPageFormsCargoFields":[],"wgPageFormsDependentFields":[],"wgPageFormsCalendarValues":[],"wgPageFormsCalendarParams":[],"wgPageFormsCalendarHTML":null,"wgPageFormsGridValues":[],"wgPageFormsGridParams":[],"wgPageFormsContLangYes":null,"wgPageFormsContLangNo":null,"wgPageFormsContLangMonths":[],"wgPageFormsHeightForMinimizingInstances":800,"wgPageFormsShowOnSelect":[],"wgPageFormsScriptPath":"/extensions/PageForms","edgValues":null,"wgPageFormsEDSettings":null,"wgAmericanDates":!1,"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},"srfFilteredConfig":null,"wgULSPosition":"personal","wgULSisCompactLinksEnabled":!0,"wgEditSubmitButtonLabelPublish":!1,"wgTranslatePageTranslation":"source"};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":
"ready","user.options":"loading","ext.translate":"ready","ext.pygments":"ready","ext.cite.styles":"ready","mediawiki.toc.styles":"ready","ext.smw.style":"ready","ext.smw.tooltip.styles":"ready","ext.uls.pt":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready","ext.srf.styles":"ready","mediawiki.skinning.interface":"ready","mediawiki.skinning.content.externallinks":"ready","skins.tyrian.styles":"ready","skins.tyrian.icons":"ready"};RLPAGEMODULES=["ext.smw.style","ext.smw.tooltips","ext.cite.ux-enhancements","smw.entityexaminer","site","mediawiki.page.startup","mediawiki.page.ready","mediawiki.toc","ext.uls.compactlinks","ext.uls.interface","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.cite.styles%7Cext.pygments%2Ctranslate%7Cext.uls.pt%7Cext.visualEditor.desktopArticleTarget.noscript%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.toc.styles%7Cskins.tyrian.icons%2Cstyles&amp;only=styles&amp;skin=tyrian"/>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.smw.style%7Cext.smw.tooltip.styles&amp;only=styles&amp;skin=tyrian"/>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.srf.styles&amp;only=styles&amp;skin=tyrian"/>
<script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=tyrian"></script>
<link rel="stylesheet" href="https://assets.gentoo.org/tyrian/bootstrap.min.css"/><link rel="stylesheet" href="https://assets.gentoo.org/tyrian/tyrian.min.css"/><style>#mw-indicator-mw-helplink {display:none;}</style>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=tyrian"/>
<meta name="generator" content="MediaWiki 1.35.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#54487a"/>
<link rel="alternate" type="application/rdf+xml" title="Handbook:AMD64/Full/Installation" href="/index.php?title=Special:ExportRDF/Handbook:AMD64/Full/Installation&amp;xmlmime=rdf"/>
<link rel="shortcut icon" href="https://www.gentoo.org/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Gentoo Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="//wiki.gentoo.org/api.php?action=rsd"/>
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"/>
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-560 ns-subject page-Handbook_AMD64_Full_Installation rootpage-Handbook_AMD64 skin-tyrian action-view">	<div class="mw-jump sr-only">
		Jump to:		<a href="#top">content</a>
	</div>
	<header>
		<div class="site-title">
			<div class="container">
				<div class="row">
					<div class="site-title-buttons">
						<div class="btn-group btn-group-sm">
							<a href="https://get.gentoo.org/" role="button" class="btn get-gentoo"><span class="fa fa-fw fa-download"></span> <strong>Get Gentoo!</strong></a>
							<div class="btn-group btn-group-sm">
								<a class="btn gentoo-org-sites dropdown-toggle" data-toggle="dropdown" data-target="#" href="#">
									<span class="fa fa-fw fa-map-o"></span> <span class="hidden-xs">gentoo.org sites</span> <span class="caret"></span>
								</a>
								<ul class="dropdown-menu dropdown-menu-right">
									<li><a href="https://www.gentoo.org/" title="Main Gentoo website"><span class="fa fa-home fa-fw"></span> gentoo.org</a></li>
									<li><a href="https://wiki.gentoo.org/" title="Find and contribute documentation"><span class="fa fa-file-text-o fa-fw"></span> Wiki</a></li>
									<li><a href="https://bugs.gentoo.org/" title="Report issues and find common issues"><span class="fa fa-bug fa-fw"></span> Bugs</a></li>
									<li><a href="https://forums.gentoo.org/" title="Discuss with the community"><span class="fa fa-comments-o fa-fw"></span> Forums</a></li>
									<li><a href="https://packages.gentoo.org/" title="Find software for your Gentoo"><span class="fa fa-hdd-o fa-fw"></span> Packages</a></li>
									<li class="divider"></li>
									<li><a href="https://planet.gentoo.org/" title="Find out what's going on in the developer community"><span class="fa fa-rss fa-fw"></span> Planet</a></li>
									<li><a href="https://archives.gentoo.org/" title="Read up on past discussions"><span class="fa fa-archive fa-fw"></span> Archives</a></li>
									<li><a href="https://gitweb.gentoo.org/" title="Browse our source code in Gitweb"><span class="fa fa-code fa-fw"></span> Gitweb</a></li>
									<li class="divider"></li>
									<li><a href="https://infra-status.gentoo.org/" title="Get updates on the services provided by Gentoo"><span class="fa fa-server fa-fw"></span> Infra Status</a></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="logo">
						<a href="/" title="Back to the homepage" class="site-logo"><object data="https://assets.gentoo.org/tyrian/site-logo.svg" type="image/svg+xml">
							<img src="https://assets.gentoo.org/tyrian/site-logo.png" alt="Gentoo Linux Logo">
						</object></a>
						<span class="site-label">Wiki</span>
					</div>
				</div>
			</div>
		</div>
		<nav class="tyrian-navbar" role="navigation">
			<div class="container">
				<div class="row">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div class="collapse navbar-collapse navbar-main-collapse">
						<ul class="nav navbar-nav">
							<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-help"><a href="/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>			<li class="dropdown">
				<a href="/wiki/Gentoo_Wiki:Menu-Gentoo" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Gentoo <span class="caret"></span></a>
				<ul class="dropdown-menu" role="menu"><li id="n-Gentoo-Projects"><a href="/wiki/Project:Gentoo">Gentoo Projects</a></li>				</ul>
			</li>			<li class="dropdown">
				<a href="/wiki/Gentoo_Wiki:Menu-Documentation" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Documentation <span class="caret"></span></a>
				<ul class="dropdown-menu" role="menu"><li id="n-Gentoo-Handbook"><a href="/wiki/Handbook:Main_Page">Gentoo Handbook</a></li><li id="n-Gentoo-FAQ"><a href="/wiki/FAQ">Gentoo FAQ</a></li><li id="n-Featured-Documents"><a href="/wiki/Project:Documentation/Overview">Featured Documents</a></li><li role="presentation" class="divider"></li><li role="presentation" class="dropdown-header">Topics</li><li id="n-Core-system"><a href="/wiki/Category:Core_system">Core system</a></li><li id="n-Hardware"><a href="/wiki/Category:Hardware">Hardware</a></li><li id="n-Software"><a href="/wiki/Category:Software">Software</a></li><li id="n-Desktop"><a href="/wiki/Category:Desktop">Desktop</a></li><li id="n-Server-.26-Security"><a href="/wiki/Category:Server_and_Security">Server &amp; Security</a></li><li id="n-Project-.26-Community"><a href="/wiki/Category:Project_and_Community">Project &amp; Community</a></li>				</ul>
			</li>						</ul>
						<ul class="nav navbar-nav navbar-right hidden-xs">
									<li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-cog"></i> Tools <span class="caret"></span></a>
			<ul class="dropdown-menu" role="menu">
				<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Handbook:AMD64/Full/Installation" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Handbook:AMD64/Full/Installation" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=Handbook:AMD64/Full/Installation&amp;oldid=229552" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/index.php?title=Handbook:AMD64/Full/Installation&amp;action=info" title="More information about this page">Page information</a></li><li id="t-smwbrowselink"><a href="/wiki/Special:Browse/:Handbook:AMD64-2FFull-2FInstallation" rel="search">Browse properties</a></li>			</ul>
		</li>
			<li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
				<span class="fa fa-user" aria-label="Personal tools"></span>
				User				<span class="caret"></span>
			</a>
			<ul class="dropdown-menu" role="menu">
				<li id="pt-uls" class="active"><a href="#" class="uls-trigger">English</a></li><li id="pt-createaccount"><a href="/index.php?title=Special:CreateAccount&amp;returnto=Handbook%3AAMD64%2FFull%2FInstallation" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Handbook%3AAMD64%2FFull%2FInstallation" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>			</ul>
		</li>
								</ul>
					</div>
				</div>
			</div>
		</nav>
		
		<nav class="navbar navbar-grey navbar-stick" id="wiki-actions" role="navigation">
			<div class="container"><div class="row">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#gw-toolbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse" id="gw-toolbar">
					<ul class="nav navbar-nav">
					<li id="ca-nstab-handbook" class="selected active"><a href="/wiki/Handbook:AMD64/Full/Installation">Handbook</a></li><li id="ca-talk"><a href="/wiki/Handbook_Talk:AMD64/Full/Installation" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>					</ul>
							<form action="/index.php" id="searchform" class="navbar-form navbar-right" role="search">
			<input type='hidden' name="title" value="Special:Search"/>

				<div class="input-group">
					<input type="search" name="search" placeholder="Search" title="Search Gentoo Wiki [f]" accesskey="f" id="searchInput" class="form-control"/>					<div class="input-group-btn"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton btn btn-default"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton btn btn-default"/></div>
				</div>
		</form>
						<ul class="nav navbar-nav navbar-right hidden-xs">
					<li id="ca-viewsource"><a href="/index.php?title=Handbook:AMD64/Full/Installation&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">more <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
					<li id="ca-history"><a href="/index.php?title=Handbook:AMD64/Full/Installation&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>							</ul>
						</li>
					</ul>
				</div>
			</div></div>
		</nav>
		</header>
	
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div id="content" class="mw-body" role="main">
						<a id="top"></a>
						
						<h1 id="firstHeading" class="first-header" lang="en">
							<span dir="auto">Gentoo Linux amd64 Handbook: Installing Gentoo</span>
						</h1>

						<div id="bodyContent" class="mw-body-content">
							<div id="siteSub">From Gentoo Wiki</div>
							<div id="contentSub">
								<span class="subpages">&lt; <a href="/wiki/Special:MyLanguage/Handbook:AMD64" title="Special:MyLanguage/Handbook:AMD64">Handbook:AMD64</a>&lrm; | <a href="/wiki/Special:MyLanguage/Handbook:AMD64/Full" title="Special:MyLanguage/Handbook:AMD64/Full">Full</a></span>							</div>
												                <div id="jump-to-nav"></div>
					                <a class="mw-jump-link" href="#mw-head">Jump to:navigation</a>
					                <a class="mw-jump-link" href="#searchInput">Jump to:search</a>

							<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2"><a href="#Welcome"><span class="tocnumber">1.1</span> <span class="toctext">Welcome</span></a></li>
<li class="toclevel-2"><a href="#How_the_installation_is_structured"><span class="tocnumber">1.2</span> <span class="toctext">How the installation is structured</span></a></li>
<li class="toclevel-2"><a href="#Installation_options_for_Gentoo"><span class="tocnumber">1.3</span> <span class="toctext">Installation options for Gentoo</span></a></li>
<li class="toclevel-2"><a href="#Troubles"><span class="tocnumber">1.4</span> <span class="toctext">Troubles</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Hardware_requirements"><span class="tocnumber">2</span> <span class="toctext">Hardware requirements</span></a></li>
<li class="toclevel-1"><a href="#Gentoo_Linux_installation_media"><span class="tocnumber">3</span> <span class="toctext">Gentoo Linux installation media</span></a>
<ul>
<li class="toclevel-2"><a href="#Minimal_installation_CD"><span class="tocnumber">3.1</span> <span class="toctext">Minimal installation CD</span></a></li>
<li class="toclevel-2"><a href="#The_occasional_Gentoo_LiveDVD"><span class="tocnumber">3.2</span> <span class="toctext">The occasional Gentoo LiveDVD</span></a></li>
<li class="toclevel-2"><a href="#What_are_stages_then.3F"><span class="tocnumber">3.3</span> <span class="toctext">What are stages then?</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Downloading"><span class="tocnumber">4</span> <span class="toctext">Downloading</span></a>
<ul>
<li class="toclevel-2"><a href="#Obtain_the_media"><span class="tocnumber">4.1</span> <span class="toctext">Obtain the media</span></a></li>
<li class="toclevel-2"><a href="#Verifying_the_downloaded_files"><span class="tocnumber">4.2</span> <span class="toctext">Verifying the downloaded files</span></a>
<ul>
<li class="toclevel-3"><a href="#Microsoft_Windows_based_verification"><span class="tocnumber">4.2.1</span> <span class="toctext">Microsoft Windows based verification</span></a></li>
<li class="toclevel-3"><a href="#Linux_based_verification"><span class="tocnumber">4.2.2</span> <span class="toctext">Linux based verification</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Burning_a_disk"><span class="tocnumber">4.3</span> <span class="toctext">Burning a disk</span></a>
<ul>
<li class="toclevel-3"><a href="#Burning_with_Microsoft_Windows_7_and_above"><span class="tocnumber">4.3.1</span> <span class="toctext">Burning with Microsoft Windows 7 and above</span></a></li>
<li class="toclevel-3"><a href="#Burning_with_Linux"><span class="tocnumber">4.3.2</span> <span class="toctext">Burning with Linux</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Booting"><span class="tocnumber">5</span> <span class="toctext">Booting</span></a>
<ul>
<li class="toclevel-2"><a href="#Booting_the_installation_media"><span class="tocnumber">5.1</span> <span class="toctext">Booting the installation media</span></a>
<ul>
<li class="toclevel-3"><a href="#Kernel_choices"><span class="tocnumber">5.1.1</span> <span class="toctext">Kernel choices</span></a></li>
<li class="toclevel-3"><a href="#Hardware_options"><span class="tocnumber">5.1.2</span> <span class="toctext">Hardware options</span></a></li>
<li class="toclevel-3"><a href="#Logical_volume.2Fdevice_management"><span class="tocnumber">5.1.3</span> <span class="toctext">Logical volume/device management</span></a></li>
<li class="toclevel-3"><a href="#Other_options"><span class="tocnumber">5.1.4</span> <span class="toctext">Other options</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Extra_hardware_configuration"><span class="tocnumber">5.2</span> <span class="toctext">Extra hardware configuration</span></a></li>
<li class="toclevel-2"><a href="#Optional:_User_accounts"><span class="tocnumber">5.3</span> <span class="toctext">Optional: User accounts</span></a></li>
<li class="toclevel-2"><a href="#Optional:_Viewing_documentation_while_installing"><span class="tocnumber">5.4</span> <span class="toctext">Optional: Viewing documentation while installing</span></a>
<ul>
<li class="toclevel-3"><a href="#TTYs"><span class="tocnumber">5.4.1</span> <span class="toctext">TTYs</span></a></li>
<li class="toclevel-3"><a href="#GNU_Screen"><span class="tocnumber">5.4.2</span> <span class="toctext">GNU Screen</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Optional:_Starting_the_SSH_daemon"><span class="tocnumber">5.5</span> <span class="toctext">Optional: Starting the SSH daemon</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Automatic_network_detection"><span class="tocnumber">6</span> <span class="toctext">Automatic network detection</span></a>
<ul>
<li class="toclevel-2"><a href="#Determine_interface_names"><span class="tocnumber">6.1</span> <span class="toctext">Determine interface names</span></a>
<ul>
<li class="toclevel-3"><a href="#ifconfig_command"><span class="tocnumber">6.1.1</span> <span class="toctext">ifconfig command</span></a></li>
<li class="toclevel-3"><a href="#ip_command"><span class="tocnumber">6.1.2</span> <span class="toctext">ip command</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Optional:_Configure_any_proxies"><span class="tocnumber">6.2</span> <span class="toctext">Optional: Configure any proxies</span></a></li>
<li class="toclevel-2"><a href="#Testing_the_network"><span class="tocnumber">6.3</span> <span class="toctext">Testing the network</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Automatic_network_configuration"><span class="tocnumber">7</span> <span class="toctext">Automatic network configuration</span></a>
<ul>
<li class="toclevel-2"><a href="#Default:_Using_net-setup"><span class="tocnumber">7.1</span> <span class="toctext">Default: Using net-setup</span></a></li>
<li class="toclevel-2"><a href="#Alternative:_Using_PPP"><span class="tocnumber">7.2</span> <span class="toctext">Alternative: Using PPP</span></a></li>
<li class="toclevel-2"><a href="#Alternative:_Using_PPTP"><span class="tocnumber">7.3</span> <span class="toctext">Alternative: Using PPTP</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Manual_network_configuration"><span class="tocnumber">8</span> <span class="toctext">Manual network configuration</span></a>
<ul>
<li class="toclevel-2"><a href="#Loading_the_appropriate_network_kernel_modules"><span class="tocnumber">8.1</span> <span class="toctext">Loading the appropriate network kernel modules</span></a></li>
<li class="toclevel-2"><a href="#Using_DHCP"><span class="tocnumber">8.2</span> <span class="toctext">Using DHCP</span></a></li>
<li class="toclevel-2"><a href="#Preparing_for_wireless_access"><span class="tocnumber">8.3</span> <span class="toctext">Preparing for wireless access</span></a></li>
<li class="toclevel-2"><a href="#Understanding_network_terminology"><span class="tocnumber">8.4</span> <span class="toctext">Understanding network terminology</span></a></li>
<li class="toclevel-2"><a href="#Using_ifconfig_and_route"><span class="tocnumber">8.5</span> <span class="toctext">Using ifconfig and route</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Introduction_to_block_devices"><span class="tocnumber">9</span> <span class="toctext">Introduction to block devices</span></a>
<ul>
<li class="toclevel-2"><a href="#Block_devices"><span class="tocnumber">9.1</span> <span class="toctext">Block devices</span></a></li>
<li class="toclevel-2"><a href="#Partition_tables"><span class="tocnumber">9.2</span> <span class="toctext">Partition tables</span></a>
<ul>
<li class="toclevel-3"><a href="#GUID_Partition_Table_.28GPT.29"><span class="tocnumber">9.2.1</span> <span class="toctext">GUID Partition Table (GPT)</span></a></li>
<li class="toclevel-3"><a href="#Master_boot_record_.28MBR.29_or_DOS_boot_sector"><span class="tocnumber">9.2.2</span> <span class="toctext">Master boot record (MBR) or DOS boot sector</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Advanced_storage"><span class="tocnumber">9.3</span> <span class="toctext">Advanced storage</span></a></li>
<li class="toclevel-2"><a href="#Default_partitioning_scheme"><span class="tocnumber">9.4</span> <span class="toctext">Default partitioning scheme</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Designing_a_partition_scheme"><span class="tocnumber">10</span> <span class="toctext">Designing a partition scheme</span></a>
<ul>
<li class="toclevel-2"><a href="#How_many_partitions_and_how_big.3F"><span class="tocnumber">10.1</span> <span class="toctext">How many partitions and how big?</span></a></li>
<li class="toclevel-2"><a href="#What_about_swap_space.3F"><span class="tocnumber">10.2</span> <span class="toctext">What about swap space?</span></a></li>
<li class="toclevel-2"><a href="#What_is_the_EFI_System_Partition_.28ESP.29.3F"><span class="tocnumber">10.3</span> <span class="toctext">What is the EFI System Partition (ESP)?</span></a></li>
<li class="toclevel-2"><a href="#What_is_the_BIOS_boot_partition.3F"><span class="tocnumber">10.4</span> <span class="toctext">What is the BIOS boot partition?</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Partitioning_the_disk_with_GPT_for_UEFI"><span class="tocnumber">11</span> <span class="toctext">Partitioning the disk with GPT for UEFI</span></a>
<ul>
<li class="toclevel-2"><a href="#Viewing_the_current_partition_layout"><span class="tocnumber">11.1</span> <span class="toctext">Viewing the current partition layout</span></a></li>
<li class="toclevel-2"><a href="#Creating_a_new_disklabel_.2F_removing_all_partitions"><span class="tocnumber">11.2</span> <span class="toctext">Creating a new disklabel / removing all partitions</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_EFI_system_partition_.28ESP.29"><span class="tocnumber">11.3</span> <span class="toctext">Creating the EFI system partition (ESP)</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_swap_partition"><span class="tocnumber">11.4</span> <span class="toctext">Creating the swap partition</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_root_partition"><span class="tocnumber">11.5</span> <span class="toctext">Creating the root partition</span></a></li>
<li class="toclevel-2"><a href="#Saving_the_partition_layout"><span class="tocnumber">11.6</span> <span class="toctext">Saving the partition layout</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Partitioning_the_disk_with_MBR_for_BIOS_.2F_legacy_boot"><span class="tocnumber">12</span> <span class="toctext">Partitioning the disk with MBR for BIOS / legacy boot</span></a>
<ul>
<li class="toclevel-2"><a href="#Viewing_the_current_partition_layout_2"><span class="tocnumber">12.1</span> <span class="toctext">Viewing the current partition layout</span></a></li>
<li class="toclevel-2"><a href="#Creating_a_new_disklabel_.2F_removing_all_partitions_2"><span class="tocnumber">12.2</span> <span class="toctext">Creating a new disklabel / removing all partitions</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_boot_partition"><span class="tocnumber">12.3</span> <span class="toctext">Creating the boot partition</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_swap_partition_2"><span class="tocnumber">12.4</span> <span class="toctext">Creating the swap partition</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_root_partition_2"><span class="tocnumber">12.5</span> <span class="toctext">Creating the root partition</span></a></li>
<li class="toclevel-2"><a href="#Saving_the_partition_layout_2"><span class="tocnumber">12.6</span> <span class="toctext">Saving the partition layout</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Creating_file_systems"><span class="tocnumber">13</span> <span class="toctext">Creating file systems</span></a>
<ul>
<li class="toclevel-2"><a href="#Introduction_2"><span class="tocnumber">13.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2"><a href="#Filesystems"><span class="tocnumber">13.2</span> <span class="toctext">Filesystems</span></a></li>
<li class="toclevel-2"><a href="#Applying_a_filesystem_to_a_partition"><span class="tocnumber">13.3</span> <span class="toctext">Applying a filesystem to a partition</span></a></li>
<li class="toclevel-2"><a href="#Activating_the_swap_partition"><span class="tocnumber">13.4</span> <span class="toctext">Activating the swap partition</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Mounting_the_root_partition"><span class="tocnumber">14</span> <span class="toctext">Mounting the root partition</span></a></li>
<li class="toclevel-1"><a href="#Installing_a_stage_tarball"><span class="tocnumber">15</span> <span class="toctext">Installing a stage tarball</span></a>
<ul>
<li class="toclevel-2"><a href="#Setting_the_date_and_time"><span class="tocnumber">15.1</span> <span class="toctext">Setting the date and time</span></a>
<ul>
<li class="toclevel-3"><a href="#Automatic"><span class="tocnumber">15.1.1</span> <span class="toctext">Automatic</span></a></li>
<li class="toclevel-3"><a href="#Manual"><span class="tocnumber">15.1.2</span> <span class="toctext">Manual</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Choosing_a_stage_tarball"><span class="tocnumber">15.2</span> <span class="toctext">Choosing a stage tarball</span></a>
<ul>
<li class="toclevel-3"><a href="#Multilib_.2832_and_64-bit.29"><span class="tocnumber">15.2.1</span> <span class="toctext">Multilib (32 and 64-bit)</span></a></li>
<li class="toclevel-3"><a href="#No-multilib_.28pure_64-bit.29"><span class="tocnumber">15.2.2</span> <span class="toctext">No-multilib (pure 64-bit)</span></a></li>
<li class="toclevel-3"><a href="#OpenRC"><span class="tocnumber">15.2.3</span> <span class="toctext">OpenRC</span></a></li>
<li class="toclevel-3"><a href="#systemd"><span class="tocnumber">15.2.4</span> <span class="toctext">systemd</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Downloading_the_stage_tarball"><span class="tocnumber">15.3</span> <span class="toctext">Downloading the stage tarball</span></a>
<ul>
<li class="toclevel-3"><a href="#Graphical_browsers"><span class="tocnumber">15.3.1</span> <span class="toctext">Graphical browsers</span></a></li>
<li class="toclevel-3"><a href="#Command-line_browsers"><span class="tocnumber">15.3.2</span> <span class="toctext">Command-line browsers</span></a></li>
<li class="toclevel-3"><a href="#Verifying_and_validating"><span class="tocnumber">15.3.3</span> <span class="toctext">Verifying and validating</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Unpacking_the_stage_tarball"><span class="tocnumber">15.4</span> <span class="toctext">Unpacking the stage tarball</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Configuring_compile_options"><span class="tocnumber">16</span> <span class="toctext">Configuring compile options</span></a>
<ul>
<li class="toclevel-2"><a href="#Introduction_3"><span class="tocnumber">16.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2"><a href="#CFLAGS_and_CXXFLAGS"><span class="tocnumber">16.2</span> <span class="toctext">CFLAGS and CXXFLAGS</span></a></li>
<li class="toclevel-2"><a href="#MAKEOPTS"><span class="tocnumber">16.3</span> <span class="toctext">MAKEOPTS</span></a></li>
<li class="toclevel-2"><a href="#Ready.2C_set.2C_go.21"><span class="tocnumber">16.4</span> <span class="toctext">Ready, set, go!</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Chrooting"><span class="tocnumber">17</span> <span class="toctext">Chrooting</span></a>
<ul>
<li class="toclevel-2"><a href="#Optional:_Selecting_mirrors"><span class="tocnumber">17.1</span> <span class="toctext">Optional: Selecting mirrors</span></a>
<ul>
<li class="toclevel-3"><a href="#Distribution_files"><span class="tocnumber">17.1.1</span> <span class="toctext">Distribution files</span></a></li>
<li class="toclevel-3"><a href="#Gentoo_ebuild_repository"><span class="tocnumber">17.1.2</span> <span class="toctext">Gentoo ebuild repository</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Copy_DNS_info"><span class="tocnumber">17.2</span> <span class="toctext">Copy DNS info</span></a></li>
<li class="toclevel-2"><a href="#Mounting_the_necessary_filesystems"><span class="tocnumber">17.3</span> <span class="toctext">Mounting the necessary filesystems</span></a></li>
<li class="toclevel-2"><a href="#Entering_the_new_environment"><span class="tocnumber">17.4</span> <span class="toctext">Entering the new environment</span></a></li>
<li class="toclevel-2"><a href="#Mounting_the_boot_partition"><span class="tocnumber">17.5</span> <span class="toctext">Mounting the boot partition</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Configuring_Portage"><span class="tocnumber">18</span> <span class="toctext">Configuring Portage</span></a>
<ul>
<li class="toclevel-2"><a href="#Installing_a_Gentoo_ebuild_repository_snapshot_from_the_web"><span class="tocnumber">18.1</span> <span class="toctext">Installing a Gentoo ebuild repository snapshot from the web</span></a></li>
<li class="toclevel-2"><a href="#Optional:_Updating_the_Gentoo_ebuild_repository"><span class="tocnumber">18.2</span> <span class="toctext">Optional: Updating the Gentoo ebuild repository</span></a></li>
<li class="toclevel-2"><a href="#Reading_news_items"><span class="tocnumber">18.3</span> <span class="toctext">Reading news items</span></a></li>
<li class="toclevel-2"><a href="#Choosing_the_right_profile"><span class="tocnumber">18.4</span> <span class="toctext">Choosing the right profile</span></a>
<ul>
<li class="toclevel-3"><a href="#No-multilib"><span class="tocnumber">18.4.1</span> <span class="toctext">No-multilib</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Updating_the_.40world_set"><span class="tocnumber">18.5</span> <span class="toctext">Updating the @world set</span></a></li>
<li class="toclevel-2"><a href="#Configuring_the_USE_variable"><span class="tocnumber">18.6</span> <span class="toctext">Configuring the USE variable</span></a>
<ul>
<li class="toclevel-3"><a href="#CPU_FLAGS_.2A"><span class="tocnumber">18.6.1</span> <span class="toctext">CPU_FLAGS_*</span></a></li>
<li class="toclevel-3"><a href="#VIDEO_CARDS"><span class="tocnumber">18.6.2</span> <span class="toctext">VIDEO_CARDS</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Optional:_Configure_the_ACCEPT_LICENSE_variable"><span class="tocnumber">18.7</span> <span class="toctext">Optional: Configure the ACCEPT_LICENSE variable</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Optional:_Using_systemd_as_the_init_system"><span class="tocnumber">19</span> <span class="toctext">Optional: Using systemd as the init system</span></a></li>
<li class="toclevel-1"><a href="#Timezone"><span class="tocnumber">20</span> <span class="toctext">Timezone</span></a>
<ul>
<li class="toclevel-2"><a href="#OpenRC_2"><span class="tocnumber">20.1</span> <span class="toctext">OpenRC</span></a></li>
<li class="toclevel-2"><a href="#systemd_2"><span class="tocnumber">20.2</span> <span class="toctext">systemd</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Configure_locales"><span class="tocnumber">21</span> <span class="toctext">Configure locales</span></a>
<ul>
<li class="toclevel-2"><a href="#Locale_generation"><span class="tocnumber">21.1</span> <span class="toctext">Locale generation</span></a></li>
<li class="toclevel-2"><a href="#Locale_selection"><span class="tocnumber">21.2</span> <span class="toctext">Locale selection</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Optional:_Installing_firmware_and.2For_microcode"><span class="tocnumber">22</span> <span class="toctext">Optional: Installing firmware and/or microcode</span></a></li>
<li class="toclevel-1"><a href="#Kernel_configuration_and_compilation"><span class="tocnumber">23</span> <span class="toctext">Kernel configuration and compilation</span></a>
<ul>
<li class="toclevel-2"><a href="#Installing_the_sources"><span class="tocnumber">23.1</span> <span class="toctext">Installing the sources</span></a></li>
<li class="toclevel-2"><a href="#Manual_configuration"><span class="tocnumber">23.2</span> <span class="toctext">Manual configuration</span></a>
<ul>
<li class="toclevel-3"><a href="#Introduction_4"><span class="tocnumber">23.2.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-3"><a href="#Activating_required_options"><span class="tocnumber">23.2.2</span> <span class="toctext">Activating required options</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Architecture_specific_kernel_configuration"><span class="tocnumber">23.3</span> <span class="toctext">Architecture specific kernel configuration</span></a></li>
<li class="toclevel-2"><a href="#Compiling_and_installing"><span class="tocnumber">23.4</span> <span class="toctext">Compiling and installing</span></a>
<ul>
<li class="toclevel-3"><a href="#Optional:_Building_an_initramfs"><span class="tocnumber">23.4.1</span> <span class="toctext">Optional: Building an initramfs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Alternative:_Using_genkernel"><span class="tocnumber">24</span> <span class="toctext">Alternative: Using genkernel</span></a></li>
<li class="toclevel-1"><a href="#Alternative:_Using_distribution_kernels"><span class="tocnumber">25</span> <span class="toctext">Alternative: Using distribution kernels</span></a>
<ul>
<li class="toclevel-2"><a href="#Installing_correct_installkernel"><span class="tocnumber">25.1</span> <span class="toctext">Installing correct installkernel</span></a></li>
<li class="toclevel-2"><a href="#Installing_a_distribution_kernel"><span class="tocnumber">25.2</span> <span class="toctext">Installing a distribution kernel</span></a></li>
<li class="toclevel-2"><a href="#Upgrading_and_cleaning_up"><span class="tocnumber">25.3</span> <span class="toctext">Upgrading and cleaning up</span></a></li>
<li class="toclevel-2"><a href="#Post-install.2Fupgrade_tasks"><span class="tocnumber">25.4</span> <span class="toctext">Post-install/upgrade tasks</span></a>
<ul>
<li class="toclevel-3"><a href="#Manually_rebuilding_the_initramfs"><span class="tocnumber">25.4.1</span> <span class="toctext">Manually rebuilding the initramfs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Kernel_modules"><span class="tocnumber">26</span> <span class="toctext">Kernel modules</span></a>
<ul>
<li class="toclevel-2"><a href="#Configuring_the_modules"><span class="tocnumber">26.1</span> <span class="toctext">Configuring the modules</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Filesystem_information"><span class="tocnumber">27</span> <span class="toctext">Filesystem information</span></a>
<ul>
<li class="toclevel-2"><a href="#About_fstab"><span class="tocnumber">27.1</span> <span class="toctext">About fstab</span></a></li>
<li class="toclevel-2"><a href="#Creating_the_fstab_file"><span class="tocnumber">27.2</span> <span class="toctext">Creating the fstab file</span></a>
<ul>
<li class="toclevel-3"><a href="#Filesystem_labels_and_UUIDs"><span class="tocnumber">27.2.1</span> <span class="toctext">Filesystem labels and UUIDs</span></a></li>
<li class="toclevel-3"><a href="#Partition_labels_and_UUIDs"><span class="tocnumber">27.2.2</span> <span class="toctext">Partition labels and UUIDs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Networking_information"><span class="tocnumber">28</span> <span class="toctext">Networking information</span></a>
<ul>
<li class="toclevel-2"><a href="#Host_and_domain_information"><span class="tocnumber">28.1</span> <span class="toctext">Host and domain information</span></a>
<ul>
<li class="toclevel-3"><a href="#OpenRC_3"><span class="tocnumber">28.1.1</span> <span class="toctext">OpenRC</span></a></li>
<li class="toclevel-3"><a href="#systemd_3"><span class="tocnumber">28.1.2</span> <span class="toctext">systemd</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Network"><span class="tocnumber">28.2</span> <span class="toctext">Network</span></a>
<ul>
<li class="toclevel-3"><a href="#DHCP_via_dhcpcd_.28any_init_system.29"><span class="tocnumber">28.2.1</span> <span class="toctext">DHCP via dhcpcd (any init system)</span></a></li>
<li class="toclevel-3"><a href="#netifrc_.28OpenRC.29"><span class="tocnumber">28.2.2</span> <span class="toctext">netifrc (OpenRC)</span></a>
<ul>
<li class="toclevel-4"><a href="#Configuring_the_network"><span class="tocnumber">28.2.2.1</span> <span class="toctext">Configuring the network</span></a></li>
<li class="toclevel-4"><a href="#Automatically_start_networking_at_boot"><span class="tocnumber">28.2.2.2</span> <span class="toctext">Automatically start networking at boot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#The_hosts_file"><span class="tocnumber">28.3</span> <span class="toctext">The hosts file</span></a></li>
<li class="toclevel-2"><a href="#Optional:_Get_PCMCIA_working"><span class="tocnumber">28.4</span> <span class="toctext">Optional: Get PCMCIA working</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#System_information"><span class="tocnumber">29</span> <span class="toctext">System information</span></a>
<ul>
<li class="toclevel-2"><a href="#Root_password"><span class="tocnumber">29.1</span> <span class="toctext">Root password</span></a></li>
<li class="toclevel-2"><a href="#Init_and_boot_configuration"><span class="tocnumber">29.2</span> <span class="toctext">Init and boot configuration</span></a>
<ul>
<li class="toclevel-3"><a href="#OpenRC_4"><span class="tocnumber">29.2.1</span> <span class="toctext">OpenRC</span></a></li>
<li class="toclevel-3"><a href="#systemd_4"><span class="tocnumber">29.2.2</span> <span class="toctext">systemd</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#System_logger"><span class="tocnumber">30</span> <span class="toctext">System logger</span></a></li>
<li class="toclevel-1"><a href="#Optional:_Cron_daemon"><span class="tocnumber">31</span> <span class="toctext">Optional: Cron daemon</span></a></li>
<li class="toclevel-1"><a href="#Optional:_File_indexing"><span class="tocnumber">32</span> <span class="toctext">Optional: File indexing</span></a></li>
<li class="toclevel-1"><a href="#Optional:_Remote_access"><span class="tocnumber">33</span> <span class="toctext">Optional: Remote access</span></a></li>
<li class="toclevel-1"><a href="#Time_synchronization"><span class="tocnumber">34</span> <span class="toctext">Time synchronization</span></a></li>
<li class="toclevel-1"><a href="#Filesystem_tools"><span class="tocnumber">35</span> <span class="toctext">Filesystem tools</span></a></li>
<li class="toclevel-1"><a href="#Networking_tools"><span class="tocnumber">36</span> <span class="toctext">Networking tools</span></a>
<ul>
<li class="toclevel-2"><a href="#Installing_a_DHCP_client"><span class="tocnumber">36.1</span> <span class="toctext">Installing a DHCP client</span></a></li>
<li class="toclevel-2"><a href="#Optional:_Installing_a_PPPoE_client"><span class="tocnumber">36.2</span> <span class="toctext">Optional: Installing a PPPoE client</span></a></li>
<li class="toclevel-2"><a href="#Optional:_Install_wireless_networking_tools"><span class="tocnumber">36.3</span> <span class="toctext">Optional: Install wireless networking tools</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Selecting_a_boot_loader"><span class="tocnumber">37</span> <span class="toctext">Selecting a boot loader</span></a></li>
<li class="toclevel-1"><a href="#Default:_GRUB"><span class="tocnumber">38</span> <span class="toctext">Default: GRUB</span></a>
<ul>
<li class="toclevel-2"><a href="#Emerge"><span class="tocnumber">38.1</span> <span class="toctext">Emerge</span></a></li>
<li class="toclevel-2"><a href="#Install"><span class="tocnumber">38.2</span> <span class="toctext">Install</span></a></li>
<li class="toclevel-2"><a href="#Configure"><span class="tocnumber">38.3</span> <span class="toctext">Configure</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Alternative_1:_LILO"><span class="tocnumber">39</span> <span class="toctext">Alternative 1: LILO</span></a>
<ul>
<li class="toclevel-2"><a href="#Emerge_2"><span class="tocnumber">39.1</span> <span class="toctext">Emerge</span></a></li>
<li class="toclevel-2"><a href="#Configure_2"><span class="tocnumber">39.2</span> <span class="toctext">Configure</span></a></li>
<li class="toclevel-2"><a href="#Install_2"><span class="tocnumber">39.3</span> <span class="toctext">Install</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Alternative_2:_efibootmgr"><span class="tocnumber">40</span> <span class="toctext">Alternative 2: efibootmgr</span></a></li>
<li class="toclevel-1"><a href="#Alternative_3:_Syslinux"><span class="tocnumber">41</span> <span class="toctext">Alternative 3: Syslinux</span></a></li>
<li class="toclevel-1"><a href="#Rebooting_the_system"><span class="tocnumber">42</span> <span class="toctext">Rebooting the system</span></a></li>
<li class="toclevel-1"><a href="#User_administration"><span class="tocnumber">43</span> <span class="toctext">User administration</span></a>
<ul>
<li class="toclevel-2"><a href="#Adding_a_user_for_daily_use"><span class="tocnumber">43.1</span> <span class="toctext">Adding a user for daily use</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Disk_cleanup"><span class="tocnumber">44</span> <span class="toctext">Disk cleanup</span></a>
<ul>
<li class="toclevel-2"><a href="#Removing_tarballs"><span class="tocnumber">44.1</span> <span class="toctext">Removing tarballs</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Where_to_go_from_here"><span class="tocnumber">45</span> <span class="toctext">Where to go from here</span></a>
<ul>
<li class="toclevel-2"><a href="#Additional_documentation"><span class="tocnumber">45.1</span> <span class="toctext">Additional documentation</span></a></li>
<li class="toclevel-2"><a href="#Gentoo_online"><span class="tocnumber">45.2</span> <span class="toctext">Gentoo online</span></a>
<ul>
<li class="toclevel-3"><a href="#Forums_and_IRC"><span class="tocnumber">45.2.1</span> <span class="toctext">Forums and IRC</span></a></li>
<li class="toclevel-3"><a href="#Mailing_lists"><span class="tocnumber">45.2.2</span> <span class="toctext">Mailing lists</span></a></li>
<li class="toclevel-3"><a href="#Bugs"><span class="tocnumber">45.2.3</span> <span class="toctext">Bugs</span></a></li>
<li class="toclevel-3"><a href="#Development_guide"><span class="tocnumber">45.2.4</span> <span class="toctext">Development guide</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Closing_thoughts"><span class="tocnumber">45.3</span> <span class="toctext">Closing thoughts</span></a></li>
</ul>
</li>
</ul>
</div>

<p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<h3><span class="mw-headline" id="Welcome">Welcome</span></h3>
<p>First of all, welcome to Gentoo! You are about to enter the world of choices and performance. Gentoo is all about choices. When installing Gentoo, this is made clear several times - users can choose how much they want to compile themselves, how to install Gentoo, what system logger to use, etc.
</p><p>Gentoo is a fast, modern meta-distribution with a clean and flexible design. It is built on an ecosystem of free software and does not hide what is beneath the hood from its users. Portage, the package maintenance system which Gentoo uses, is written in Python, meaning the user can easily view and modify the source code. Gentoo's packaging system uses source code (although support for pre-compiled packages is included too) and configuring Gentoo happens through regular text files. In other words, openness everywhere.
</p><p>It is very important that everyone understands that choices are what makes Gentoo run. We try not to force users into anything they do not like. If anyone believes otherwise, please file a <a rel="nofollow" class="external text" href="https://bugs.gentoo.org">bug report</a>.
</p>
<h3><span class="mw-headline" id="How_the_installation_is_structured">How the installation is structured</span></h3>
<p>The Gentoo Installation can be seen as a 10-step procedure, corresponding to the next set of chapters. Each step results in a certain state:
</p>
<table class="table table-condensed table-striped">

<tbody><tr style="background-color:#dddaec">
<th scope="col" width="15%">Step</th>
<th>Result
</th></tr>
<tr>
<td>1</td>
<td>The user is in a working environment ready to install Gentoo.
</td></tr>
<tr>
<td>2</td>
<td>The Internet connection is ready to install Gentoo.
</td></tr>
<tr>
<td>3</td>
<td>The hard disks are initialized to host the Gentoo installation.
</td></tr>
<tr>
<td>4</td>
<td>The installation environment is prepared and the user is ready to <a href="/wiki/Chroot" title="Chroot">chroot</a> into the new environment.
</td></tr>
<tr>
<td>5</td>
<td>Core packages, which are the same on all Gentoo installations, are installed.
</td></tr>
<tr>
<td>6</td>
<td>The Linux kernel is installed.
</td></tr>
<tr>
<td>7</td>
<td>Most of the Gentoo system configuration files are created.
</td></tr>
<tr>
<td>8</td>
<td>The necessary system tools are installed.
</td></tr>
<tr>
<td>9</td>
<td>The proper boot loader has been installed and configured.
</td></tr>
<tr>
<td>10</td>
<td>The freshly installed Gentoo Linux environment is ready to be explored.
</td></tr></tbody></table>
<p>Whenever a certain choice is presented the handbook will try to explain the pros and cons of each choice. Although the text then continues with a default choice (identified by "Default: " in the title), the other possibilities will be documented as well (marked by "Alternative: " in the title). Do not think that the default is what Gentoo recommends. It is, however, the choice that Gentoo believes most users will make.
</p><p>Sometimes an optional step can be followed. Such steps are marked as "Optional: " and are therefore not needed to install Gentoo. However, some optional steps are dependent on a previously made decision. The instructions will inform the reader when this happens, both when the decision is made, and right before the optional step is described.
</p>
<h3><span class="mw-headline" id="Installation_options_for_Gentoo">Installation options for Gentoo</span></h3>
<p>Gentoo can be installed in many different ways. It can be downloaded and installed from official Gentoo installation media such as our bootable ISO images. The installation media can be installed on a USB stick or accessed via a netbooted environment. Alternatively, Gentoo can be installed from non-official media such as an already installed distribution or a non-Gentoo bootable disk (such as <a rel="nofollow" class="external text" href="https://www.knopper.net/knoppix/index-en.html">Knoppix</a>).
</p><p>This document covers the installation using official Gentoo Installation media or, in certain cases, netbooting.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />For help on the other installation approaches, including using non-Gentoo bootable media, please read our <a href="/wiki/Installation_alternatives" title="Installation alternatives">Alternative installation guide</a>.</div>
<p>We also provide a <a href="/wiki/Gentoo_installation_tips_and_tricks" title="Gentoo installation tips and tricks">Gentoo installation tips and tricks</a> document that might be useful.
</p>
<h3><span class="mw-headline" id="Troubles">Troubles</span></h3>
<p>If a problem is found in the installation (or in the installation documentation), please visit our <a rel="nofollow" class="external text" href="https://bugs.gentoo.org">bug tracking system</a> and check if the bug is known. If not, please create a bug report for it so we can take care of it. Do not be afraid of the developers who are assigned to the bugs - they (generally) don't eat people.
</p><p>Although this document is architecture-specific, it may contain references to other architectures as well, because large parts of the Gentoo Handbook use text that is identical for all architectures (to avoid duplication of effort). Such references have been kept to a minimum, to avoid confusion.
</p><p>If there is some uncertainty whether or not the problem is a user-problem (some error made despite having read the documentation carefully) or a software-problem (some error we made despite having tested the installation/documentation carefully) everybody is welcome to join the <span style="font-family: monospace; font-size: 95%;"><a rel="nofollow" class="external text" href="ircs://irc.libera.chat/#gentoo">#gentoo</a></span> (<span style="font-family: monospace; font-size: 95%;"><a rel="nofollow" class="external text" href="https://web.libera.chat/#gentoo">webchat</a></span>) channel on irc.libera.chat. Of course, everyone is welcome otherwise too as our chat channel covers the broad Gentoo spectrum.
</p><p>Speaking of which, if there are any additional questions regarding Gentoo, check out the <a href="/wiki/FAQ" title="FAQ">Frequently Asked Questions</a> article. There are also <a rel="nofollow" class="external text" href="https://forums.gentoo.org/viewforum.php?f=40">FAQs</a> on the <a rel="nofollow" class="external text" href="https://forums.gentoo.org">Gentoo Forums</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Hardware_requirements">Hardware requirements</span></h2>
<p>Before we start, we first list what hardware requirements are needed to successfully install Gentoo on a amd64 box.
</p><p><br />
</p>
<table class="table table-striped table-condensed" style="text-align: left;">

<caption>AMD64 livedisk hardware requirements
</caption>
<tbody><tr style="background-color:#dddaec;">
<th>
</th>
<th>Minimal CD
</th>
<th>LiveDVD
</th></tr>
<tr>
<th>CPU
</th>
<td scope="row" colspan="2">Any <a href="https://en.wikipedia.org/wiki/X86-64" class="extiw" title="wikipedia:X86-64">x86-64</a> CPU, both AMD64 and Intel 64
</td></tr>
<tr>
<th>Memory
</th>
<td colspan="2">2 GB
</td></tr>
<tr>
<th>Disk space
</th>
<td colspan="2">8 GB (excluding swap space)
</td></tr>
<tr>
<th>Swap space
</th>
<td colspan="2">At least 2 GB
</td></tr></tbody></table>
<p>The <a href="/wiki/Project:AMD64" title="Project:AMD64">AMD64 project</a> is a good place to be for more information about Gentoo's <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b> support.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Gentoo_Linux_installation_media">Gentoo Linux installation media</span></h2>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />It is okay to use other, non-Gentoo installation media, although official media is recommended. Gentoo installation media ensures the necessary tools are around. When using non-Gentoo media, skip to <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.</div>
<h3><span class="mw-headline" id="Minimal_installation_CD">Minimal installation CD</span></h3>
<p>The Gentoo minimal installation CD is a bootable image: a self-contained Gentoo environment. It allows the user to boot Linux from the CD or other installation media. During the boot process the hardware is detected and the appropriate drivers are loaded. The image is maintained by Gentoo developers and allows anyone to install Gentoo if an active Internet connection is available.
</p><p>The Minimal Installation CD is called <span style="font-family: monospace; font-size: 95%">install-amd64-minimal-&lt;release&gt;.iso</span>.
</p>
<h3><span class="mw-headline" id="The_occasional_Gentoo_LiveDVD">The occasional Gentoo LiveDVD</span></h3>
<p>Occasionally, a special DVD image is crafted which can be used to install Gentoo. The instructions in this chapter target the Minimal Installation CD, so things might be a bit different when booting from the LiveDVD. However, the LiveDVD (or any other official Gentoo Linux environment) supports getting a root prompt by just invoking <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">sudo su -</span> or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">sudo -i</span> in a terminal.
</p>
<h3><span id="What_are_stages_then?"></span><span class="mw-headline" id="What_are_stages_then.3F">What are stages then?</span></h3>
<p>A stage3 tarball is an archive containing a profile specific minimal Gentoo environment. Stage3 tarballs are suitable to continue the Gentoo installation using the instructions in this handbook. Previously, the handbook described the installation using one of three <a href="/wiki/Stage_tarball" title="Stage tarball">stage tarballs</a>. Gentoo does not offer stage1 and stage2 tarballs for download any more since these are mostly for internal use and for bootstrapping Gentoo on new architectures.
</p><p>Stage3 tarballs can be downloaded from <span style="font-family: monospace; font-size: 95%">releases/amd64/autobuilds/</span> on any of the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/mirrors/">official Gentoo mirrors</a>. Stage files update frequently and are not included in official installation images.
</p>
<h2><span class="mw-headline" id="Downloading">Downloading</span></h2>
<h3><span class="mw-headline" id="Obtain_the_media">Obtain the media</span></h3>
<p>The default installation media that Gentoo Linux uses are the <i>minimal installation CDs</i>, which host a bootable, very small Gentoo Linux environment. This environment contains all the right tools to install Gentoo. The CD images themselves can be downloaded from the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/">downloads page</a> (recommended) or by manually browsing to the ISO location on one of the many <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/mirrors/">available mirrors</a>.
</p><p>If downloading from a mirror, the minimal installation CDs can be found as follows:
</p>
<ol><li>Go to the <span style="font-family: monospace; font-size: 95%">releases/</span> directory.</li>
<li>Select the directory for the relevant target architecture (such as <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64/</span></b>).</li>
<li>Select the <span style="font-family: monospace; font-size: 95%">autobuilds/</span> directory.</li>
<li>For <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b> and <b><span style="font-family: monospace; font-size: 95%; color: #54487a">x86</span></b> architectures select either the <span style="font-family: monospace; font-size: 95%">current-install-amd64-minimal/</span> or <span style="font-family: monospace; font-size: 95%">current-install-x86-minimal/</span> directory (respectively). For all other architectures navigate to the <span style="font-family: monospace; font-size: 95%">current-iso/</span> directory.</li></ol>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Some target architectures such as <b><span style="font-family: monospace; font-size: 95%; color: #54487a">arm</span></b>, <b><span style="font-family: monospace; font-size: 95%; color: #54487a">mips</span></b>, and <b><span style="font-family: monospace; font-size: 95%; color: #54487a">s390</span></b> will not have minimal install CDs. At this time the <a href="/wiki/Project:RelEng" title="Project:RelEng">Gentoo Release Engineering project</a> does not support building <span style="font-family: monospace; font-size: 95%">.iso</span> files for these targets.</div>
<p>Inside this location, the installation media file is the file with the <span style="font-family: monospace; font-size: 95%">.iso</span> suffix. For instance, take a look at the following listing:
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Example list of downloadable files at releases/amd64/autobuilds/current-iso/</strong></div><pre class="captioned">[DIR] hardened/                                          05-Dec-2014 01:42    -   
[   ] install-amd64-minimal-20141204.iso                 04-Dec-2014 21:04  208M  
[   ] install-amd64-minimal-20141204.iso.CONTENTS        04-Dec-2014 21:04  3.0K  
[   ] install-amd64-minimal-20141204.iso.DIGESTS         04-Dec-2014 21:04  740   
[TXT] install-amd64-minimal-20141204.iso.asc             05-Dec-2014 01:42  1.6K  
[   ] stage3-amd64-20141204.tar.bz2                      04-Dec-2014 21:04  198M  
[   ] stage3-amd64-20141204.tar.bz2.CONTENTS             04-Dec-2014 21:04  4.6M  
[   ] stage3-amd64-20141204.tar.bz2.DIGESTS              04-Dec-2014 21:04  720   
[TXT] stage3-amd64-20141204.tar.bz2.asc                  05-Dec-2014 01:42  1.5K</pre></div>
<p>In the above example, the <span style="font-family: monospace; font-size: 95%">install-amd64-minimal-20141204.iso</span> file is the minimal installation CD itself. But as can be seen, other related files exist as well:
</p>
<ul><li>A <span style="font-family: monospace; font-size: 95%">.CONTENTS</span> file which is a text file listing all files available on the installation media. This file can be useful to verify if particular firmware or drivers are available on the installation media before downloading it.</li>
<li>A <span style="font-family: monospace; font-size: 95%">.DIGESTS</span> file which contains the hash of the ISO file itself, in various hashing formats/algorithms. This file can be used to verify if the downloaded ISO file is corrupt or not.</li>
<li>A <span style="font-family: monospace; font-size: 95%">.asc</span> file which is a cryptographic signature of the ISO file. This can be used to both verify if the downloaded ISO file is corrupt or not, as well as verify that the download is indeed provided by the Gentoo Release Engineering team and has not been tampered with.</li></ul>
<p>Ignore the other files available at this location for now - those will come back when the installation has proceeded further. Download the <span style="font-family: monospace; font-size: 95%">.iso</span> file and, if verification of the download is wanted, download the  <span style="font-family: monospace; font-size: 95%">.iso.asc</span> file for the <span style="font-family: monospace; font-size: 95%">.iso</span> file as well. The <span style="font-family: monospace; font-size: 95%">.CONTENTS</span> file does not need to be downloaded as the installation instructions will not refer to this file anymore, and the <span style="font-family: monospace; font-size: 95%">.DIGESTS</span> is not needed if the signature in the <span style="font-family: monospace; font-size: 95%">.iso.asc</span> file is verified.
</p>
<h3><span class="mw-headline" id="Verifying_the_downloaded_files">Verifying the downloaded files</span></h3>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />This is an optional step and not necessary to install Gentoo Linux. However, it is recommended as it ensures that the downloaded file is not corrupt and has indeed been provided by the <a href="/wiki/Project:Infrastructure" title="Project:Infrastructure">Gentoo Infrastructure team</a>.</div>
<p>The <span style="font-family: monospace; font-size: 95%">.asc</span> file provides a cryptographic signature of the ISO. By validating it, one can make sure that
the installation file is provided by the Gentoo Release Engineering team and is intact and unmodified.
</p>
<h4><span class="mw-headline" id="Microsoft_Windows_based_verification">Microsoft Windows based verification</span></h4>
<p>To first verify the cryptographic signature, tools such as <a rel="nofollow" class="external text" href="https://www.gpg4win.org/">GPG4Win</a> can be used. After installation, the public keys of the Gentoo Release Engineering team need to be imported. The list of keys is available on the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/signatures/">signatures page</a>. Once imported, the user can then verify the signature in the <span style="font-family: monospace; font-size: 95%">.asc</span> file.
</p>
<h4><span class="mw-headline" id="Linux_based_verification">Linux based verification</span></h4>
<p>On a Linux system, the most common method for verifying the cryptographic signature is to use the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-crypt/gnupg">app-crypt/gnupg</a> software. With this package installed, the following command can be used to verify the cryptographic signature in the <span style="font-family: monospace; font-size: 95%">.asc</span> file.
</p><p>First, download the right set of keys as made available on the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/signatures/">signatures page</a>:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>gpg --keyserver hkps://keys.gentoo.org --recv-keys 0xBB572E0E2D182910</code></div><pre>gpg: requesting key 0xBB572E0E2D182910 from hkp server pool.sks-keyservers.net
gpg: key 0xBB572E0E2D182910: "Gentoo Linux Release Engineering (Automated Weekly Release Key) &lt;releng@gentoo.org&gt;" 1 new signature
gpg: 3 marginal(s) needed, 1 complete(s) needed, classic trust model
gpg: depth: 0  valid:   3  signed:  20  trust: 0-, 0q, 0n, 0m, 0f, 3u
gpg: depth: 1  valid:  20  signed:  12  trust: 9-, 0q, 0n, 9m, 2f, 0u
gpg: next trustdb check due at 2018-09-15
gpg: Total number processed: 1
gpg:         new signatures: 1
</pre></div>
<p>Alternatively you can use instead the <a href="/wiki/WKD" title="WKD">WKD</a> to download the key:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>gpg --auto-key-locate=clear,nodefault,wkd --locate-key releng@gentoo.org</code></div><pre>gpg: key 0x9E6438C817072058: public key "Gentoo Linux Release Engineering (Gentoo Linux Release Signing Key) &lt;releng@gentoo.org&gt;" imported
gpg: key 0xBB572E0E2D182910: public key "Gentoo Linux Release Engineering (Automated Weekly Release Key) &lt;releng@gentoo.org&gt;" imported
gpg: Total number processed: 2
gpg:               imported: 2
gpg: public key of ultimately trusted key 0x58497EE51D5D74A5 not found
gpg: public key of ultimately trusted key 0x1F3D03348DB1A3E2 not found
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   2  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 2u
pub   dsa1024/0x9E6438C817072058 2004-07-20 [SC] [expires: 2024-01-01]
      D99EAC7379A850BCE47DA5F29E6438C817072058
uid                   [ unknown] Gentoo Linux Release Engineering (Gentoo Linux Release Signing Key) &lt;releng@gentoo.org&gt;
sub   elg2048/0x0403710E1415B4ED 2004-07-20 [E] [expires: 2024-01-01]
</pre></div>
<p>Or if using official Gentoo release media, import the key from <span style="font-family: monospace; font-size: 95%">/usr/share/openpgp-keys/gentoo-release.asc</span> (provided by <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sec-keys/openpgp-keys-gentoo-release">sec-keys/openpgp-keys-gentoo-release</a>):
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>gpg --import /usr/share/openpgp-keys/gentoo-release.asc</code></div><pre>gpg: directory '/home/larry/.gnupg' created
gpg: keybox '/home/larry/.gnupg/pubring.kbx' created
gpg: key DB6B8C1F96D8BF6D: 2 signatures not checked due to missing keys
gpg: /home/larry/.gnupg/trustdb.gpg: trustdb created
gpg: key DB6B8C1F96D8BF6D: public key "Gentoo ebuild repository signing key (Automated Signing Key) &lt;infrastructure@gentoo.org&gt;" imported
gpg: key 9E6438C817072058: 3 signatures not checked due to missing keys
gpg: key 9E6438C817072058: public key "Gentoo Linux Release Engineering (Gentoo Linux Release Signing Key) &lt;releng@gentoo.org&gt;" imported
gpg: key BB572E0E2D182910: 1 signature not checked due to a missing key
gpg: key BB572E0E2D182910: public key "Gentoo Linux Release Engineering (Automated Weekly Release Key) &lt;releng@gentoo.org&gt;" imported
gpg: key A13D0EF1914E7A72: 1 signature not checked due to a missing key
gpg: key A13D0EF1914E7A72: public key "Gentoo repository mirrors (automated git signing key) &lt;repomirrorci@gentoo.org&gt;" imported
gpg: Total number processed: 4
gpg:               imported: 4
gpg: no ultimately trusted keys found
</pre></div>
<p>Next verify the cryptographic signature:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>gpg --verify install-amd64-minimal-20141204.iso.asc</code></div><pre>gpg: Signature made Fri 05 Dec 2014 02:42:44 AM CET
gpg:                using RSA key 0xBB572E0E2D182910
gpg: Good signature from "Gentoo Linux Release Engineering (Automated Weekly Release Key) &lt;releng@gentoo.org&gt;" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 13EB BDBE DE7A 1277 5DFD  B1BA BB57 2E0E 2D18 2910
</pre></div>
<p>To be absolutely certain that everything is valid, verify the fingerprint shown with the fingerprint on the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/signatures/">Gentoo signatures page</a>.
</p>
<h3><span class="mw-headline" id="Burning_a_disk">Burning a disk</span></h3>
<p>Of course, with just an ISO file downloaded, the Gentoo Linux installation cannot be started. The ISO file needs to be burned on a CD to boot from, and in such a way that its <i>content</i> is burned on the CD, not just the file itself. Below a few common methods are described - a more elaborate set of instructions can be found in <a href="/wiki/FAQ#How_do_I_burn_an_ISO_file.3F" title="FAQ">Our FAQ on burning an ISO file</a>.
</p>
<h4><span class="mw-headline" id="Burning_with_Microsoft_Windows_7_and_above">Burning with Microsoft Windows 7 and above</span></h4>
<p>Versions of Microsoft Windows 7 and above can both mount and burn ISO images to optical media without the requirement for third-party software. Simply insert a burnable disk, browse to the downloaded ISO files, right click the file in Windows Explorer, and select "Burn disk image".
</p>
<h4><span class="mw-headline" id="Burning_with_Linux">Burning with Linux</span></h4>
<p>The <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">cdrecord</span> utility from the package <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-cdr/cdrtools">app-cdr/cdrtools</a> can burn ISO images on Linux.
</p><p>To burn the ISO file on the CD in the <span style="font-family: monospace; font-size: 95%">/dev/sr0</span> device (this is the first CD device on the system - substitute with the right device file if necessary):
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>cdrecord dev=/dev/sr0 install-amd64-minimal-20141204.iso</code></div></div>
<p>Users that prefer a graphical user interface can use K3B, part of the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/kde-apps/k3b">kde-apps/k3b</a> package. In K3B, go to <span style="font-family: monospace; font-size: 95%">Tools</span> and use <span style="font-family: monospace; font-size: 95%">Burn CD Image</span>.
</p>
<h2><span class="mw-headline" id="Booting">Booting</span></h2>
<h3><span class="mw-headline" id="Booting_the_installation_media">Booting the installation media</span></h3>
<p>Once the installation media is ready, it is time to boot it. Insert the media in the system, reboot, and enter the motherboard's firmware user interface. This is usually performed by pressing a keyboard key such as <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">DEL</kbd>, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd>, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F10</kbd>, or <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">ESC</kbd> during the Power-On Self-test (POST) process. The 'trigger' key varies depending on the system and motherboard. If it is not obvious use an internet search engine and do some research using the motherboard's model name as the search keyword. Results should be easy to determine. Once inside the motherboard's firmware menu, change the boot order so that the external bootable media (CD/DVD disks or USB drives) are tried <i>before</i> the internal disk devices. Without this change, the system will most likely reboot to the internal disk device, ignoring the external boot media.
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />When installing Gentoo with the purpose of using the UEFI interface instead of BIOS, it is recommended to boot with UEFI immediately. If not, then it might be necessary to create a bootable UEFI USB stick (or other medium) once before finalizing the Gentoo Linux installation.</div>
<p>If not yet done, ensure that the installation media is inserted or plugged into the system, and reboot. A boot prompt should be shown. At this screen, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> will begin the boot process with the default boot options. To boot the installation media with custom boot options, specify a kernel followed by boot options and then hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />In all likelihood, the default gentoo kernel, as mentioned above, without specifying any of the optional parameters will work just fine. For boot troubleshooting and expert options, continue on with this section. Otherwise, just press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> and skip ahead to <a href="/wiki/Handbook:AMD64/Installation/Media#Extra_hardware_configuration" title="Handbook:AMD64/Installation/Media">Extra hardware configuration</a>.</div>
<p>At the boot prompt, users get the option of displaying the available kernels (<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd>) and boot options (<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F2</kbd>). If no choice is made within 15 seconds (either displaying information or using a kernel) then the installation media will fall back to booting from disk. This allows installations to reboot and try out their installed environment without the need to remove the CD from the tray (something well appreciated for remote installations).
</p><p>Specifying a kernel was mentioned. On the Minimal installation media, only two predefined kernel boot options are provided. The default option is called <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">gentoo</span>. The other being the <i>-nofb</i> variant; this disables kernel framebuffer support.
</p><p>The next section displays a short overview of the available kernels and their descriptions:
</p>
<h4><span class="mw-headline" id="Kernel_choices">Kernel choices</span></h4>
<dl><dt>gentoo</dt>
<dd>Default kernel with support for K8 CPUs (including NUMA support) and EM64T CPUs.</dd>
<dt>gentoo-nofb</dt>
<dd>Same as <i>gentoo</i> but without framebuffer support.</dd>
<dt>memtest86</dt>
<dd>Test the local RAM for errors.</dd></dl>
<p>Alongside the kernel, boot options help in tuning the boot process further. 
</p>
<h4><span class="mw-headline" id="Hardware_options">Hardware options</span></h4>
<dl><dt>acpi=on</dt>
<dd>This loads support for ACPI and also causes the acpid daemon to be started by the CD on boot. This is only needed if the system requires ACPI to function properly. This is not required for Hyperthreading support.</dd>
<dt>acpi=off</dt>
<dd>Completely disables ACPI. This is useful on some older systems and is also a requirement for using APM. This will disable any Hyperthreading support of your processor.</dd>
<dt>console=X</dt>
<dd>This sets up serial console access for the CD. The first option is the device, usually ttyS0, followed by any connection options, which are comma separated. The default options are 9600,8,n,1.</dd>
<dt>dmraid=X</dt>
<dd>This allows for passing options to the device-mapper RAID subsystem. Options should be encapsulated in quotes.</dd>
<dt>doapm</dt>
<dd>This loads APM driver support. This also requires that <code>acpi=off</code>.</dd>
<dt>dopcmcia</dt>
<dd>This loads support for PCMCIA and Cardbus hardware and also causes the pcmcia cardmgr to be started by the CD on boot. This is only required when booting from PCMCIA/Cardbus devices.</dd>
<dt>doscsi</dt>
<dd>This loads support for most SCSI controllers. This is also a requirement for booting most USB devices, as they use the SCSI subsystem of the kernel.</dd>
<dt>sda=stroke</dt>
<dd>This allows the user to partition the whole hard disk even when the BIOS is unable to handle large disks. This option is only used on machines with an older BIOS. Replace sda with the device that requires this option.</dd>
<dt>ide=nodma</dt>
<dd>This forces the disabling of DMA in the kernel and is required by some IDE chipsets and also by some CDROM drives. If the system is having trouble reading from the IDE CDROM, try this option. This also disables the default hdparm settings from being executed.</dd>
<dt>noapic</dt>
<dd>This disables the Advanced Programmable Interrupt Controller that is present on newer motherboards. It has been known to cause some problems on older hardware.</dd>
<dt>nodetect</dt>
<dd>This disables all of the autodetection done by the CD, including device autodetection and DHCP probing. This is useful for debugging a failing CD or driver.</dd>
<dt>nodhcp</dt>
<dd>This disables DHCP probing on detected network cards. This is useful on networks with only static addresses.</dd>
<dt>nodmraid</dt>
<dd>Disables support for device-mapper RAID, such as that used for on-board IDE/SATA RAID controllers.</dd>
<dt>nofirewire</dt>
<dd>This disables the loading of Firewire modules. This should only be necessary if your Firewire hardware is causing a problem with booting the CD.</dd>
<dt>nogpm</dt>
<dd>This disables gpm console mouse support.</dd>
<dt>nohotplug</dt>
<dd>This disables the loading of the hotplug and coldplug init scripts at boot. This is useful for debugging a failing CD or driver.</dd>
<dt>nokeymap</dt>
<dd>This disables the keymap selection used to select non-US keyboard layouts.</dd>
<dt>nolapic</dt>
<dd>This disables the local APIC on Uniprocessor kernels.</dd>
<dt>nosata</dt>
<dd>This disables the loading of Serial ATA modules. This is used if the system is having problems with the SATA subsystem.</dd>
<dt>nosmp</dt>
<dd>This disables SMP, or Symmetric Multiprocessing, on SMP-enabled kernels. This is useful for debugging SMP-related issues with certain drivers and motherboards.</dd>
<dt>nosound</dt>
<dd>This disables sound support and volume setting. This is useful for systems where sound support causes problems.</dd>
<dt>nousb</dt>
<dd>This disables the autoloading of USB modules. This is useful for debugging USB issues.</dd>
<dt>slowusb</dt>
<dd>This adds some extra pauses into the boot process for slow USB CDROMs, like in the IBM BladeCenter.</dd></dl>
<h4><span id="Logical_volume/device_management"></span><span class="mw-headline" id="Logical_volume.2Fdevice_management">Logical volume/device management</span></h4>
<dl><dt>dolvm</dt>
<dd>This enables support for Linux's Logical Volume Management.</dd></dl>
<h4><span class="mw-headline" id="Other_options">Other options</span></h4>
<dl><dt>debug</dt>
<dd>Enables debugging code. This might get messy, as it displays a lot of data to the screen.</dd>
<dt>docache</dt>
<dd>This caches the entire runtime portion of the CD into RAM, which allows the user to umount <span style="font-family: monospace; font-size: 95%">/mnt/cdrom</span> and mount another CDROM. This option requires that there is at least twice as much available RAM as the size of the CD.</dd>
<dt>doload=X</dt>
<dd>This causes the initial ramdisk to load any module listed, as well as dependencies. Replace X with the module name. Multiple modules can be specified by a comma-separated list.</dd>
<dt>dosshd</dt>
<dd>Starts sshd on boot, which is useful for unattended installs.</dd>
<dt>passwd=foo</dt>
<dd>Sets whatever follows the equals as the root password, which is required for <i>dosshd</i> since the root password is by default scrambled.</dd>
<dt>noload=X</dt>
<dd>This causes the initial ramdisk to skip the loading of a specific module that may be causing a problem. Syntax matches that of doload.</dd>
<dt>nonfs</dt>
<dd>Disables the starting of portmap/nfsmount on boot.</dd>
<dt>nox</dt>
<dd>This causes an X-enabled LiveCD to not automatically start X, but rather, to drop to the command line instead.</dd>
<dt>scandelay</dt>
<dd>This causes the CD to pause for 10 seconds during certain portions the boot process to allow for devices that are slow to initialize to be ready for use.</dd>
<dt>scandelay=X</dt>
<dd>This allows the user to specify a given delay, in seconds, to be added to certain portions of the boot process to allow for devices that are slow to initialize to be ready for use. Replace X with the number of seconds to pause.</dd></dl>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The bootable media will check for <code>no*</code> options before <code>do*</code> options, so that options can be overridden in the exact order specified.</div>
<p>Now boot the media, select a kernel (if the default <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">gentoo</span> kernel does not suffice) and boot options. As an example, we boot the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">gentoo</span> kernel, with <code>dopcmcia</code> as a kernel parameter:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">boot:</code><span class="tripleclick-separator"></span><code>gentoo dopcmcia</code></div></div>
<p>Next the user will be greeted with a boot screen and progress bar. If the installation is done on a system with a non-US keyboard, make sure to immediately press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd> to switch to verbose mode and follow the prompt. If no selection is made in 10 seconds the default (US keyboard) will be accepted and the boot process will continue. Once the boot process completes, the user is automatically logged in to the "Live" Gentoo Linux environment as the <i>root</i> user, the super user. A root prompt is displayed on the current console, and one can switch to other consoles by pressing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F2</kbd>, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F3</kbd> and <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F4</kbd>. Get back to the one started on by pressing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd>.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Extra_hardware_configuration">Extra hardware configuration</span></h3>
<p>When the Installation medium boots, it tries to detect all the hardware devices and loads the appropriate kernel modules to support the hardware. In the vast majority of cases, it does a very good job. However, in some cases it may not auto-load the kernel modules needed by the system. If the PCI auto-detection missed some of the system's hardware, the appropriate kernel modules have to be loaded manually.
</p><p>In the next example the 8139too module (which supports certain kinds of network interfaces) is loaded:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>modprobe 8139too</code></div></div> 
<h3><span class="mw-headline" id="Optional:_User_accounts">Optional: User accounts</span></h3>
<p>If other people need access to the installation environment, or there is need to run commands as a non-root user on the installation medium (such as to chat using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">irssi</span> without root privileges for security reasons), then an additional user account needs to be created and the root password set to a strong password.
</p><p>To change the root password, use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">passwd</span> utility:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>passwd</code></div><pre>New password: (Enter the new password)
Re-enter password: (Re-enter the password)
</pre></div>
<p>To create a user account, first enter their credentials, followed by the account's password. The <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">useradd</span> and <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">passwd</span> commands are used for these tasks.
</p><p>In the next example, a user called <i>john</i> is created:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>useradd -m -G users john
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>passwd john</code></div><pre>New password: (Enter john's password)
Re-enter password: (Re-enter john's password)
</pre></div>
<p>To switch from the (current) <i>root</i> user to the newly created user account, use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">su</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>su - john</code></div></div>
<h3><span class="mw-headline" id="Optional:_Viewing_documentation_while_installing">Optional: Viewing documentation while installing</span></h3>
<h4><span class="mw-headline" id="TTYs">TTYs</span></h4>
<p>To view the Gentoo handbook during the installation, first create a user account as described above. Then press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F2</kbd> to go to a new terminal (TTY).
</p><p>During the installation, the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span> command can be used to browse the Gentoo handbook - of course only from the moment that the Internet connection is working.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>links https://wiki.gentoo.org/wiki/Handbook:AMD64</code></div></div>
<p>To go back to the original terminal, press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd>.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />When booted to the Gentoo minimal or Gentoo admin environments, seven TTYs will be available. They can be switched by pressing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Alt</kbd> then a function key between <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F1</kbd>-<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">F7</kbd>. It can be useful to switch to a new terminal when waiting for job to complete, to open documentation, etc.</div>
<h4><span class="mw-headline" id="GNU_Screen">GNU Screen</span></h4>
<p>The <a href="/wiki/Screen" title="Screen">Screen</a> utility is installed by default on official Gentoo installation media. It may be more efficient for the seasoned Linux enthusiast to use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">screen</span> to view installation instructions via split panes rather than the multiple TTY method mentioned above.
</p>
<h3><span class="mw-headline" id="Optional:_Starting_the_SSH_daemon">Optional: Starting the SSH daemon</span></h3>
<p>To allow other users to access the system during the installation (perhaps to support during an installation, or even do it remotely), a user account needs to be created (as was documented earlier on) and the SSH daemon needs to be started.
</p><p>To fire up the SSH daemon on an OpenRC init, execute the following command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-service sshd start</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If users log on to the system, they will see a message that the host key for this system needs to be confirmed (through what is called a fingerprint). This behavior is typical and can be expected for initial connections to an SSH server. However, later when the system is set up and someone logs on to the newly created system, the SSH client will warn that the host key has been changed. This is because the user now logs on to - for SSH - a different server (namely the freshly installed Gentoo system rather than the live environment that the installation is currently using). Follow the instructions given on the screen then to replace the host key on the client system.</div>
<p>To be able to use sshd, the network needs to function properly. Continue with the chapter on <a href="/wiki/Handbook:AMD64/Installation/Networking" title="Handbook:AMD64/Installation/Networking">Configuring the network</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Automatic_network_detection">Automatic network detection</span></h2>
<p>Maybe it just works?
</p><p>If the system is plugged into an Ethernet network with a DHCP server, it is very likely that the networking configuration has already been set up automatically. If so, then the many included network-aware commands on the installation media such as <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ssh</span>, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">scp</span>, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ping</span>, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">irssi</span>, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">wget</span>, and <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span>, among others, will work immediately.
</p>
<h3><span class="mw-headline" id="Determine_interface_names">Determine interface names</span></h3>
<h4><span class="mw-headline" id="ifconfig_command">ifconfig command</span></h4>
<p>If networking has been configured, the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span> command should list one or more network interfaces (besides <span style="font-family: monospace; font-size: 95%">lo</span>). In the example below <span style="font-family: monospace; font-size: 95%">eth0</span> shows up:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ifconfig</code></div><pre>eth0      Link encap:Ethernet  HWaddr 00:50:BA:8F:61:7A
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::50:ba8f:617a/10 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1498792 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1284980 errors:0 dropped:0 overruns:0 carrier:0
          collisions:1984 txqueuelen:100
          RX bytes:485691215 (463.1 Mb)  TX bytes:123951388 (118.2 Mb)
          Interrupt:11 Base address:0xe800 
</pre></div>
<p>As a result of the shift towards <a rel="nofollow" class="external text" href="http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/">predictable network interface names</a>, the interface name on the system can be quite different from the old <span style="font-family: monospace; font-size: 95%">eth0</span> naming convention. Recent installation media might show regular network interfaces names like <span style="font-family: monospace; font-size: 95%">eno0</span>, <span style="font-family: monospace; font-size: 95%">ens1</span>, or <span style="font-family: monospace; font-size: 95%">enp5s0</span>. Look for the interface in the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span> output that has an IP address related to the local network.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />If no interfaces are displayed when the standard <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span> command is used, try using the same command with the <code>-a</code> option. This option forces the utility to show all network interfaces detected by the system whether they be in an up or down state. If <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig -a</span> produces no results then the hardware is faulty or the driver for the interface has not been loaded into the kernel. Both situations reach beyond the scope of this Handbook. Contact <span style="font-family: monospace; font-size: 95%;"><a rel="nofollow" class="external text" href="ircs://irc.libera.chat/#gentoo">#gentoo</a></span> (<span style="font-family: monospace; font-size: 95%;"><a rel="nofollow" class="external text" href="https://web.libera.chat/#gentoo">webchat</a></span>) for support.</div>
<h4><span class="mw-headline" id="ip_command">ip command</span></h4>
<p>As an alternative to <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span>, the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ip</span> command can be used to determine interface names. The following example shows the output of <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ip addr</span> (of another system so the information shown is different from the previous example):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ip addr</code></div><pre>2: eno1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether e8:40:f2:ac:25:7a brd ff:ff:ff:ff:ff:ff
    inet 10.0.20.77/22 brd 10.0.23.255 scope global eno1
       valid_lft forever preferred_lft forever
    inet6 fe80::ea40:f2ff:feac:257a/64 scope link 
       valid_lft forever preferred_lft forever
</pre></div>
<p>The output above may be a bit more complicated to read than alternative. The interface name in the above example directly follows the number; it is <span style="font-family: monospace; font-size: 95%">eno1</span>.
</p><p>In the remainder of this document, the handbook will assume that the operating network interface is called <span style="font-family: monospace; font-size: 95%">eth0</span>.
</p>
<h3><span class="mw-headline" id="Optional:_Configure_any_proxies">Optional: Configure any proxies</span></h3>
<p>If the Internet is accessed through a proxy, then it is necessary to set up proxy information during the installation. It is very easy to define a proxy: just define a variable which contains the proxy server information.
</p><p>In most cases, it is sufficient to define the variables using the server hostname. As an example, we assume the proxy is called proxy.gentoo.org and the port is 8080.
</p><p>To set up an HTTP proxy (for HTTP and HTTPS traffic):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export http_proxy="http://proxy.gentoo.org:8080"</code></div></div>
<p>To set up an FTP proxy:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export ftp_proxy="ftp://proxy.gentoo.org:8080"</code></div></div>
<p>To set up an RSYNC proxy:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export RSYNC_PROXY="proxy.gentoo.org:8080"</code></div></div>
<p>If the proxy requires a username and password, use the following syntax for the variable:
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Adding username/password to the proxy variable</strong></div><pre class="captioned">http://username:password@proxy.gentoo.org:8080</pre></div>
<h3><span class="mw-headline" id="Testing_the_network">Testing the network</span></h3>
<p>Try pinging your ISP's DNS server (found in <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span>) and a web site of choice. This ensures that the network is functioning properly and that the network packets are reaching the net, DNS name resolution is working correctly, etc.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ping -c 3 www.gentoo.org</code></div></div>
<p>If this all works, then the remainder of this chapter can be skipped to jump right to the next step of the installation instructions (<a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>).
</p>
<h2><span class="mw-headline" id="Automatic_network_configuration">Automatic network configuration</span></h2>
<p>If the network doesn't work immediately, some installation media allow the user to use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> (for regular or wireless networks), <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pppoe-setup</span> (for ADSL users) or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pptp</span> (for PPTP users).
</p><p>If the installation medium does not contain any of these tools, continue with the <a href="#Manual_network_configuration">Manual network configuration</a>.
</p>
<ul><li>Regular Ethernet users should continue with <a href="#Default:_Using_net-setup">Default: Using net-setup</a></li>
<li>ADSL users should continue with <a href="#Alternative:_Using_PPP">Alternative: Using PPP</a></li>
<li>PPTP users should continue with <a href="#Alternative:_Using_PPTP">Alternative: Using PPTP</a></li></ul>
<h3><span class="mw-headline" id="Default:_Using_net-setup">Default: Using net-setup</span></h3>
<p>The simplest way to set up networking if it didn't get configured automatically is to run the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> script:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>net-setup eth0</code></div></div>
<p><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> will ask some questions about the network environment. When all is done, the network connection should work. Test the network connection as stated before. If the tests are positive, congratulations! Skip the rest of this section and continue with <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.
</p><p>If the network still doesn't work, continue with <a href="#Manual_network_configuration">Manual network configuration</a>.
</p>
<h3><span class="mw-headline" id="Alternative:_Using_PPP">Alternative: Using PPP</span></h3>
<p>Assuming PPPoE is needed to connect to the Internet, the installation CD (any version) has made things easier by including ppp. Use the provided <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pppoe-setup</span> script to configure the connection. During the setup the Ethernet device that is connected to your ADSL modem, the username and password, the IPs of the DNS servers and if a basic firewall is needed or not will be asked.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>pppoe-setup
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>pppoe-start</code></div></div>
<p>If something goes wrong, double-check that the username and password are correct by looking at <span style="font-family: monospace; font-size: 95%">etc/ppp/pap-secrets</span> or <span style="font-family: monospace; font-size: 95%">/etc/ppp/chap-secrets</span> and make sure to use the right Ethernet device. If the Ethernet device does not exist, the appropriate network modules need to be loaded. In that case continue with <a href="#Manual_network_configuration">Manual network configuration</a> as it will explain how to load the appropriate network modules there.
</p><p>If everything worked, continue with <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.
</p>
<h3><span class="mw-headline" id="Alternative:_Using_PPTP">Alternative: Using PPTP</span></h3>
<p>If PPTP support is needed, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pptpclient</span> which is provided by the installation CDs. But first make sure that the configuration is correct. Edit <span style="font-family: monospace; font-size: 95%">/etc/ppp/pap-secrets</span> or <span style="font-family: monospace; font-size: 95%">/etc/ppp/chap-secrets</span> so it contains the correct username/password combination:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/ppp/chap-secrets</code></div></div>
<p>Then adjust <span style="font-family: monospace; font-size: 95%">/etc/ppp/options.pptp</span> if necessary:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/ppp/options.pptp</code></div></div>
<p>When all that is done, run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pptp</span> (along with the options that couldn't be set in <span style="font-family: monospace; font-size: 95%">options.pptp</span>) to connect the server:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>pptp &lt;server ipv4 address&gt;</code></div></div>
<p>Now continue with <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.
</p>
<h2><span class="mw-headline" id="Manual_network_configuration">Manual network configuration</span></h2>
<h3><span class="mw-headline" id="Loading_the_appropriate_network_kernel_modules">Loading the appropriate network kernel modules</span></h3>
<p>When the Installation CD boots, it tries to detect all the hardware devices and loads the appropriate kernel modules (drivers) to support the hardware. In the vast majority of cases, it does a very good job. However, in some cases, it may not auto-load the kernel modules needed to communicate properly with the present network hardware.
</p><p>If <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pppoe-setup</span> failed, then it is possible that the network card wasn't found immediately. This means users may have to load the appropriate kernel modules manually.
</p><p>To find out what kernel modules are provided for networking, use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ls</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls /lib/modules/`uname -r`/kernel/drivers/net</code></div></div>
<p>If a driver is found for the network device, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">modprobe</span> to load the kernel module. For instance, to load the <span style="font-family: monospace; font-size: 95%">pcnet32</span> module:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>modprobe pcnet32</code></div></div>
<p>To check if the network card is now detected, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span>. A detected network card would result in something like this (again, <span style="font-family: monospace; font-size: 95%">eth0</span> here is just an example):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ifconfig eth0</code></div><pre>eth0      Link encap:Ethernet  HWaddr FE:FD:00:00:00:00  
          BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</pre></div>
<p>If however the following error is shown, the network card is not detected:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ifconfig eth0</code></div><pre>eth0: error fetching interface information: Device not found
</pre></div>
<p>The available network interface names on the system can be listed through the <span style="font-family: monospace; font-size: 95%">/sys</span> file system:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls /sys/class/net</code></div><pre>dummy0  eth0  lo  sit0  tap0  wlan0
</pre></div>
<p>In the above example, 6 interfaces are found. The <span style="font-family: monospace; font-size: 95%">eth0</span> one is most likely the (wired) Ethernet adapter whereas <span style="font-family: monospace; font-size: 95%">wlan0</span> is the wireless one.
</p><p>Assuming that the network card is now detected, retry <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">pppoe-setup</span> again (which should work now), but for the hardcore people we explain how to configure the network manually as well.
</p><p>Select one of the following sections based on your network setup:
</p>
<ul><li><a href="#Using_DHCP">Using DHCP</a> for automatic IP retrieval</li>
<li><a href="#Preparing_for_wireless_access">Preparing for wireless access</a> if a wireless network is used</li>
<li><a href="#Understanding_network_terminology">Understanding network terminology</a> explains the basics about networking</li>
<li><a href="#Using_ifconfig_and_route">Using ifconfig and route</a> explains how to set up networking manually</li></ul>
<h3><span class="mw-headline" id="Using_DHCP">Using DHCP</span></h3>
<p>DHCP (Dynamic Host Configuration Protocol) makes it possible to automatically receive networking information (IP address, netmask, broadcast address, gateway, nameservers etc.). This only works if a DHCP server is in the network (or if the ISP provider provides a DHCP service). To have a network interface receive this information automatically, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">dhcpcd</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>dhcpcd eth0</code></div></div>
<p>Some network administrators require that the hostname and domainname provided by the DHCP server is used by the system. In that case, use:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>dhcpcd -HD eth0</code></div></div>
<p>If this works (try pinging some Internet server, like Google's 8.8.8.8 or Cloudflare's 1.1.1.1), then everything is set and ready to continue. Skip the rest of this section and continue with <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.
</p>
<h3><span class="mw-headline" id="Preparing_for_wireless_access">Preparing for wireless access</span></h3>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Support for the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw</span> command might be architecture-specific. If the command is not available see if the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-wireless/iw">net-wireless/iw</a> package is available for the current architecture. The <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw</span> command will be unavailable unless the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-wireless/iw">net-wireless/iw</a> package has been installed.</div>
<p>When using a wireless (802.11) card, the wireless settings need to be configured before going any further. To see the current wireless settings on the card, one can use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw</span>. Running <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw</span> might show something like:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 info</code></div><pre>Interface wlp9s0
	ifindex 3
	wdev 0x1
	addr 00:00:00:00:00:00
	type managed
	wiphy 0
	channel 11 (2462 MHz), width: 20 MHz (no HT), center1: 2462 MHz
	txpower 30.00 dBm
</pre></div>
<p>To check for a current connection:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 link</code></div><pre>Not connected.</pre></div>
<p>or
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 link</code></div><pre>Connected to 00:00:00:00:00:00 (on wlp9s0)
	SSID: GentooNode
	freq: 2462
	RX: 3279 bytes (25 packets)
	TX: 1049 bytes (7 packets)
	signal: -23 dBm
	tx bitrate: 1.0 MBit/s
</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Some wireless cards may have a device name of <span style="font-family: monospace; font-size: 95%">wlan0</span> or <span style="font-family: monospace; font-size: 95%">ra0</span> instead of wlp9s0. Run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ip link</span> to determine the correct device name.</div>
<p>For most users, there are only two settings needed to connect, the ESSID (aka wireless network name) and, optionally, the WEP key.
</p>
<ul><li>First, ensure the interface is active:</li></ul>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ip link set dev wlp9s0 up</code></div></div></dd></dl>
<ul><li>To connect to an open network with the name <i>GentooNode</i>:</li></ul>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 connect -w GentooNode</code></div></div></dd></dl>
<ul><li>To connect with a hex WEP key, prefix the key with <code>d:</code>:</li></ul>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 connect -w GentooNode key 0:d:1234123412341234abcd</code></div></div></dd></dl>
<ul><li>To connect with an ASCII WEP key:</li></ul>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>iw dev wlp9s0 connect -w GentooNode key 0:some-password</code></div></div></dd></dl>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If the wireless network is set up with WPA or WPA2, then <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">wpa_supplicant</span> needs to be used. For more information on configuring wireless networking in Gentoo Linux, please read the <a href="/wiki/Handbook:AMD64/Networking/Wireless" title="Handbook:AMD64/Networking/Wireless">Wireless networking chapter</a> in the Gentoo Handbook.</div>
<p>Confirm the wireless settings by using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw dev wlp9s0 link</span>. Once wireless is working, continue configuring the IP level networking options as described in the next section (<a href="#Understanding_network_terminology">Understanding network terminology</a>) or use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">net-setup</span> tool as described previously.
</p>
<h3><span class="mw-headline" id="Understanding_network_terminology">Understanding network terminology</span></h3>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If the IP address, broadcast address, netmask and nameservers are known, then skip this subsection and continue with <a href="#Using_ifconfig_and_route">Using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span> and <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">route</span></a>.</div>
<p>If all of the above fails, the network will need to be configured manually. This is not difficult at all. However, some knowledge of network terminology and basic concepts might be necessary. After reading this section, users will know what a gateway is, what a netmask serves for, how a broadcast address is formed and why systems need nameservers.
</p><p>In a network, hosts are identified by their IP address (Internet Protocol address). Such an address is perceived as a combination of four numbers between 0 and 255. Well, at least when using IPv4 (IP version 4). In reality, such an IPv4 address consists of 32 bits (ones and zeros). Let's view an example:
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Example of an IPv4 address</strong></div><pre class="captioned">IP Address (numbers):   192.168.0.2
IP Address (bits):      11000000 10101000 00000000 00000010
                        -------- -------- -------- --------
                           192      168       0        2</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The successor of IPv4, IPv6, uses 128 bits (ones and zeros). In this section, the focus is on IPv4 addresses.</div>
<p>Such an IP address is unique to a host as far as all accessible networks are concerned (i.e. every host that one wants to be able to reach must have a unique IP address). In order to distinguish between hosts inside and outside a network, the IP address is divided in two parts: the network part and the host part.
</p><p>The separation is written down with the netmask, a collection of ones followed by a collection of zeros. The part of the IP that can be mapped on the ones is the network-part, the other one is the host-part. As usual, the netmask can be written down as an IP address.
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Example of network/host separation</strong></div><pre class="captioned">IP address:    192      168      0         2
            11000000 10101000 00000000 00000010
Netmask:    11111111 11111111 11111111 00000000
               255      255     255        0
           +--------------------------+--------+
                    Network              Host</pre></div>
<p>In other words, 192.168.0.14 is part of the example network, but 192.168.1.2 is not.
</p><p>The broadcast address is an IP address with the same network-part as the network, but with only ones as host-part. Every host on the network listens to this IP address. It is truly meant for broadcasting packets.
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Broadcast address</strong></div><pre class="captioned">IP address:    192      168      0         2
            11000000 10101000 00000000 00000010
Broadcast:  11000000 10101000 00000000 11111111
               192      168      0        255
           +--------------------------+--------+
                     Network             Host</pre></div>
<p>To be able to surf on the Internet, each computer in the network must know which host shares the Internet connection. This host is called the gateway. Since it is a regular host, it has a regular IP address (for instance 192.168.0.1).
</p><p>Previously we stated that every host has its own IP address. To be able to reach this host by a name (instead of an IP address) we need a service that translates a name (such as dev.gentoo.org) to an IP address (such as 64.5.62.82). Such a service is called a <i>name service</i>. To use such a service, the necessary name servers need to be defined in <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span>.
</p><p>In some cases, the gateway also serves as a nameserver. Otherwise the nameservers provided by the ISP need to be entered in this file.
</p><p>To summarize, the following information is needed before continuing:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec">
<th scope="col" width="15%">Network item
</th>
<th>Example
</th></tr>
<tr>
<td>The system IP address
</td>
<td>192.168.0.2
</td></tr>
<tr>
<td>Netmask
</td>
<td>255.255.255.0
</td></tr>
<tr>
<td>Broadcast
</td>
<td>192.168.0.255
</td></tr>
<tr>
<td>Gateway
</td>
<td>192.168.0.1
</td></tr>
<tr>
<td>Nameserver(s)
</td>
<td>195.130.130.5, 195.130.130.133
</td></tr></tbody></table>
<h3><span class="mw-headline" id="Using_ifconfig_and_route">Using ifconfig and route</span></h3>
<p>Employing tools from the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-apps/net-tools">sys-apps/net-tools</a> package, setting up the network manually generally consists of three steps:
</p>
<ol><li>Assign an IP address using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ifconfig</span> command.</li>
<li>Set up routing to the gateway using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">route</span> command.</li>
<li>Finish up by placing valid nameserver IPs in the <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span> file.</li></ol>
<p>To assign an IP address, the IP address, broadcast address, and netmask are needed. Execute the following command, substituting <var>${IP_ADDR}</var> with the target IP address, <var>${BROADCAST}</var> with the target broadcast address, and <var>${NETMASK}</var> with the target netmask:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ifconfig eth0 ${IP_ADDR} broadcast ${BROADCAST} netmask ${NETMASK} up</code></div></div>
<p>To configure routing using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">route</span>, substitute the <var>${GATEWAY}</var> value with the appropriate gateway IP address:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>route add default gw ${GATEWAY} </code></div></div>
<p>Now open the <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span> file using a text editor:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/resolv.conf</code></div></div>
<p>Fill in the nameserver(s) using the following as a template substituting <var>${NAMESERVER1}</var> and <var>${NAMESERVER2}</var> with nameserver IP addresses as necessary. More than one nameserver can be added:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/resolv.conf</code></strong><strong>Default resolv.conf template</strong></div><pre class="captioned">nameserver ${NAMESERVER1}
nameserver ${NAMESERVER2}</pre>
<p>Now test the network by pinging an Internet server (like Google's 8.8.8.8 or Cloudflare's 1.1.1.1). Once connected, continue with <a href="/wiki/Handbook:AMD64/Installation/Disks" title="Handbook:AMD64/Installation/Disks">Preparing the disks</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Introduction_to_block_devices">Introduction to block devices</span></h2>
<h3><span class="mw-headline" id="Block_devices">Block devices</span></h3>
<p>Let's take a good look at disk-oriented aspects of Gentoo Linux and Linux in general, including block devices, partitions, and Linux filesystems. Once the ins and outs of disks are understood, partitions and filesystems can be established for installation.
</p><p>To begin, let's look at block devices. SCSI and Serial ATA drives are both labeled under device handles such as: <span style="font-family: monospace; font-size: 95%">/dev/sda</span>, <span style="font-family: monospace; font-size: 95%">/dev/sdb</span>, <span style="font-family: monospace; font-size: 95%">/dev/sdc</span>, etc. On more modern machines, PCI Express based NVMe solid state disks have device handles such as <span style="font-family: monospace; font-size: 95%">/dev/nvme0n1</span>, <span style="font-family: monospace; font-size: 95%">/dev/nvme0n2</span>, etc.
</p><p>The following table will help readers determine where to find a certain type of block device on the system:
</p>
<table class="table table-striped table-condensed">

<tbody><tr style="background-color:#dddaec">
<th>Type of device</th>
<th>Default device handle</th>
<th>Editorial notes and considerations
</th></tr>
<tr>
<td>SATA, SAS, SCSI, or USB flash</td>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda</span></td>
<td>Found on hardware from roughly 2007 until the present, this device handle is perhaps the most commonly used in Linux. These types of devices can be connected via the <a href="https://en.wikipedia.org/wiki/Serial_ATA" class="extiw" title="wikipedia:Serial ATA">SATA bus</a>, <a href="https://en.wikipedia.org/wiki/SCSI" class="extiw" title="wikipedia:SCSI">SCSI</a>, <a href="https://en.wikipedia.org/wiki/USB" class="extiw" title="wikipedia:USB">USB</a> bus as block storage. As example, the first partition on the first SATA device is called  <span style="font-family: monospace; font-size: 95%">/dev/sda1</span>.
</td></tr>
<tr>
<td>NVM Express (NVMe)</td>
<td><span style="font-family: monospace; font-size: 95%">/dev/nvme0n1</span></td>
<td>The latest in solid state technology, <a href="https://en.wikipedia.org/wiki/NVM_Express" class="extiw" title="wikipedia:NVM Express">NVMe</a> drives are connected to the PCI Express bus and have the fastest transfer block speeds on the market. Systems from around 2014 and newer may have support for NVMe hardware. The first partition on the first NVMe device is called <span style="font-family: monospace; font-size: 95%">/dev/nvme0n1p1</span>.
</td></tr>
<tr>
<td>MMC, eMMC, and SD</td>
<td><span style="font-family: monospace; font-size: 95%">/dev/mmcblk0</span></td>
<td><a href="https://en.wikipedia.org/wiki/MultiMediaCard#eMMC" class="extiw" title="wikipedia:MultiMediaCard">embedded MMC</a> devices, SD cards, and other types of memory cards can be useful for data storage. That said, many systems may not permit booting from these types of devices. It is suggested to <b>not</b> use these devices for active Linux installations; rather consider using them to transfer files, which is their design goal. Alternatively they could be useful for short-term backups.
</td></tr></tbody></table>
<p>The block devices above represent an abstract interface to the disk. User programs can use these block devices to interact with the disk without worrying about whether the drives are SATA, SCSI, or something else. The program can simply address the storage on the disk as a bunch of contiguous, randomly-accessible 4096-byte (4K) blocks.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Partition_tables">Partition tables</span></h3>
<p>Although it is theoretically possible to use a raw, unpartitioned disk to house a Linux system (when creating a btrfs RAID for example), this is almost never done in practice. Instead, disk block devices are split up into smaller, more manageable block devices. On <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b> systems, these are called partitions. There are currently two standard partitioning technologies in use: MBR (sometimes also called DOS disklabel) and GPT; these are tied to the two boot process types: legacy BIOS boot and UEFI.
</p>
<h4><span id="GUID_Partition_Table_(GPT)"></span><span class="mw-headline" id="GUID_Partition_Table_.28GPT.29">GUID Partition Table (GPT)</span></h4>
<p>The <i>GUID Partition Table (GPT)</i> setup (also called GPT disklabel) uses 64-bit identifiers for the partitions. The location in which it stores the partition information is much bigger than the 512 bytes of the MBR partition table (DOS disklabel), which means there is practically no limit on the amount of partitions for a GPT disk. Also the <i>size</i> of a partition is bounded by a much greater limit (almost 8 ZiB - yes, zebibytes).
</p><p>When a system's software interface between the operating system and firmware is UEFI (instead of BIOS), GPT is almost mandatory as compatibility issues will arise with DOS disklabel.
</p><p>GPT also takes advantage of checksumming and redundancy. It carries CRC32 checksums to detect errors in the header and partition tables and has a backup GPT at the end of the disk. This backup table can be used to recover damage of the primary GPT near the beginning of the disk.
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />There are a few caveats regarding GPT:
<ul><li>Using GPT on a BIOS-based computer works, but then one cannot dual-boot with a Microsoft Windows operating system. The reason is that Microsoft Windows will boot in UEFI mode if it detects a GPT partition label.</li>
<li>Some buggy (old) motherboard firmware configured to boot in BIOS/CSM/legacy mode might also have problems with booting from GPT labeled disks.</li></ul>
</div>
<h4><span id="Master_boot_record_(MBR)_or_DOS_boot_sector"></span><span class="mw-headline" id="Master_boot_record_.28MBR.29_or_DOS_boot_sector">Master boot record (MBR) or DOS boot sector</span></h4>
<p>The <i><a href="https://en.wikipedia.org/wiki/Master_boot_record" class="extiw" title="wikipedia:Master boot record">Master boot record</a></i> boot sector (also called DOS boot sector or DOS disklabel) was first introduced in 1983 with PC DOS 2.x. MBR uses 32-bit identifiers for the start sector and length of the partitions, and supports three partition types: primary, extended, and logical. Primary partitions have their information stored in the master boot record itself - a very small (usually 512 bytes) location at the very beginning of a disk. Due to this small space, only four primary partitions are supported (for instance, <span style="font-family: monospace; font-size: 95%">/dev/sda1</span> to <span style="font-family: monospace; font-size: 95%">/dev/sda4</span>).
</p><p>In order to support more partitions, one of the primary partitions in the MBR can be marked as an <i>extended</i> partition. This partition can then contain additional logical partitions (partitions within a partition).
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />Although still supported by most motherboard manufacturers, MBR boot sectors and their associated partitioning limitations are considered legacy. Unless working with hardware that is pre-2010, it best to partition a disk with <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table" class="extiw" title="wikipedia:GUID Partition Table">GUID Partition Table</a>. Readers who must proceed with setup type should knowingly acknowledge the following information:
<ul><li>Most post-2010 motherboards consider using MBR boot sectors a legacy (supported, but not ideal) boot mode.</li>
<li>Due to using 32-bit identifiers, partition tables in the MBR cannot address storage space that is larger than 2 TiBs in size.</li>
<li>Unless a extended partition is created, MBR supports a maximum of four partitions.</li>
<li>This setup does not provide a backup boot sector, so if something overwrites the partition table, all partition information will be lost.</li></ul>
<p>That said, MBR and BIOS boot is still frequently used in virtualized cloud environments such as AWS.
</p>
</div>
<p>The Handbook authors suggest using <a href="#GPT">GPT</a> whenever possible for Gentoo installations.
</p>
<h3><span class="mw-headline" id="Advanced_storage">Advanced storage</span></h3>
<p>The <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b> Installation CDs provide support for Logical Volume Manager (LVM). LVM increases the flexibility offered by the partitioning setup. It allows to combine partitions and disks into volume groups and define RAID groups or caches on fast SSDs for slow HDs. The installation instructions below will focus on "regular" partitions, but it is good to know LVM is supported if that route is desired. Visit the <a href="/wiki/LVM" title="LVM">LVM</a> article for more details. Newcomers beware: although fully supported, LVM is outside the scope of this guide.
</p>
<h3><span class="mw-headline" id="Default_partitioning_scheme">Default partitioning scheme</span></h3>
<p>Throughout the remainder of the handbook, we will discuss and explain two cases: 1) GPT partition table and UEFI boot, and 2) MBR partition table and legacy BIOS boot. While it is possible to mix and match, that goes beyond the scope of this manual. As already stated above, installations on modern hardware should use GPT partition table and UEFI boot; as an exception from this rule, MBR and BIOS boot is still frequently used in virtualized (cloud) environments.
</p><p>The following partitioning scheme will be used as a simple example layout:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec;">
<th>Partition
</th>
<th>Filesystem
</th>
<th>Size
</th>
<th>Description
</th></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda1</span>
</td>
<td>fat32 (UEFI) or ext4 (BIOS - aka Legacy boot)
</td>
<td>256M
</td>
<td>Boot/EFI system partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda2</span>
</td>
<td>(swap)
</td>
<td>RAM size * 2
</td>
<td>Swap partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda3</span>
</td>
<td>ext4
</td>
<td>Rest of the disk
</td>
<td>Root partition
</td></tr></tbody></table>
<p>If this suffices as information, the advanced reader can directly skip ahead to the actual partitioning.
</p><p>Both <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> and <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">parted</span> are partitioning utilities. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> is well known, stable, and recommended for the MBR partition layout. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">parted</span> was one of the first Linux block device management utilities to support GPT partitions, and provides an alternative. Here, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> is used since it has a better text-based user interface.
</p><p>Before going to the creation instructions, the first set of sections will describe in more detail how partitioning schemes can be created and mention some common pitfalls.
</p>
<h2><span class="mw-headline" id="Designing_a_partition_scheme">Designing a partition scheme</span></h2>
<h3><span id="How_many_partitions_and_how_big?"></span><span class="mw-headline" id="How_many_partitions_and_how_big.3F">How many partitions and how big?</span></h3>
<p>The design of disk partition layout is highly dependent on the demands of the system and the file system(s) applied to the device. If there are lots of users, then it is advised to have <span style="font-family: monospace; font-size: 95%">/home</span> on a separate partition which will increase security and make backups and other types of maintenance easier. If Gentoo is being installed to perform as a mail server, then <span style="font-family: monospace; font-size: 95%">/var</span> should be a separate partition as all mails are stored inside the <span style="font-family: monospace; font-size: 95%">/var</span> directory. Game servers may have a separate <span style="font-family: monospace; font-size: 95%">/opt</span> partition since most gaming server software is installed therein. The reason for these recommendations is similar to the <span style="font-family: monospace; font-size: 95%">/home</span> directory: security, backups, and maintenance.
</p><p>In most situations on Gentoo, <span style="font-family: monospace; font-size: 95%">/usr</span> and <span style="font-family: monospace; font-size: 95%">/var</span> should be kept relatively large in size. <span style="font-family: monospace; font-size: 95%">/usr</span> hosts the majority of applications available on the system and the Linux kernel sources (under <span style="font-family: monospace; font-size: 95%">/usr/src</span>). By default, <span style="font-family: monospace; font-size: 95%">/var</span> hosts the Gentoo ebuild repository (located at <span style="font-family: monospace; font-size: 95%">/var/db/repos/gentoo</span>) which, depending on the file system, generally consumes around 650 MiB of disk space. This space estimate <i>excludes</i> the <span style="font-family: monospace; font-size: 95%">/var/cache/distfiles</span> and <span style="font-family: monospace; font-size: 95%">/var/cache/binpkgs</span> directories, which will gradually fill with source files and (optionally) binary packages respectively as they are added to the system.
</p><p>How many partitions and how big very much depends on considering the trade-offs and choosing the best option for the circumstance. Separate partitions or volumes have the following advantages:
</p>
<ul><li>Choose the best performing filesystem for each partition or volume.</li>
<li>The entire system cannot run out of free space if one defunct tool is continuously writing files to a partition or volume.</li>
<li>If necessary, file system checks are reduced in time, as multiple checks can be done in parallel (although this advantage is realized more with multiple disks than it is with multiple partitions).</li>
<li>Security can be enhanced by mounting some partitions or volumes read-only, <code>nosuid</code> (setuid bits are ignored), <code>noexec</code> (executable bits are ignored), etc.</li></ul>
<p><br />
However, multiple partitions have certain disadvantages as well:
</p>
<ul><li>If not configured properly, the system might have lots of free space on one partition and little free space on another.</li>
<li>A separate partition for <span style="font-family: monospace; font-size: 95%">/usr/</span> may require the administrator to boot with an initramfs to mount the partition before other boot scripts start. Since the generation and maintenance of an initramfs is beyond the scope of this handbook, <b>we recommend that newcomers do not use a separate partition for <span style="font-family: monospace; font-size: 95%">/usr/</span></b>.</li>
<li>There is also a 15-partition limit for SCSI and SATA unless the disk uses GPT labels.</li></ul>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If you intend to uses Systemd, <span style="font-family: monospace; font-size: 95%">/usr/</span> must be available on boot, either as part of the root filesystem or mounted via an initramfs.</div>
<h3><span id="What_about_swap_space?"></span><span class="mw-headline" id="What_about_swap_space.3F">What about swap space?</span></h3>
<p>There is no perfect value for swap space size. The purpose of the space is to provide disk storage to the kernel when internal memory (RAM) is under pressure. A swap space allows for the kernel to move memory pages that are not likely to be accessed soon to disk (swap or page-out), which will free memory in RAM for the current task. Of course, if the pages swapped to disk are suddenly needed, they will need to be put back in memory (page-in) which will take considerably longer than reading from RAM (as disks are very slow compared to internal memory).
</p><p>When a system is not going to run memory intensive applications or has lots of RAM available, then it probably does not need much swap space. However do note in case of hibernation that swap space is used to store <i>the entire contents of memory</i> (likely on desktop and laptop systems rather than on server systems). If the system requires support for hibernation, then swap space larger than or equal to the amount of memory is necessary.
</p><p>As a general rule, the swap space size is recommended to be twice the internal memory (RAM). For systems with multiple hard disks, it is wise to create one swap partition on each disk so that they can be utilized for parallel read/write operations. The faster a disk can swap, the faster the system will run when data in swap space must be accessed. When choosing between rotational and solid state disks, it is better for performance to put swap on the SSD. Also, swap files can be used as an alternative to swap partitions; this is mostly interesting for systems with very limited disk space.
</p><p><br />
</p>
<h3><span id="What_is_the_EFI_System_Partition_(ESP)?"></span><span class="mw-headline" id="What_is_the_EFI_System_Partition_.28ESP.29.3F">What is the EFI System Partition (ESP)?</span></h3>
<p>When installing Gentoo on a system that uses UEFI to boot the operating system (instead of BIOS), then it is important that an EFI System Partition (ESP) is created. The instructions below contain the necessary pointers to correctly handle this operation. <b>The EFI system partition is not required when booting in BIOS/Legacy mode.</b>
</p><p>The ESP <i>must</i> be a FAT variant (sometimes shown as <i>vfat</i> on Linux systems). The official <a rel="nofollow" class="external text" href="http://www.uefi.org/sites/default/files/resources/UEFI%202_5.pdf">UEFI specification</a> denotes FAT12, 16, or 32 filesystems will be recognized by the UEFI firmware, although FAT32 is recommended for the ESP. After partitioning, format the ESP accordingly:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkfs.fat -F 32 /dev/sda1</code></div></div>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />If the ESP is not formatted with a FAT variant, the system's UEFI firmware will not find the bootloader (or Linux kernel) and will most likely be unable to boot the system!</div>
<p><br />
</p>
<h3><span id="What_is_the_BIOS_boot_partition?"></span><span class="mw-headline" id="What_is_the_BIOS_boot_partition.3F">What is the BIOS boot partition?</span></h3>
<p>A BIOS boot partition is only needed when combining a GPT partition layout with GRUB2 in BIOS/Legacy boot mode. <b>It is not required when booting in EFI/UEFI mode, and also not required when using a MBR table.</b> It is a very small (1 to 2 MB) partition in which boot loaders like GRUB2 can put additional data that doesn't fit in the allocated storage. It will not be used in this guide.
</p>
<h2><span class="mw-headline" id="Partitioning_the_disk_with_GPT_for_UEFI">Partitioning the disk with GPT for UEFI</span></h2>
<p>The following parts explain how to create the example partition layout for a GPT / UEFI boot installation using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span>. The example partition layout was mentioned earlier:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec;">
<th>Partition
</th>
<th>Description
</th></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda1</span>
</td>
<td>EFI system (and boot) partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda2</span>
</td>
<td>Swap partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda3</span>
</td>
<td>Root partition
</td></tr></tbody></table>
<p>Change the partition layout according to personal preference. 
</p>
<h3><span class="mw-headline" id="Viewing_the_current_partition_layout">Viewing the current partition layout</span></h3>
<p><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> is a popular and powerful tool to split a disk into partitions. Fire up <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> against the disk (in our example, we use <span style="font-family: monospace; font-size: 95%">/dev/sda</span>):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>fdisk /dev/sda</code></div></div>
<p>Use the <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> key to display the disk's current partition configuration:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 21AAD8CF-DB67-0F43-9374-416C7A4E31EA
 
Device        Start      End  Sectors  Size Type
/dev/sda1      2048   526335   524288  256M EFI System
/dev/sda2    526336  2623487  2097152    1G Linux swap
/dev/sda3   2623488 19400703 16777216    8G Linux filesystem
/dev/sda4  19400704 60549086 41148383 19.6G Linux filesystem
</pre></div>
<p>This particular disk was configured to house two Linux filesystems (each with a corresponding partition listed as "Linux") as well as a swap partition (listed as "Linux swap").
</p>
<h3><span id="Creating_a_new_disklabel_/_removing_all_partitions"></span><span class="mw-headline" id="Creating_a_new_disklabel_.2F_removing_all_partitions">Creating a new disklabel / removing all partitions</span></h3>
<p>Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">g</kbd> to create a new GPT disklabel on the disk; this will remove all existing partitions.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>g</code></div><pre>Created a new GPT disklabel (GUID: 87EA4497-2722-DF43-A954-368E46AE5C5F).
</pre></div>
<p>For an existing GPT disklabel (see the output of <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> above), alternatively consider removing the existing partitions one by one from the disk. Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">d</kbd> to delete a partition. For instance, to delete an existing <span style="font-family: monospace; font-size: 95%">/dev/sda1</span>:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>d</code></div><pre>Partition number (1-4): 1
</pre></div>
<p>The partition has now been scheduled for deletion. It will no longer show up when printing the list of partitions (<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd>, but it will not be erased until the changes have been saved. This allows users to abort the operation if a mistake was made - in that case, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">q</kbd> immediately and hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> and the partition will not be deleted.
</p><p>Repeatedly type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> to print out a partition listing and then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">d</kbd> and the number of the partition to delete it. Eventually, the partition table will be empty:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 87EA4497-2722-DF43-A954-368E46AE5C5F
</pre></div>
<p>Now that the in-memory partition table is empty, we're ready to create the partitions.
</p>
<h3><span id="Creating_the_EFI_system_partition_(ESP)"></span><span class="mw-headline" id="Creating_the_EFI_system_partition_.28ESP.29">Creating the EFI system partition (ESP)</span></h3>
<p>First create a small EFI system partition, which will also be mounted as /boot. Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition, followed by <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">1</kbd> to select the first partition. When prompted for the first sector, make sure it starts from 2048 (which may be needed for the boot loader) and hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, type +256M to create a partition 256 Mbyte in size:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>n</code></div><pre>Partition number (1-128, default 1): 1
First sector (2048-60549086, default 2048): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-60549086, default 60549086): +256M
 
Created a new partition 1 of type 'Linux filesystem' and of size 256 MiB.
</pre></div>
<p>Mark the partition as EFI system partition:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>t</code></div><pre>Selected partition 1
Partition type (type L to list all types): 1
Changed type of partition 'Linux filesystem' to 'EFI System'.
</pre></div>
<h3><span class="mw-headline" id="Creating_the_swap_partition">Creating the swap partition</span></h3>
<p>Next, to create the swap partition, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition, then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">2</kbd> to create the second partition, <span style="font-family: monospace; font-size: 95%">/dev/sda2</span>. When prompted for the first sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, type +4G (or any other size needed for the swap space) to create a partition 4GB in size.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>n</code></div><pre>Partition number (2-128, default 2): 
First sector (526336-60549086, default 526336): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (526336-60549086, default 60549086): +4G
 
Created a new partition 2 of type 'Linux filesystem' and of size 4 GiB.
</pre></div>
<p>After all this is done, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">t</kbd> to set the partition type, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">2</kbd> to select the partition just created and then type in <i>19</i> to set the partition type to "Linux Swap".
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>t</code></div><pre>Partition number (1,2, default 2): 2
Partition type (type L to list all types): 19
 
Changed type of partition 'Linux filesystem' to 'Linux swap'.
</pre></div>
<h3><span class="mw-headline" id="Creating_the_root_partition">Creating the root partition</span></h3>
<p>Finally, to create the root partition, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition. Then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">3</kbd> to create the third partition, <span style="font-family: monospace; font-size: 95%">/dev/sda3</span>. When prompted for the first sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> to create a partition that takes up the rest of the remaining space on the disk. After completing these steps, typing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> should display a partition table that looks similar to this:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 87EA4497-2722-DF43-A954-368E46AE5C5F
 
Device       Start      End  Sectors  Size Type
/dev/sda1     2048   526335   524288  256M EFI System
/dev/sda2   526336  8914943  8388608    4G Linux swap
/dev/sda3  8914944 60549086 51634143 24.6G Linux filesystem
</pre></div>
<h3><span class="mw-headline" id="Saving_the_partition_layout">Saving the partition layout</span></h3>
<p>To save the partition layout and exit <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span>, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">w</kbd>.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>w</code></div></div>
<p>With the partitions created, it is now time to put filesystems on them.
</p>
<h2><span id="Partitioning_the_disk_with_MBR_for_BIOS_/_legacy_boot"></span><span class="mw-headline" id="Partitioning_the_disk_with_MBR_for_BIOS_.2F_legacy_boot">Partitioning the disk with MBR for BIOS / legacy boot</span></h2>
<p>The following explains how to create the example partition layout for a MBR / BIOS legacy boot installation. The example partition layout mentioned earlier is now:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec;">
<th>Partition
</th>
<th>Description
</th></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda1</span>
</td>
<td>Boot partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda2</span>
</td>
<td>Swap partition
</td></tr>
<tr>
<td><span style="font-family: monospace; font-size: 95%">/dev/sda3</span>
</td>
<td>Root partition
</td></tr></tbody></table>
<p>Change the partition layout according to personal preference. 
</p>
<h3><span class="mw-headline" id="Viewing_the_current_partition_layout_2">Viewing the current partition layout</span></h3>
<p>Fire up <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span> against the disk (in our example, we use <span style="font-family: monospace; font-size: 95%">/dev/sda</span>):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>fdisk /dev/sda</code></div></div>
<p>Use the <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> key to display the disk's current partition configuration:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 21AAD8CF-DB67-0F43-9374-416C7A4E31EA
 
Device        Start      End  Sectors  Size Type
/dev/sda1      2048   526335   524288  256M EFI System
/dev/sda2    526336  2623487  2097152    1G Linux swap
/dev/sda3   2623488 19400703 16777216    8G Linux filesystem
/dev/sda4  19400704 60549086 41148383 19.6G Linux filesystem
</pre></div>
<p>This particular disk was until now configured to house two Linux filesystems (each with a corresponding partition listed as "Linux") as well as a swap partition (listed as "Linux swap"), using a GPT table.
</p>
<h3><span id="Creating_a_new_disklabel_/_removing_all_partitions_2"></span><span class="mw-headline" id="Creating_a_new_disklabel_.2F_removing_all_partitions_2">Creating a new disklabel / removing all partitions</span></h3>
<p>Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">o</kbd> to create a new MBR disklabel (here also named DOS disklabel) on the disk; this will remove all existing partitions.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>o</code></div><pre>Created a new DOS disklabel with disk identifier 0xe04e67c4.
The device contains 'gpt' signature and it will be removed by a write command. See fdisk(8) man page and --wipe option for more details.
</pre></div>
<p>For an existing DOS disklabel (see the output of <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> above), alternatively consider removing the existing partitions one by one from the disk. Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">d</kbd> to delete a partition. For instance, to delete an existing <span style="font-family: monospace; font-size: 95%">/dev/sda1</span>:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>d</code></div><pre>Partition number (1-4): 1
</pre></div>
<p>The partition has now been scheduled for deletion. It will no longer show up when printing the list of partitions (<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd>, but it will not be erased until the changes have been saved. This allows users to abort the operation if a mistake was made - in that case, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">q</kbd> immediately and hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> and the partition will not be deleted.
</p><p>Repeatedly type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> to print out a partition listing and then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">d</kbd> and the number of the partition to delete it. Eventually, the partition table will be empty:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe04e67c4
</pre></div>
<p>Now we're ready to create the partitions.
</p>
<h3><span class="mw-headline" id="Creating_the_boot_partition">Creating the boot partition</span></h3>
<p>First, create a small partition which will be mounted as /boot. Type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition, followed by <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> for a primary partition and <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">1</kbd> to select the first primary partition. When prompted for the first sector, make sure it starts from 2048 (which may be needed for the boot loader) and hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, type +256M to create a partition 256 Mbyte in size:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>n</code></div><pre>Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-60549119, default 2048): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-60549119, default 60549119): +256M
 
Created a new partition 1 of type 'Linux' and of size 256 MiB.
</pre></div>
<h3><span class="mw-headline" id="Creating_the_swap_partition_2">Creating the swap partition</span></h3>
<p>Next, to create the swap partition, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition, then <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd>, then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">2</kbd> to create the second primary partition, <span style="font-family: monospace; font-size: 95%">/dev/sda2</span>. When prompted for the first sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, type +4G (or any other size needed for the swap space) to create a partition 4GB in size.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>n</code></div><pre>Partition type
   p   primary (1 primary, 0 extended, 3 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (2-4, default 2): 2
First sector (526336-60549119, default 526336): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (526336-60549119, default 60549119): +4G
 
Created a new partition 2 of type 'Linux' and of size 4 GiB.
</pre></div>
<p>After all this is done, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">t</kbd> to set the partition type, <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">2</kbd> to select the partition just created and then type in <i>82</i> to set the partition type to "Linux Swap".
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>t</code></div><pre>Partition number (1,2, default 2): 2
Hex code (type L to list all codes): 82

&lt;!--T:179--&gt;
Changed type of partition 'Linux' to 'Linux swap / Solaris'.
</pre></div>
<h3><span class="mw-headline" id="Creating_the_root_partition_2">Creating the root partition</span></h3>
<p>Finally, to create the root partition, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">n</kbd> to create a new partition. Then type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> and <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">3</kbd> to create the third primary partition, <span style="font-family: monospace; font-size: 95%">/dev/sda3</span>. When prompted for the first sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd>. When prompted for the last sector, hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Enter</kbd> to create a partition that takes up the rest of the remaining space on the disk. After completing these steps, typing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">p</kbd> should display a partition table that looks similar to this:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>p</code></div><pre>Disk /dev/sda: 28.89 GiB, 31001149440 bytes, 60549120 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe04e67c4
 
Device     Boot   Start      End  Sectors  Size Id Type
/dev/sda1          2048   526335   524288  256M 83 Linux
/dev/sda2        526336  8914943  8388608    4G 82 Linux swap / Solaris
/dev/sda3       8914944 60549119 51634176 24.6G 83 Linux
</pre></div>
<h3><span class="mw-headline" id="Saving_the_partition_layout_2">Saving the partition layout</span></h3>
<p>To save the partition layout and exit <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fdisk</span>, type <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">w</kbd>.
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">Command (m for help):</code><span class="tripleclick-separator"></span><code>w</code></div></div>
<p>Now it is time to put filesystems on the partitions.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Creating_file_systems">Creating file systems</span></h2>
<h3><span class="mw-headline" id="Introduction_2">Introduction</span></h3>
<p>Now that the partitions have been created, it is time to place a filesystem on them. In the next section the various file systems that Linux supports are described. Readers that already know which filesystem to use can continue with <a href="#Applying_a_filesystem_to_a_partition">Applying a filesystem to a partition</a>. The others should read on to learn about the available filesystems...
</p>
<h3><span class="mw-headline" id="Filesystems">Filesystems</span></h3>
<p>Linux supports several dozen filesystems, although many of them are only wise to deploy for specific purposes. Only certain filesystems may be found stable on the amd64 architecture - it is advised to read up on the filesystems and their support state before selecting a more experimental one for important partitions. <b>ext4 is the recommended all-purpose, all-platform filesystem.</b> The below is a non-exaustive list 
</p>
<dl><dt><a href="/wiki/Btrfs" title="Btrfs">btrfs</a></dt>
<dd>A next generation filesystem that provides many advanced features such as snapshotting, self-healing through checksums, transparent compression, subvolumes, and integrated RAID. Kernels prior to 5.4.y are not guaranteed to be safe to use with btrfs in production because fixes for serious issues are only present in the more recent releases of the LTS kernel branches. Filesystem corruption issues are common on older kernel branches, with anything older than 4.4.y being especially unsafe and prone to corruption. Corruption is more likely on older kernels (than 5.4.y) when compression is enabled. RAID 5/6 and quota groups unsafe on all versions of btrfs. Furthermore, btrfs can counter-intuitively fail filesystem operations with ENOSPC when <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">df</span> reports free space due to internal fragmentation (free space pinned by DATA + SYSTEM chunks, but needed in METADATA chunks). Additionally, a single 4K reference to a 128M extent inside btrfs can cause free space to be present, but unavailable for allocations. This can also cause btrfs to return ENOSPC when free space is reported by <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">df</span>. Installing <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/btrfsmaintenance">sys-fs/btrfsmaintenance</a> and configuring the scripts to run periodically can help to reduce the possibility of ENOSPC issues by rebalancing btrfs, but it will not eliminate the risk of ENOSPC when free space is present. Some workloads will never hit ENOSPC while others will. If the risk of ENOSPC in production is unacceptable, you should use something else. If using btrfs, be certain to avoid configurations known to have issues. With the exception of ENOSPC, information on the issues present in btrfs in the latest kernel branches is available at the <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Status">btrfs wiki status page</a>.</dd>
<dt><a href="/wiki/Ext4" title="Ext4">ext4</a></dt>
<dd>Initially created as a fork of ext3, ext4 brings new features, performance improvements, and removal of size limits with moderate changes to the on-disk format. It can span volumes up to 1 EB and with maximum file size of 16TB. Instead of the classic ext2/3 bitmap block allocation, ext4 uses extents, which improve large file performance and reduce fragmentation. Ext4 also provides more sophisticated block allocation algorithms (delayed allocation and multiblock allocation) giving the filesystem driver more ways to optimize the layout of data on the disk. Ext4 is the recommended all-purpose all-platform filesystem.</dd>
<dt><a href="/wiki/F2fs" class="mw-redirect" title="F2fs">f2fs</a></dt>
<dd>The Flash-Friendly File System was originally created by Samsung for the use with NAND flash memory. As of Q2, 2016, this filesystem is still considered immature, but it is a decent choice when installing Gentoo to microSD cards, USB drives, or other flash-based storage devices.</dd>
<dt><a href="/wiki/JFS" title="JFS">JFS</a></dt>
<dd>IBM's high-performance journaling filesystem. JFS is a light, fast, and reliable B+tree-based filesystem with good performance in various conditions.</dd>
<dt><a href="/wiki/XFS" title="XFS">XFS</a></dt>
<dd>A filesystem with metadata journaling which comes with a robust feature-set and is optimized for scalability. XFS seems to be less forgiving to various hardware problems, but has been continuously upgraded to include modern features.</dd>
<dt><a href="/wiki/VFAT" class="mw-redirect" title="VFAT">VFAT</a></dt>
<dd>Also known as FAT32, is supported by Linux but does not support standard UNIX permission settings. It is mostly used for interoperability/interchange with other operating systems (Microsoft Windows or Apple's macOS) but is also a necessity for some system bootloader firmware (like UEFI). Users of UEFI systems will need an <a href="/wiki/EFI_System_Partition" title="EFI System Partition">EFI System Partition</a> formatted with VFAT in order to boot.</dd>
<dt><a href="/wiki/NTFS" title="NTFS">NTFS</a></dt>
<dd>This "New Technology" filesystem is the flagship filesystem of Microsoft Windows since Windows NT 3.1. Similarly to VFAT, it does not store UNIX permission settings or extended attributes necessary for BSD or Linux to function properly, therefore it should not be used as a filesystem for most cases. It should <i>only</i> be used for interoperability/interchange with Microsoft Windows systems (note the emphasis on <i>only</i>).</dd></dl>
<h3><span class="mw-headline" id="Applying_a_filesystem_to_a_partition">Applying a filesystem to a partition</span></h3>
<p>To create a filesystem on a partition or volume, there are user space utilities available for each possible filesystem. Click the filesystem's name in the table below for additional information on each filesystem:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec">
<th scope="col" width="15%">Filesystem
</th>
<th>Creation command
</th>
<th>On minimal CD?
</th>
<th>Package
</th></tr>
<tr>
<td><a href="/wiki/Btrfs" title="Btrfs">btrfs</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.btrfs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/btrfs-progs">sys-fs/btrfs-progs</a>
</td></tr>
<tr>
<td><a href="/wiki/Ext4" title="Ext4">ext4</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.ext4</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/e2fsprogs">sys-fs/e2fsprogs</a>
</td></tr>
<tr>
<td><a href="/wiki/F2FS" title="F2FS">f2fs</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.f2fs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/f2fs-tools">sys-fs/f2fs-tools</a>
</td></tr>
<tr>
<td><a href="/wiki/JFS" title="JFS">jfs</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.jfs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/jfsutils">sys-fs/jfsutils</a>
</td></tr>
<tr>
<td><a href="/wiki/ReiserFS" title="ReiserFS">reiserfs</a> (deprecated)
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.reiserfs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/reiserfsprogs">sys-fs/reiserfsprogs</a>
</td></tr>
<tr>
<td><a href="/wiki/XFS" title="XFS">xfs</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.xfs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/xfsprogs">sys-fs/xfsprogs</a>
</td></tr>
<tr>
<td><a href="/wiki/FAT" title="FAT">vfat</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.vfat</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/dosfstools">sys-fs/dosfstools</a>
</td></tr>
<tr>
<td><a href="/wiki/NTFS" title="NTFS">NTFS</a>
</td>
<td><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkfs.ntfs</span>
</td>
<td style="background-color: #DFF0D8; color: black; vertical-align: middle; text-align: left;" class="cell-yes"><span class="glyphicon glyphicon-ok"></span> Yes
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/ntfs3g">sys-fs/ntfs3g</a>
</td></tr></tbody></table>
<p>For instance, to have the EFI system partition partition (<span style="font-family: monospace; font-size: 95%">/dev/sda1</span>) as FAT32 and the root partition (<span style="font-family: monospace; font-size: 95%">/dev/sda3</span>) as ext4 as used in the example partition structure, the following commands would be used:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkfs.vfat -F 32 /dev/sda1</code></div></div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkfs.ext4 /dev/sda3</code></div></div>
<p>When using ext4 on a small partition (less than 8 GiB), then the file system must be created with the proper options to reserve enough inodes. This can be done using one of the following commands, respectively:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkfs.ext4 -T small /dev/&lt;device&gt;</code></div></div>
<p>This will generally quadruple the number of inodes for a given file system as its "bytes-per-inode" reduces from one every 16kB to one every 4kB.
</p><p>Now create the filesystems on the newly created partitions (or logical volumes).
</p>
<h3><span class="mw-headline" id="Activating_the_swap_partition">Activating the swap partition</span></h3>
<p><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mkswap</span> is the command that is used to initialize swap partitions:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkswap /dev/sda2</code></div></div>
<p>To activate the swap partition, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">swapon</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>swapon /dev/sda2</code></div></div>
<p>Create and activate the swap with the commands mentioned above.
</p>
<h2><span class="mw-headline" id="Mounting_the_root_partition">Mounting the root partition</span></h2>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />Users of non-Gentoo installation media will need to create the mount point by running: <br />
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkdir --parents /mnt/gentoo</code></div></div>
</div>
<p>Now that the partitions have been initialized and are housing a filesystem, it is time to mount those partitions. Use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mount</span> command, but don't forget to create the necessary mount directories for every partition created. As an example we mount the root partition:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount /dev/sda3 /mnt/gentoo</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If <span style="font-family: monospace; font-size: 95%">/tmp/</span> needs to reside on a separate partition, be sure to change its permissions after mounting:
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>chmod 1777 /mnt/gentoo/tmp</code></div></div>
This also holds for <span style="font-family: monospace; font-size: 95%">/var/tmp</span>.</div>
<p>Later in the instructions the proc filesystem (a virtual interface with the kernel) as well as other kernel pseudo-filesystems will be mounted. But first we <a href="/wiki/Handbook:AMD64/Installation/Stage" title="Handbook:AMD64/Installation/Stage">install the Gentoo installation files</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Installing_a_stage_tarball">Installing a stage tarball</span></h2>
<h3><span class="mw-headline" id="Setting_the_date_and_time">Setting the date and time</span></h3>
<p>Before installing Gentoo, it is a good idea to be sure the date and time are set correctly. A misconfigured clock may lead to strange issues with the installation: base system files should be extracted with accurate time stamps. In fact, due to Gentoo's web based services using security certificates, it might not be possible to download the installation files if the system clock is too far skewed. An accurate clock is a requirement for proceeding with the installation.
</p><p>Verify the current date and time by running the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">date</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>date</code></div><pre>Mon Oct  3 13:16:22 PDT 2021
</pre></div>
<p>If the date/time displayed is more than few minutes off, it should be updated in accuracy using one of the methods below.
</p>
<h4><span class="mw-headline" id="Automatic">Automatic</span></h4>
<p>Most readers will desire to have their system update the time automatically using a time server.
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />Some motherboards do not include a Real-Time Clock (RTC), which will keep relatively accurate time even while the system is powered off. It is very important for these systems to automatically sync the system clock with a time server at every system start and on a regular internal thereafter. This is just as important for systems that <i>do</i> include a RTC, but have a failed battery.</div>
<p>Official Gentoo live environments include the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ntpd</span> command (available through the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-misc/ntp">net-misc/ntp</a> package) and a configuration file pointing to ntp.org time servers. It can be used to automatically sync the system clock to UTC time using a time server. Using this method requires a <a href="/wiki/Handbook:AMD64/Installation/Networking" title="Handbook:AMD64/Installation/Networking">working network configuration</a> and may not be available on all architectures.
</p>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />Automatic time sync comes at a price. It will reveal the system's IP address and related network information to a time server (in the case of the example below ntp.org). Users with privacy concerns should be aware of this <i>before</i> setting the system clock using the below method.</div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ntpd -q -g</code></div></div>
<h4><span class="mw-headline" id="Manual">Manual</span></h4>
<p>For systems that do not have access to a time server, the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">date</span> command can also be used to set the system clock. It will use the following format as an argument: <code>MMDDhhmmYYYY</code> syntax (<b>M</b>onth, <b>D</b>ay, <b>h</b>our, <b>m</b>inute and <b>Y</b>ear).
</p><p>UTC time is recommended for all Linux systems. A timezone will be defined later in the installation which will modify the clock to display local time.
</p><p>For instance, to set the date to October 3rd, 13:16 in the year 2021, issue:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>date 100313162021</code></div></div>
<h3><span class="mw-headline" id="Choosing_a_stage_tarball">Choosing a stage tarball</span></h3>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Not every architecture has a multilib option. Many only run with native code. Multilib is most commonly applied to <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b>.</div>
<h4><span id="Multilib_(32_and_64-bit)"></span><span class="mw-headline" id="Multilib_.2832_and_64-bit.29">Multilib (32 and 64-bit)</span></h4>
<p>Choosing a base tarball for the system can save a considerable amount of time later on in the installation process, specifically when it is time to <a href="/wiki/Handbook:AMD64/Installation/Base#Choosing_the_right_profile" title="Handbook:AMD64/Installation/Base">choose a system profile</a>. The selection of a stage tarball will directly impact future system configuration and can save a headache or two later on down the line. The multilib tarball uses 64-bit libraries when possible, and only falls back to the 32-bit versions when necessary for compatibility. This is an excellent option for the majority of installations because it provides a great amount of flexibility for customization in the future. Those who desire their systems to be capable of easily switching profiles should download the multilib tarball option for their respective processor architecture.
</p><p>Most users should not use the 'advanced' tarballs options; they are for specific software or hardware configurations.
</p>
<h4><span id="No-multilib_(pure_64-bit)"></span><span class="mw-headline" id="No-multilib_.28pure_64-bit.29">No-multilib (pure 64-bit)</span></h4>
<p>Selecting a no-multilib tarball to be the base of the system provides a complete 64-bit operating system environment. This effectively renders the ability to switch to multilib profiles improbable, although still technically possible.
</p>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />Readers who are just starting out with Gentoo should <i>not</i> choose a no-multilib tarball unless it is absolutely necessary. Migrating from a no-multilib to a multilib system requires an extremely well-working knowledge of Gentoo and the lower-level toolchain (it may even cause our <a href="/wiki/Project:Toolchain" title="Project:Toolchain">Toolchain developers</a> to shudder a little). It is not for the faint of heart and is beyond the scope of this guide.</div>
<h4><span class="mw-headline" id="OpenRC">OpenRC</span></h4>
<p><a href="/wiki/OpenRC" title="OpenRC">OpenRC</a> is a dependency-based init system (responsible for starting up system services once the kernel has booted) that maintains compatibility with the system provided init program, normally located in <span style="font-family: monospace; font-size: 95%">/sbin/init</span>. It is Gentoo's native and original init system, but is also deployed by a few other Linux distributions and BSD systems.
</p><p>OpenRC does not function as a replacement for the <span style="font-family: monospace; font-size: 95%">/sbin/init</span> file by default and is 100% compatible with Gentoo init scripts. This means a solution can be found to run the dozens of daemons in the Gentoo ebuild repository.
</p>
<h4><span class="mw-headline" id="systemd">systemd</span></h4>
<p>systemd is a modern SysV-style init and rc replacement for Linux systems. It is used as the primary init system by a majority of Linux distributions. systemd is fully supported in Gentoo and works for its intended purpose. If something seems lacking in the Handbook for a systemd install path, review the <a href="/wiki/Systemd" title="Systemd">systemd article</a> <i>before</i> asking for support.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />It is technically possible to switch a running Gentoo installation from OpenRC to systemd and back. However, switching requires some effort and is outside the scope of this installation manual. Before downloading a stage tarball, decide whether OpenRC or systemd will be used as the target init system and download the relevant stage tarball.</div>
<h3><span class="mw-headline" id="Downloading_the_stage_tarball">Downloading the stage tarball</span></h3>
<p>Go to the Gentoo mount point where the root file system is mounted (most likely <span style="font-family: monospace; font-size: 95%">/mnt/gentoo</span>):
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cd /mnt/gentoo</code></div></div>
<h4><span class="mw-headline" id="Graphical_browsers">Graphical browsers</span></h4>
<p>Those using environments with fully graphical web browsers will have no problem copying a stage file URL from the main website's <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/#other-arches">download section</a>. Simply select the appropriate tab, right click the link to the stage file, then <span style="font-family: monospace; font-size: 95%">Copy Link</span> to copy the link to the clipboard, then paste the link to the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">wget</span> utility on the command-line to download the stage tarball:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>wget &lt;<var>PASTED_STAGE_URL</var>&gt;</code></div></div>
<h4><span class="mw-headline" id="Command-line_browsers">Command-line browsers</span></h4>
<p>More traditional readers or 'old timer' Gentoo users, working exclusively from command-line may prefer using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span> (<a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/www-client/links">www-client/links</a>), a non-graphical, menu-driven browser. To download a stage, surf to the Gentoo mirror list like so:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>links https://www.gentoo.org/downloads/mirrors/</code></div></div>
<p>To use an HTTP proxy with <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span>, pass on the URL with the <code>-http-proxy</code> option:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>links -http-proxy proxy.server.com:8080 https://www.gentoo.org/downloads/mirrors/</code></div></div>
<p>Next to <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span> there is also the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">lynx</span> (<a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/www-client/lynx">www-client/lynx</a>) browser. Like <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">links</span> it is a non-graphical browser but it is not menu-driven.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>lynx https://www.gentoo.org/downloads/mirrors/</code></div></div>
<p>If a proxy needs to be defined, export the <var>http_proxy</var> and/or <var>ftp_proxy</var> variables:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export http_proxy="http://proxy.server.com:port"
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export ftp_proxy="http://proxy.server.com:port"</code></div></div>
<p>On the mirror list, select a mirror close by. Usually HTTP mirrors suffice, but other protocols are available as well. Move to the <span style="font-family: monospace; font-size: 95%">releases/amd64/autobuilds/</span> directory. There all available stage files are displayed (they might be stored within subdirectories named after the individual sub-architectures). Select one and press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">d</kbd> to download.
</p><p>After the stage file download completes, it is possible to verify the integrity and validate the contents of the stage tarball. Those interested should proceed to the <a href="#Verifying_and_validating">next section</a>.
</p><p>Those not interested in verifying and validating the stage file can close the command-line browser by pressing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">q</kbd> and can move directly to the <a href="#Unpacking_the_stage_tarball">Unpacking the stage tarball</a> section.
</p>
<h4><span class="mw-headline" id="Verifying_and_validating">Verifying and validating</span></h4>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Most stages are now explicitly <a rel="nofollow" class="external text" href="https://www.gentoo.org/news/2021/07/20/more-downloads.html">suffixed</a> with the init system type (<span style="font-family: monospace; font-size: 95%">openrc</span> or <span style="font-family: monospace; font-size: 95%">systemd</span>), although some architectures may still be missing these for now.</div>
<p>Like with the minimal installation CDs, additional downloads to verify and validate the stage file are available. Although these steps may be skipped, these files are provided for users who care about the legitimacy of the file(s) they just downloaded.
</p>
<ul><li>A <span style="font-family: monospace; font-size: 95%">.CONTENTS</span> file that contains a list of all files inside the stage tarball.</li>
<li>A <span style="font-family: monospace; font-size: 95%">.DIGESTS</span> file that contains checksums of the stage file in different algorithms.</li>
<li>A <span style="font-family: monospace; font-size: 95%">.DIGESTS.asc</span> file that, like the <span style="font-family: monospace; font-size: 95%">.DIGESTS</span> file, contains checksums of the stage file in different algorithms, but is also cryptographically signed to ensure it is provided by the Gentoo project.</li></ul>
<p>Use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">openssl</span> and compare the output with the checksums provided by the <span style="font-family: monospace; font-size: 95%">.DIGESTS</span> or <span style="font-family: monospace; font-size: 95%">.DIGESTS.asc</span> files.
</p><p>For instance, to validate the SHA512 checksum:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>openssl dgst -r -sha512 stage3-amd64-&lt;release&gt;-&lt;init&gt;.tar.?(bz2|xz)</code></div></div>
<p>Another way is to use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">sha512sum</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>sha512sum stage3-amd64-&lt;release&gt;-&lt;init&gt;.tar.?(bz2|xz)</code></div></div>
<p>To validate the Whirlpool checksum:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>openssl dgst -r -whirlpool stage3-amd64-&lt;release&gt;-&lt;init&gt;.tar.?(bz2|xz)</code></div></div>
<p>Compare the output of these commands with the value registered in the <span style="font-family: monospace; font-size: 95%">.DIGESTS(.asc)</span> files. The values need to match, otherwise the downloaded file might be corrupt (or the digests file is).
</p><p>Just like with the ISO file, it is also possible to verify the cryptographic signature of the <span style="font-family: monospace; font-size: 95%">.DIGESTS.asc</span> file using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">gpg</span> to make sure the checksums have not been tampered with:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>gpg --verify stage3-amd64-&lt;release&gt;-&lt;init&gt;.tar.?(bz2|xz){.DIGESTS.asc,} </code></div></div>
<p>The fingerprints of the OpenPGP keys used for signing release media can be found on the <a rel="nofollow" class="external text" href="https://www.gentoo.org/downloads/signatures/">release media signatures page</a> of the Gentoo webserver.
</p>
<h3><span class="mw-headline" id="Unpacking_the_stage_tarball">Unpacking the stage tarball</span></h3>
<p>Now unpack the downloaded stage onto the system. Use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">tar</span> utility to proceed:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>tar xpvf stage3-*.tar.xz --xattrs-include='*.*' --numeric-owner</code></div></div>
<p>Verify the same options (<code>xpf</code> and <code>--xattrs-include='*.*'</code>) are used in the command. The <code>x</code> stands for e<b>x</b>tract, the <code>p</code> for <b>p</b>reserve permissions and the <code>f</code> to denote that we want to extract a <b>f</b>ile (not standard input). <code>--xattrs-include='*.*'</code> is to include preservation of the the extended attributes in all namespaces stored in the archive. Finally, <code>--numeric-owner</code> is used to ensure that the user and group IDs of the files being extracted from the tarball will remain the same as Gentoo's release engineering team intended (even if adventurous users are not using official Gentoo live environments).
</p><p>Now that the stage file is unpacked, proceed with <a href="#Configuring_compile_options">Configuring compile options</a>.
</p>
<h2><span class="mw-headline" id="Configuring_compile_options">Configuring compile options</span></h2>
<h3><span class="mw-headline" id="Introduction_3">Introduction</span></h3>
<p>To optimize the system, it is possible to set variables which impact the behavior of Portage, Gentoo's officially supported package manager. All those variables can be set as environment variables (using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">export</span>) but setting via <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">export</span> is not permanent.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Technically variables can be exported via the <a href="/wiki/Shell" title="Shell">shell</a>'s profile or rc files, however that is not best practice for basic system administration.</div>
<p>Portage reads in the <span style="font-family: monospace; font-size: 95%"><a href="/wiki/Make.conf" class="mw-redirect" title="Make.conf">make.conf</a></span> file when it runs, which will change runtime behavior depending on the values saved in the file. <span style="font-family: monospace; font-size: 95%">make.conf</span> can be considered the primary configuration file for Portage, so treat its content carefully.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />A commented listing of all possible variables can be found in <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/usr/share/portage/config/make.conf.example</span>. Additional documentation on <span style="font-family: monospace; font-size: 95%">make.conf</span> can be found by running <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">man 5 make.conf</span>.<br /><br />
For a successful Gentoo installation only the variables that are mentioned below need to be set.</div>
<p>Fire up an editor (in this guide we use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">nano</span>) to alter the optimization variables we will discuss hereafter.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /mnt/gentoo/etc/portage/make.conf</code></div></div>
<p>From the <span style="font-family: monospace; font-size: 95%">make.conf.example</span> file it is obvious how the file should be structured: commented lines start with <code>#</code>, other lines define variables using the <code>VARIABLE="value"</code> syntax. Several of those variables are discussed in the next section.
</p>
<h3><span class="mw-headline" id="CFLAGS_and_CXXFLAGS">CFLAGS and CXXFLAGS</span></h3>
<p>The <var>CFLAGS</var> and <var>CXXFLAGS</var> variables define the optimization flags for GCC C and C++ compilers respectively. Although those are defined generally here, for maximum performance one would need to optimize these flags for each program separately. The reason for this is because every program is different. However, this is not manageable, hence the definition of these flags in the <span style="font-family: monospace; font-size: 95%">make.conf</span> file.
</p><p>In <span style="font-family: monospace; font-size: 95%">make.conf</span> one should define the optimization flags that will make the system the most responsive generally. Don't place experimental settings in this variable; too much optimization can make programs misbehave (crash, or even worse, malfunction).
</p><p>We will not explain all possible optimization options. To understand them all, read the <a rel="nofollow" class="external text" href="https://gcc.gnu.org/onlinedocs/">GNU Online Manual(s)</a> or the gcc info page (<span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">info gcc</span> - only works on a working Linux system). The <span style="font-family: monospace; font-size: 95%">make.conf.example</span> file itself also contains lots of examples and information; don't forget to read it too.
</p><p>A first setting is the <code>-march=</code> or <code>-mtune=</code> flag, which specifies the name of the target architecture. Possible options are described in the <span style="font-family: monospace; font-size: 95%">make.conf.example</span> file (as comments). A commonly used value is <i>native</i> as that tells the compiler to select the target architecture of the current system (the one users are installing Gentoo on).
</p><p>A second one is the <code>-O</code> flag (that is a capital O, not a zero), which specifies the gcc optimization class flag. Possible classes are s (for size-optimized), 0 (zero - for no optimizations), 1, 2 or even 3 for more speed-optimization flags (every class has the same flags as the one before, plus some extras). <code>-O2</code> is the recommended default. <code>-O3</code> is known to cause problems when used system-wide, so we recommend to stick to <code>-O2</code>.
</p><p>Another popular optimization flag is <code>-pipe</code> (use pipes rather than temporary files for communication between the various stages of compilation). It has no impact on the generated code, but uses more memory. On systems with low memory, gcc might get killed. In that case, do not use this flag.
</p><p>Using <code>-fomit-frame-pointer</code> (which doesn't keep the frame pointer in a register for functions that don't need one) might have serious repercussions on the debugging of applications.
</p><p>When the <var>CFLAGS</var> and <var>CXXFLAGS</var> variables are defined, combine the several optimization flags in one string. The default values contained in the stage3 archive that is unpacked should be good enough. The following one is just an example:
</p>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Example <var>CFLAGS</var> and <var>CXXFLAGS</var> variables</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># Compiler flags to set for all languages</span>
<span class="nv">COMMON_FLAGS</span><span class="o">=</span><span class="s2">&quot;-march=native -O2 -pipe&quot;</span>
<span class="c1"># Use the same settings for both variables</span>
<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">COMMON_FLAGS</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">COMMON_FLAGS</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div></pre></div>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />Although the <a href="/wiki/GCC_optimization" title="GCC optimization">GCC optimization</a> article has more information on how the various compilation options can affect a system, the <a href="/wiki/Safe_CFLAGS" title="Safe CFLAGS">Safe CFLAGS</a> article may be a more practical place for beginners to start optimizing their systems.</div>
<h3><span class="mw-headline" id="MAKEOPTS">MAKEOPTS</span></h3>
<p>The <var>MAKEOPTS</var> variable defines how many parallel compilations should occur when installing a package. A good choice is the smaller of: the number of threads the CPU has, or the total system RAM divided by 2 GiB.
</p>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />Using a large number of jobs can significantly impact memory consumption. A good recommendation is to have at least 2 GiB of RAM for every job specified (so, e.g. <code>-j6</code> requires <i>at least</i> 12 GiB). To avoid running out of memory, lower the number of jobs to fit the available memory.</div>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />When using parallel emerges (<code>--jobs</code>), the effective number of jobs run can grow exponentially (up to make jobs multiplied by emerge jobs). This can be worked around by running a localhost-only distcc configuration that will limit the number of compiler instances per host.</div>
<div class="gw-box"><div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #204A87">CODE</span> <strong>Example <var>MAKEOPTS</var> declaration in make.conf</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">MAKEOPTS</span><span class="o">=</span><span class="s2">&quot;-j2&quot;</span>
</pre></div></pre></div>
<h3><span id="Ready,_set,_go!"></span><span class="mw-headline" id="Ready.2C_set.2C_go.21">Ready, set, go!</span></h3>
<p>Update the <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/etc/portage/make.conf</span> file to match personal preference and save (nano users would hit <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Ctrl</kbd>+<kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">x</kbd>). 
</p><p>Then continue with <a href="/wiki/Handbook:AMD64/Installation/Base" title="Handbook:AMD64/Installation/Base">Installing the Gentoo base system</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Chrooting">Chrooting</span></h2>
<h3><span class="mw-headline" id="Optional:_Selecting_mirrors">Optional: Selecting mirrors</span></h3>
<h4><span class="mw-headline" id="Distribution_files">Distribution files</span></h4>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />It is safe to skip this step when using non-Gentoo installation media. The <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-portage/mirrorselect">app-portage/mirrorselect</a> package can be emerged later within the stage3 (after <a href="#Entering_the_new_environment">Entering the new environment</a>) and the actions defined in this section can be performed at that point.</div>
<p>In order to download source code quickly it is recommended to select a fast mirror. Portage will look in the <span style="font-family: monospace; font-size: 95%">make.conf</span> file for the <var>GENTOO_MIRRORS</var> variable and use the mirrors listed therein. It is possible to surf to the Gentoo mirror list and search for a mirror (or mirrors) that is close to the system's physical location (as those are most frequently the fastest ones). However, we provide a nice tool called <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mirrorselect</span> which provides users with a nice interface to select the mirrors needed. Just navigate to the mirrors of choice and press <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">Spacebar</kbd> to select one or more mirrors.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/portage/make.conf</code></div></div>
<h4><span class="mw-headline" id="Gentoo_ebuild_repository">Gentoo ebuild repository</span></h4>
<p>A second important step in selecting mirrors is to configure the Gentoo ebuild repository via the <span style="font-family: monospace; font-size: 95%">/etc/portage/repos.conf/gentoo.conf</span> file. This file contains the sync information needed to update the package repository (the collection of ebuilds and related files containing all the information Portage needs to download and install software packages).
</p><p>Configuring the repository can be done in a few simple steps. First, if it does not exist, create the <span style="font-family: monospace; font-size: 95%"><a href="/wiki//etc/portage/repos.conf" title="/etc/portage/repos.conf">repos.conf</a></span> directory:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkdir --parents /mnt/gentoo/etc/portage/repos.conf</code></div></div>
<p>Next, copy the Gentoo repository configuration file provided by Portage to the (newly created) <span style="font-family: monospace; font-size: 95%">repos.conf</span> directory:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf</code></div></div>
<p>Take a peek with a text editor or by using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">cat</span> command. The inside of the file should be in <span style="font-family: monospace; font-size: 95%">.ini</span> format and look like this:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/mnt/gentoo/etc/portage/repos.conf/gentoo.conf</code></strong><strong></strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-ini mw-content-ltr" dir="ltr"><pre><span></span><span class="k">[DEFAULT]</span><span class="w"></span>
<span class="na">main-repo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">gentoo</span><span class="w"></span>
<span class="w"> </span>
<span class="k">[gentoo]</span><span class="w"></span>
<span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/db/repos/gentoo</span><span class="w"></span>
<span class="na">sync-type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">rsync</span><span class="w"></span>
<span class="na">sync-uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">rsync://rsync.gentoo.org/gentoo-portage</span><span class="w"></span>
<span class="na">auto-sync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span><span class="w"></span>
<span class="na">sync-rsync-verify-jobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span><span class="w"></span>
<span class="na">sync-rsync-verify-metamanifest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">yes</span><span class="w"></span>
<span class="na">sync-rsync-verify-max-age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">24</span><span class="w"></span>
<span class="na">sync-openpgp-key-path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/usr/share/openpgp-keys/gentoo-release.asc</span><span class="w"></span>
<span class="na">sync-openpgp-key-refresh-retry-count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">40</span><span class="w"></span>
<span class="na">sync-openpgp-key-refresh-retry-overall-timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1200</span><span class="w"></span>
<span class="na">sync-openpgp-key-refresh-retry-delay-exp-base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span><span class="w"></span>
<span class="na">sync-openpgp-key-refresh-retry-delay-max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">60</span><span class="w"></span>
<span class="na">sync-openpgp-key-refresh-retry-delay-mult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4</span><span class="w"></span>
</pre></div></pre>
<p>The default <var>sync-uri</var> variable value listed above will determine a mirror location based on a rotation. This will aid in easing bandwidth stress on Gentoo's infrastructure and will provide a fail-safe in case a specific mirror is offline. It is recommended the default URI is retained unless a local, private Portage mirror will be used.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />The specification for Portage's plug-in sync API can be found in the <a href="/wiki/Project:Portage/Sync" title="Project:Portage/Sync">Portage Sync article</a>.</div>
<h3><span class="mw-headline" id="Copy_DNS_info">Copy DNS info</span></h3>
<p>One thing still remains to be done before entering the new environment and that is copying over the DNS information in <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span>. This needs to be done to ensure that networking still works even after entering the new environment. <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span> contains the name servers for the network.
</p><p>To copy this information, it is recommended to pass the <code>--dereference</code> option to the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">cp</span> command. This ensures that, if <span style="font-family: monospace; font-size: 95%">/etc/resolv.conf</span> is a symbolic link, that the link's target file is copied instead of the symbolic link itself. Otherwise in the new environment the symbolic link would point to a non-existing file (as the link's target is most likely not available inside the new environment).
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cp --dereference /etc/resolv.conf /mnt/gentoo/etc/</code></div></div>
<h3><span class="mw-headline" id="Mounting_the_necessary_filesystems">Mounting the necessary filesystems</span></h3>
<p>In a few moments, the Linux root will be changed towards the new location. To make sure that the new environment works properly, certain filesystems need to be made available there as well.
</p><p>The filesystems that need to be made available are:
</p>
<ul><li><span style="font-family: monospace; font-size: 95%">/proc/</span> which is a pseudo-filesystem (it looks like regular files, but is actually generated on-the-fly) from which the Linux kernel exposes information to the environment</li>
<li><span style="font-family: monospace; font-size: 95%">/sys/</span> which is a pseudo-filesystem, like <span style="font-family: monospace; font-size: 95%">/proc/</span> which it was once meant to replace, and is more structured than <span style="font-family: monospace; font-size: 95%">/proc/</span></li>
<li><span style="font-family: monospace; font-size: 95%">/dev/</span> is a regular file system, partially managed by the Linux device manager (usually <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">udev</span>), which contains all device files</li>
<li><span style="font-family: monospace; font-size: 95%">/run/</span> is a temporary file system used for files generated at runtime, such as PID files or locks</li></ul>
<p>The <span style="font-family: monospace; font-size: 95%">/proc/</span> location will be mounted on <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/proc/</span> whereas the others are bind-mounted. The latter means that, for instance, <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/sys/</span> will actually <i>be</i> <span style="font-family: monospace; font-size: 95%">/sys/</span> (it is just a second entry point to the same filesystem) whereas <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/proc/</span> is a new mount (instance so to speak) of the filesystem.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --types proc /proc /mnt/gentoo/proc
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --rbind /sys /mnt/gentoo/sys
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --make-rslave /mnt/gentoo/sys
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --rbind /dev /mnt/gentoo/dev
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --make-rslave /mnt/gentoo/dev
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --bind /run /mnt/gentoo/run
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --make-slave /mnt/gentoo/run
</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The <code>--make-rslave</code> operations are needed for systemd support later in the installation.</div>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />When using non-Gentoo installation media, this might not be sufficient. Some distributions make <span style="font-family: monospace; font-size: 95%">/dev/shm</span> a symbolic link to <span style="font-family: monospace; font-size: 95%">/run/shm/</span> which, after the chroot, becomes invalid. Making <span style="font-family: monospace; font-size: 95%">/dev/shm/</span> a proper tmpfs mount up front can fix this:
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>test -L /dev/shm &amp;&amp; rm /dev/shm &amp;&amp; mkdir /dev/shm
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount --types tmpfs --options nosuid,nodev,noexec shm /dev/shm
</code></div></div>
<p>Also ensure that mode 1777 is set:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>chmod 1777 /dev/shm /run/shm</code></div></div>
</div>
<h3><span class="mw-headline" id="Entering_the_new_environment">Entering the new environment</span></h3>
<p>Now that all partitions are initialized and the base environment installed, it is time to enter the new installation environment by chrooting into it. This means that the session will change its root (most top-level location that can be accessed) from the current installation environment (installation CD or other installation medium) to the installation system (namely the initialized partitions). Hence the name, <i>change root</i> or <i>chroot</i>.
</p><p>This chrooting is done in three steps:
</p>
<ol><li>The root location is changed from <span style="font-family: monospace; font-size: 95%">/</span> (on the installation medium) to <span style="font-family: monospace; font-size: 95%">/mnt/gentoo/</span> (on the partitions) using chroot</li>
<li>Some settings (those in <span style="font-family: monospace; font-size: 95%">/etc/profile</span>) are reloaded in memory using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">source</span> command</li>
<li>The primary prompt is changed to help us remember that this session is inside a chroot environment.</li></ol>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>chroot /mnt/gentoo /bin/bash
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>source /etc/profile
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>export PS1="(chroot) ${PS1}"</code></div></div>
<p>From this point, all actions performed are immediately on the new Gentoo Linux environment. Of course it is far from finished, which is why the installation still has some sections left!
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />If the Gentoo installation is interrupted anywhere after this point, it <i>should</i> be possible to 'resume' the installation at this step. There is no need to repartition the disks again! Simply <a href="/wiki/Handbook:AMD64/Installation/Disks#Mounting_the_root_partition" title="Handbook:AMD64/Installation/Disks">mount the root partition</a> and run the steps above starting with <a href="#Copy_DNS_info">copying the DNS info</a> to re-enter the working environment. This is also useful for fixing bootloader issues. More information can be found in the <a href="/wiki/Chroot" title="Chroot">chroot</a> article.</div> 
<h3><span class="mw-headline" id="Mounting_the_boot_partition">Mounting the boot partition</span></h3>
<p>Now that the new environment has been entered, it is necessary to mount the boot partition. This will be important when it is time to compile the kernel and install the bootloader:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount /dev/sda1 /boot</code></div></div>
<h2><span class="mw-headline" id="Configuring_Portage">Configuring Portage</span></h2>
<h3><span class="mw-headline" id="Installing_a_Gentoo_ebuild_repository_snapshot_from_the_web">Installing a Gentoo ebuild repository snapshot from the web</span></h3>
<p>Next step is to install a snapshot of the Gentoo ebuild repository. This snapshot contains a collection of files that informs Portage about available software titles (for installation), which profiles the system administrator can select, package or profile specific news items, etc.
</p><p>The use of <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge-webrsync</span> is recommended for those who are behind restrictive firewalls (it uses HTTP/FTP protocols for downloading the snapshot) and saves network bandwidth. Readers who have no network or bandwidth restrictions can happily skip down to the next section.
</p><p>This will fetch the latest snapshot (which is released on a daily basis) from one of Gentoo's mirrors and install it onto the system:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge-webrsync</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />During this operation, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge-webrsync</span> might complain about a missing <span style="font-family: monospace; font-size: 95%">/var/db/repos/gentoo/</span> location. This is to be expected and nothing to worry about - the tool will create the location.</div>
<p>From this point onward, Portage might mention that certain updates are recommended to be executed. This is because system packages installed through the stage file might have newer versions available; Portage is now aware of new packages because of the repository snapshot. Package updates can be safely ignored for now; updates can be delayed until after the Gentoo installation has finished.
</p>
<h3><span class="mw-headline" id="Optional:_Updating_the_Gentoo_ebuild_repository">Optional: Updating the Gentoo ebuild repository</span></h3>
<p>It is possible to update the Gentoo ebuild repository to the latest version. The previous <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge-webrsync</span> command will have installed a very recent snapshot (usually recent up to 24h) so this step is definitely optional.
</p><p>Suppose there is a need for the last package updates (up to 1 hour), then use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge --sync</span>. This command will use the rsync protocol to update the Gentoo ebuild repository (which was fetched earlier on through <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge-webrsync</span>) to the latest state.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --sync</code></div></div>
<p>On slow terminals, like some framebuffers or serial consoles, it is recommended to use the <code>--quiet</code> option to speed up the process:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --sync --quiet</code></div></div>
<h3><span class="mw-headline" id="Reading_news_items">Reading news items</span></h3>
<p>When the Gentoo ebuild repository is synchronized, Portage may output informational messages similar to the following:
</p>
<div class="cmd-box"><div><code> * IMPORTANT: 2 news items need reading for repository 'gentoo'.
</code></div><div><code> * Use eselect news to read news items.
</code></div></div>
<p>News items were created to provide a communication medium to push critical messages to users via the Gentoo ebuild repository. To manage them, use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect news</span>. The <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect</span> application is a Gentoo-specific utility that allows for a common management interface for system administration. In this case, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect</span> is asked to use its <code>news</code> module.
</p><p>For the <code>news</code> module, three operations are most used:
</p>
<ul><li>With <code>list</code> an overview of the available news items is displayed.</li>
<li>With <code>read</code> the news items can be read.</li>
<li>With <code>purge</code> news items can be removed once they have been read and will not be reread anymore.</li></ul>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect news list
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect news read</code></div></div>
<p>More information about the news reader is available through its manual page: 
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>man news.eselect</code></div></div>
<h3><span class="mw-headline" id="Choosing_the_right_profile">Choosing the right profile</span></h3>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />Desktop profiles are not exclusively for <i>desktop environments</i>. They are still suitable for minimal window managers like i3 or sway.</div>
<p>A <i>profile</i> is a building block for any Gentoo system. Not only does it specify default values for <var>USE</var>, <var>CFLAGS</var>, and other important variables, it also locks the system to a certain range of package versions. These settings are all maintained by Gentoo's Portage developers.
</p><p>To see what profile the system is currently using, run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect</span> using the <code>profile</code> module:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect profile list</code></div><pre>Available profile symlink targets:
  [1]   default/linux/amd64/17.1 *
  [2]   default/linux/amd64/17.1/desktop
  [3]   default/linux/amd64/17.1/desktop/gnome
  [4]   default/linux/amd64/17.1/desktop/kde
</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The output of the command is just an example and evolves over time.</div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />When using systemd, please make sure the profile name contains systemd. Otherwise, please make sure the profile name does <b>not</b> contain systemd.</div>
<p>As can be seen, there are also desktop subprofiles available for some architectures.
</p>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />Profile upgrades are not to be taken lightly. When selecting the initial profile, make sure to use profile corresponding to <b>the same version</b> as the one initially used by stage3 (e.g. 17.1). Each new profile version is announced through a news item containing migration instructions. Make sure to read it and follow them before switching to a newer profile.</div>
<p>After viewing the available profiles for the amd64 architecture, users can select a different profile for the system:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect profile set 2</code></div></div>
<p><br />
</p>
<h4><span class="mw-headline" id="No-multilib">No-multilib</span></h4>
<p>In order to select a pure 64-bit environment, with no 32-bit applications or libraries, use a no-multilib profile:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect profile list</code></div><pre>Available profile symlink targets:
  [1]   default/linux/amd64/17.1 *
  [2]   default/linux/amd64/17.1/desktop
  [3]   default/linux/amd64/17.1/desktop/gnome
  [4]   default/linux/amd64/17.1/desktop/kde
  [5]   default/linux/amd64/17.1/no-multilib
</pre></div>
<p>Next select the <i>no-multilib</i> profile:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect profile set 5
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect profile list</code></div><pre>Available profile symlink targets:
  [1]   default/linux/amd64/17.1
  [2]   default/linux/amd64/17.1/desktop
  [3]   default/linux/amd64/17.1/desktop/gnome
  [4]   default/linux/amd64/17.1/desktop/kde
  [5]   default/linux/amd64/17.1/no-multilib *
</pre></div>
<p><br />
</p><p><br />
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The <code>developer</code> subprofile is specifically for Gentoo Linux development and is not meant to be used by casual users.</div>
<h3><span id="Updating_the_@world_set"></span><span class="mw-headline" id="Updating_the_.40world_set">Updating the @world set</span></h3>
<p>At this point, it is wise to update the system's <a href="/wiki/World_set_(Portage)" title="World set (Portage)">@world set</a> so that a base can be established.
</p><p>This following step is <i>necessary</i> so the system can apply any updates or USE flag changes which have appeared since the stage3 was built and from any profile selection:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask&#160;--verbose --update --deep --newuse @world</code></div></div> 
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />If a full scale desktop environment profile has been selected this process could greatly extend the amount of time necessary for the install process. Those in a time crunch can work by this 'rule of thumb': the shorter the profile name, the less specific the system's <a href="/wiki/World_set_(Portage)" title="World set (Portage)">@world set</a>; the less specific the @world set, the fewer packages the system will require. In other words:
<ul><li>Selecting <code>default/linux/amd64/17.1</code> will require very few packages to be updated, whereas</li>
<li>Selecting <code>default/linux/amd64/17.1/desktop/gnome/systemd</code> will require many packages to be installed since the init system is changing from OpenRC to systemd, and the GNOME desktop environment framework will be installed.</li></ul>
</div>
<h3><span class="mw-headline" id="Configuring_the_USE_variable">Configuring the USE variable</span></h3>
<p><var>USE</var> is one of the most powerful variables Gentoo provides to its users. Several programs can be compiled with or without optional support for certain items. For instance, some programs can be compiled with support for GTK+ or with support for Qt. Others can be compiled with or without SSL support. Some programs can even be compiled with framebuffer support (svgalib) instead of X11 support (X-server).
</p><p>Most distributions compile their packages with support for as much as possible, increasing the size of the programs and startup time, not to mention an enormous amount of dependencies. With Gentoo users can define what options a package should be compiled with. This is where <var>USE</var> comes into play.
</p><p>In the <var>USE</var> variable users define keywords which are mapped onto compile-options. For instance, <code>ssl</code> will compile SSL support in the programs that support it. <code>-X</code> will remove X-server support (note the minus sign in front). <code>gnome gtk -kde -qt5</code> will compile programs with GNOME (and GTK+) support, and not with KDE (and Qt) support, making the system fully tweaked for GNOME (if the architecture supports it).
</p><p>The default USE settings are placed in the <span style="font-family: monospace; font-size: 95%">make.defaults</span> files of the Gentoo profile used by the system. Gentoo uses a (complex) inheritance system for its profiles, which we will not dive into at this stage. The easiest way to check the currently active <var>USE</var> settings is to run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge --info</span> and select the line that starts with USE:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --info | grep ^USE</code></div><pre>USE="X acl alsa amd64 berkdb bindist bzip2 cli cracklib crypt cxx dri ..."
</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The above example is truncated, the actual list of <var>USE</var> values is much, much larger.</div>
<p>A full description on the available USE flags can be found on the system in <span style="font-family: monospace; font-size: 95%">/var/db/repos/gentoo/profiles/use.desc</span>.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>less /var/db/repos/gentoo/profiles/use.desc</code></div></div>
<p>Inside the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">less</span> command, scrolling can be done using the <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"></kbd> and <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"></kbd> keys, and exited by pressing <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">q</kbd>.
</p><p>As an example we show a USE setting for a KDE-based system with DVD, ALSA, and CD recording support:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/portage/make.conf</code></div></div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/portage/make.conf</code></strong><strong>Enabling flags for a KDE/Plasma-based system with DVD, ALSA, and CD recording support</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">USE</span><span class="o">=</span><span class="s2">&quot;-gtk -gnome qt5 kde dvd alsa cdr&quot;</span>
</pre></div></pre>
<p>When a <var>USE</var> value is defined in <span style="font-family: monospace; font-size: 95%">/etc/portage/make.conf</span> it is <i>added</i> to the system's USE flag list. USE flags can be globally <i>removed</i> by adding a <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">-</kbd> minus sign in front of the value in the the list. For example, to disable support for X graphical environments, <code>-X</code> can be set:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/portage/make.conf</code></strong><strong>Ignoring default USE flags</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">USE</span><span class="o">=</span><span class="s2">&quot;-X acl alsa&quot;</span>
</pre></div></pre>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />Although possible, setting <code>-*</code> (which will disable all USE values except the ones specified in <span style="font-family: monospace; font-size: 95%">make.conf</span>) is <i>strongly</i> discouraged and unwise. Ebuild developers choose certain default USE flag values in ebuilds in order to prevent conflicts, enhance security, and avoid errors, and other reasons. Disabling <i>all</i> USE flags will negate default behavior and may cause major issues.</div>
<h4><span id="CPU_FLAGS_*"></span><span class="mw-headline" id="CPU_FLAGS_.2A">CPU_FLAGS_*</span></h4>
<p>Some architectures (including AMD64/X86, ARM, PPC) have a <a href="/wiki/USE_EXPAND" class="mw-redirect" title="USE EXPAND">USE_EXPAND</a> variable called <a href="/wiki/CPU_FLAGS_X86" title="CPU FLAGS X86">CPU_FLAGS_ARCH</a> (replace ARCH with the relevant system architecture as appropriate).
</p><p>This is used to configure the build to compile in specific assembly code or other intrinsics, usually hand-written or otherwise extra,
and is <b>not</b> the same as asking the compiler to output optimized code for a certain CPU feature (e.g. <code>-march=</code>).
</p><p>Users should set this variable in addition to configuring their <var>COMMON_FLAGS</var> as desired.
</p><p>A few steps are needed to set this up:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask app-portage/cpuid2cpuflags</code></div></div> 
<p>Inspect the output manually if curious:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cpuid2cpuflags</code></div></div>
<p>Then copy the output into <span style="font-family: monospace; font-size: 95%">package.use</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>echo "*/* $(cpuid2cpuflags)" &gt; /etc/portage/package.use/00cpu-flags</code></div></div>
<h4><span class="mw-headline" id="VIDEO_CARDS">VIDEO_CARDS</span></h4>
<p>The <var>VIDEO_CARDS USE_EXPAND</var> variable should be configured appropriately depending on the available GPU(s). The <a href="/wiki/Xorg/Guide#Make.conf_configuration" title="Xorg/Guide">Xorg guide</a> covers how to do this. Setting <var>VIDEO_CARDS</var> is not required for a console only install.
</p>
<h3><span class="mw-headline" id="Optional:_Configure_the_ACCEPT_LICENSE_variable">Optional: Configure the ACCEPT_LICENSE variable</span></h3>
<p>The licenses of a Gentoo package are stored in the <var>LICENSE</var> variable in the ebuild.
The accepted specific licenses or groups of licenses of a system are defined in the following files
</p>
<ul><li>system wide in the profile</li>
<li>system wide in <span style="font-family: monospace; font-size: 95%">/etc/portage/make.conf</span></li>
<li>per package in <span style="font-family: monospace; font-size: 95%">/etc/portage/package.license</span>.</li></ul>
<p>Portage looks up in the <var>ACCEPT_LICENSE</var> which packages to allow for installation. 
In order to print the current system wide value run:
</p>
<div class="cmd-box"><div><code style="color: #4E9A06; font-weight: bold;">user <span style="color:royalblue;">$</span></code><span class="tripleclick-separator"></span><code>portageq envvar ACCEPT_LICENSE</code></div><pre>@FREE</pre></div>
<p>Optionally override the system wide accepted default in the profiles by changing <span style="font-family: monospace; font-size: 95%">/etc/portage/make.conf</span>. 
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/portage/make.conf</code></strong><strong>Example how to accept licenses with ACCEPT_LICENSE system wide</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-ini mw-content-ltr" dir="ltr"><pre><span></span><span class="na">ACCEPT_LICENSE</span><span class="o">=</span><span class="s">&quot;-* @FREE @BINARY-REDISTRIBUTABLE&quot;</span><span class="w"></span>
</pre></div></pre>
<p>Optionally one can also define accepted licenses per package as shown in this example:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/portage/package.license/kernel</code></strong><strong>Example how to accept licenses per package</strong></div><pre class="captioned">app-arch/unrar unRAR
sys-kernel/linux-firmware @BINARY-REDISTRIBUTABLE
sys-firmware/intel-microcode intel-ucode</pre>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />The <var>LICENSE</var> variable in an ebuild is only a guideline for Gentoo developers and users. It is not a legal statement, and there is no guarantee that it will reflect reality. So don't rely on it, but check the package itself in depth, including all files that you use.</div>
<p>The license groups defined in the Gentoo repository, managed by the <a href="/wiki/Project:Licenses" title="Project:Licenses">Gentoo Licenses project</a>, are:
</p>
<table class="table table-stripped table-condensed">

<tbody><tr style="background-color:#dddaec">
<th>Group Name</th>
<th>Description
</th></tr>
<tr>
<td>@GPL-COMPATIBLE</td>
<td>GPL compatible licenses approved by the Free Software Foundation <sup id="cite_ref-1" class="reference"><a href="#cite_note-1">&#91;a_license 1&#93;</a></sup>
</td></tr>
<tr>
<td>@FSF-APPROVED</td>
<td>Free software licenses approved by the FSF (includes @GPL-COMPATIBLE)
</td></tr>
<tr>
<td>@OSI-APPROVED</td>
<td>Licenses approved by the Open Source Initiative <sup id="cite_ref-2" class="reference"><a href="#cite_note-2">&#91;a_license 2&#93;</a></sup>
</td></tr>
<tr>
<td>@MISC-FREE</td>
<td>Misc licenses that are probably free software, i.e. follow the Free Software Definition <sup id="cite_ref-3" class="reference"><a href="#cite_note-3">&#91;a_license 3&#93;</a></sup> but are not approved by either FSF or OSI
</td></tr>
<tr>
<td>@FREE-SOFTWARE</td>
<td>Combines @FSF-APPROVED, @OSI-APPROVED and @MISC-FREE
</td></tr>
<tr>
<td>@FSF-APPROVED-OTHER</td>
<td>FSF-approved licenses for "free documentation" and "works of practical use besides software and documentation" (including fonts)
</td></tr>
<tr>
<td>@MISC-FREE-DOCS</td>
<td>Misc licenses for free documents and other works (including fonts) that follow the free definition <sup id="cite_ref-4" class="reference"><a href="#cite_note-4">&#91;a_license 4&#93;</a></sup> but are NOT listed in @FSF-APPROVED-OTHER
</td></tr>
<tr>
<td>@FREE-DOCUMENTS</td>
<td>Combines @FSF-APPROVED-OTHER and @MISC-FREE-DOCS
</td></tr>
<tr>
<td>@FREE</td>
<td>Metaset of all licenses with the freedom to use, share, modify and share modifications. Combines @FREE-SOFTWARE and @FREE-DOCUMENTS
</td></tr>
<tr>
<td>@BINARY-REDISTRIBUTABLE</td>
<td>Licenses that at least permit free redistribution of the software in binary form. Includes @FREE
</td></tr>
<tr>
<td>@EULA</td>
<td>License agreements that try to take away your rights. These are more restrictive than "all-rights-reserved" or require explicit approval
</td></tr></tbody></table>
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1"></a></span> <span class="reference-text"> <a rel="nofollow" class="external free" href="https://www.gnu.org/licenses/license-list.html">https://www.gnu.org/licenses/license-list.html</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite_ref-2"></a></span> <span class="reference-text"><a rel="nofollow" class="external free" href="https://www.opensource.org/licenses">https://www.opensource.org/licenses</a></span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite_ref-3"></a></span> <span class="reference-text"> <a rel="nofollow" class="external free" href="https://www.gnu.org/philosophy/free-sw.html">https://www.gnu.org/philosophy/free-sw.html</a></span>
</li>
<li id="cite_note-4"><span class="mw-cite-backlink"><a href="#cite_ref-4"></a></span> <span class="reference-text"><a rel="nofollow" class="external free" href="https://freedomdefined.org/">https://freedomdefined.org/</a></span>
</li>
</ol></div>
<p><br />
</p>
<h2><span class="mw-headline" id="Optional:_Using_systemd_as_the_init_system">Optional: Using systemd as the init system</span></h2>
<p>The remainder of the Gentoo Handbook focuses on <a href="/wiki/OpenRC" title="OpenRC">OpenRC</a> (the traditional Gentoo init system) as the default init system. If systemd is desired, please consult the <a href="/wiki/Systemd" title="Systemd">systemd</a> article. It contains instructions equivalent to the instructions in the following sections of this Handbook. Specifically, it will walk the reader through various init system commands (<span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">systemctl</span>) and systemd-specific services (such as <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">timedatectl</span>, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">hostnamectl</span>, etc.) needed to establish a working systemd environment.
</p>
<h2><span class="mw-headline" id="Timezone">Timezone</span></h2>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />This step does not apply to users of the musl libc. Users who do not know what that means should perform this step.</div>
<p>Select the timezone for the system. Look for the available timezones in <span style="font-family: monospace; font-size: 95%">/usr/share/zoneinfo/</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls /usr/share/zoneinfo</code></div></div>
<p>Suppose the timezone of choice is <i>Europe/Brussels</i>.
</p>
<h3><span class="mw-headline" id="OpenRC_2">OpenRC</span></h3>
<p>We write the timezone name into the <span style="font-family: monospace; font-size: 95%">/etc/timezone</span> file.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>echo "Europe/Brussels" &gt; /etc/timezone</code></div></div>
<p>Please avoid the <span style="font-family: monospace; font-size: 95%">/usr/share/zoneinfo/Etc/GMT*</span> timezones as their names do not indicate the expected zones. For instance, <span style="font-family: monospace; font-size: 95%">GMT-8</span> is in fact <span style="font-family: monospace; font-size: 95%">GMT+8</span>.
</p><p>Next, reconfigure the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-libs/timezone-data">sys-libs/timezone-data</a> package, which will update the <span style="font-family: monospace; font-size: 95%">/etc/localtime</span> file for us, based on the <span style="font-family: monospace; font-size: 95%">/etc/timezone</span> entry. The <span style="font-family: monospace; font-size: 95%">/etc/localtime</span> file is used by the system C library to know the timezone the system is in.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --config sys-libs/timezone-data</code></div></div>
<h3><span class="mw-headline" id="systemd_2">systemd</span></h3>
<p>A slightly different approach is employed when using systemd. A symbolic link is generated:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ln -sf ../usr/share/zoneinfo/Europe/Brussels /etc/localtime</code></div></div>
<p>Later, when systemd is running, the timezone and related settings can be configured with the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">timedatectl</span> command.
</p>
<h2><span class="mw-headline" id="Configure_locales">Configure locales</span></h2>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />This step does not apply to users of the musl libc. Users who do not know what that means should perform this step.</div>
<h3><span class="mw-headline" id="Locale_generation">Locale generation</span></h3>
<p>Most users will want to use only one or two locales on their system.
</p><p>Locales specify not only the language that the user should use to interact with the system, but also the rules for sorting strings, displaying dates and times, etc. Locales are <i>case sensitive</i> and must be represented exactly as described. A full listing of available locales can be found in the <span style="font-family: monospace; font-size: 95%">/usr/share/i18n/SUPPORTED</span> file.
</p><p>Supported system locales must be defined in the <span style="font-family: monospace; font-size: 95%">/etc/locale.gen</span> file.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/locale.gen</code></div></div>
<p>The following locales are an example to get both English (United States) and German (Germany/Deutschland) with the accompanying character formats (like UTF-8).
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/locale.gen</code></strong><strong>Enabling US and DE locales with the appropriate character formats</strong></div><pre class="captioned">en_US ISO-8859-1
en_US.UTF-8 UTF-8
de_DE ISO-8859-1
de_DE.UTF-8 UTF-8</pre>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />We <i>strongly</i> suggest adding at least one UTF-8 locale because many applications may require it to build properly.</div>
<p>The next step is to run the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">locale-gen</span> command. This command generates all locales specified in the <span style="font-family: monospace; font-size: 95%">/etc/locale.gen</span> file.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>locale-gen</code></div></div>
<p>To verify that the selected locales are now available, run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">locale -a</span>.
</p><p>On systemd installs, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">localectl</span> can be used, e.g. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">localectl set-locale ...</span> or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">localectl list-locales</span>.
</p>
<h3><span class="mw-headline" id="Locale_selection">Locale selection</span></h3>
<p>Once done, it is now time to set the system-wide locale settings. Again we use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect</span> for this, now with the <code>locale</code> module.
</p><p>With <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect locale list</span>, the available targets are displayed:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect locale list</code></div><pre>Available targets for the LANG variable:
  [1]  C
  [2]  C.utf8
  [3]  en_US
  [4]  en_US.iso88591
  [5]  en_US.utf8
  [6]  de_DE
  [7]  de_DE.iso88591
  [8]  de_DE.iso885915
  [9]  de_DE.utf8
  [10] POSIX
  [ ]  (free form)
</pre></div>
<p>With <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">eselect locale set &lt;NUMBER&gt;</span> the correct locale can be selected:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect locale set 9</code></div></div>
<p>Manually, this can still be accomplished through the <span style="font-family: monospace; font-size: 95%">/etc/env.d/02locale</span> file and for Systemd the <span style="font-family: monospace; font-size: 95%">/etc/locale.conf</span> file:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/env.d/02locale</code></strong><strong>Manually setting system locale definitions</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;de_DE.UTF-8&quot;</span>
<span class="nv">LC_COLLATE</span><span class="o">=</span><span class="s2">&quot;C.UTF-8&quot;</span>
</pre></div></pre>
<p>Setting the locale will avoid warnings and errors during kernel and software compilations later in the installation.
</p><p>Now reload the environment:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>env-update &amp;&amp; source /etc/profile &amp;&amp; export PS1="(chroot) ${PS1}"</code></div></div>
<p>For additional guidance through the locale selection process read also the <a href="/wiki/Localization/Guide" title="Localization/Guide">Localization guide</a> and the <a href="/wiki/UTF-8" title="UTF-8">UTF-8</a> guide.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span id="Optional:_Installing_firmware_and/or_microcode"></span><span class="mw-headline" id="Optional:_Installing_firmware_and.2For_microcode">Optional: Installing firmware and/or microcode</span></h2>
<p>Before getting to configuring kernel sections, it is beneficial to be aware that some devices require additional firmware to be installed on the system before they will operate correctly. This is often the case for network interfaces, especially wireless network interfaces commonly used in both desktop and laptop computers. Modern video chips from vendors like AMD, Nvidia, and Intel, often need external firmware files to be fully functional. Most firmware for modern hardware is available in the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel/linux-firmware</a> package. On systems using graphics cards from these vendors, it is wise to emerge this firmware package in order to have it available before configuring and compiling the kernel.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/linux-firmware</code></div></div> 
<p>In addition to discrete graphics hardware and network interfaces, CPUs also can require firmware updates. Typically this kind of firmware is referred to as microcode. Newer revisions of microcode are sometimes necessary to patch instability, security concerns, or other bugs in CPU hardware. 
</p><p>Microcode updates for AMD CPUs are typically distributed with the aforementioned linux-firmware package. Microcode for Intel CPUs can be found in the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-firmware/intel-microcode">sys-firmware/intel-microcode</a> package, which will need to be installed separately. See the <a href="/wiki/Microcode" title="Microcode">Microcode article</a> for more information on how to apply microcode updates.
</p>
<h2><span class="mw-headline" id="Kernel_configuration_and_compilation">Kernel configuration and compilation</span></h2>
<p>Now it is time to configure and compile the kernel sources. There are three approaches for this:
</p>
<ol><li>The kernel is manually configured and built.</li>
<li>A tool called <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> is used to automatically build and install the Linux kernel.</li>
<li>A <a href="/wiki/Project:Distribution_Kernel" title="Project:Distribution Kernel">Distribution Kernel</a> is used to automatically build and install the Linux kernel like any other package.</li></ol>
<p>Manual configuration is explained as the default choice since it is the best way to optimize an environment.
</p><p>The core around which all distributions are built is the Linux kernel. It is the layer between the user programs and the system hardware. Gentoo provides its users several possible kernel sources. A full listing with description is available at the <a href="/wiki/Kernel/Overview" title="Kernel/Overview">Kernel overview page</a>.
</p>
<h3><span class="mw-headline" id="Installing_the_sources">Installing the sources</span></h3>
<p>When manually installing and compiling the kernel for amd64-based systems, Gentoo recommends the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/gentoo-sources">sys-kernel/gentoo-sources</a> package.
</p><p>Choose an appropriate kernel source and install it using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/gentoo-sources</code></div></div> 
<p>This will install the Linux kernel sources in <span style="font-family: monospace; font-size: 95%">/usr/src/</span> using the specific kernel version in the path. It will not create a symbolic link by itself without <code>USE=symlink</code> being enabled on the chosen kernel sources package.
</p><p>It is conventional for a <span style="font-family: monospace; font-size: 95%">/usr/src/linux</span> symlink to be maintained, such that it refers to whichever sources correspond with the currently running kernel. However, this symbolic link will not be created by default. An easy way to create the symbolic link is to utilize eselect's kernel module.
</p><p>For further information regarding the purpose of the symlink, and how to manage it, please refer to <a href="/wiki/Kernel/Upgrade" title="Kernel/Upgrade">Kernel/Upgrade</a>.
</p><p>First, list all installed kernels:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect kernel list</code></div><pre>Available kernel symlink targets:
  [1]   linux-5.15.52-gentoo
</pre></div>
<p>In order to create a symbolic link called <span style="font-family: monospace; font-size: 95%">linux</span>, use:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>eselect kernel set 1</code></div></div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls -l /usr/src/linux</code></div><pre>lrwxrwxrwx    1 root   root    12 Oct 13 11:04 /usr/src/linux -&gt; linux-5.15.52-gentoo
</pre></div>
<h3><span class="mw-headline" id="Manual_configuration">Manual configuration</span></h3>
<h4><span class="mw-headline" id="Introduction_4">Introduction</span></h4>
<p>Manually configuring a kernel is often seen as the most difficult procedure a Linux user ever has to perform. Nothing is less true - after configuring a couple of kernels no one remembers that it was difficult!
</p><p>However, one thing is true: it is vital to know the system when a kernel is configured manually. Most information can be gathered by emerging <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-apps/pciutils">sys-apps/pciutils</a> which contains the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">lspci</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-apps/pciutils</code></div></div> 
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Inside the chroot, it is safe to ignore any pcilib warnings (like <i>pcilib: cannot open /sys/bus/pci/devices</i>) that <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">lspci</span> might throw out.</div>
<p>Another source of system information is to run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">lsmod</span> to see what kernel modules the installation CD uses as it might provide a nice hint on what to enable.
</p><p>Now go to the kernel source directory and execute <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">make menuconfig</span>. This will fire up menu-driven configuration screen.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cd /usr/src/linux
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>make menuconfig</code></div></div>
<p>The Linux kernel configuration has many, many sections. Let's first list some options that must be activated (otherwise Gentoo will not function, or not function properly without additional tweaks). We also have a <a href="/wiki/Kernel/Gentoo_Kernel_Configuration_Guide" title="Kernel/Gentoo Kernel Configuration Guide">Gentoo kernel configuration guide</a> on the Gentoo wiki that might help out further.
</p>
<h4><span class="mw-headline" id="Activating_required_options">Activating required options</span></h4>
<p>When using <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/gentoo-sources">sys-kernel/gentoo-sources</a>, it is strongly recommend the Gentoo-specific configuration options be enabled. These ensure that a minimum of kernel features required for proper functioning is available:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Enabling Gentoo-specific options</strong></div><pre class="captioned">Gentoo Linux ---&gt;
  Generic Driver Options ---&gt;
    [*] Gentoo Linux support
    [*]   Linux dynamic and persistent device naming (userspace devfs) support
    [*]   Select options required by Portage features
        Support for init systems, system and service managers  ---&gt;
          [*] OpenRC, runit and other script based systems and managers
          [*] systemd</pre>
<p>Naturally the choice in the last two lines depends on the selected init system (<a href="/wiki/OpenRC" title="OpenRC">OpenRC</a> vs. <a href="/wiki/Systemd" title="Systemd">systemd</a>). It does not hurt to have support for both init systems enabled.
</p><p>When using <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/vanilla-sources">sys-kernel/vanilla-sources</a>, the additional selections for init systems will be unavailable. Enabling support is possible, but goes beyond the scope of the handbook.
</p><p>Make sure that every driver that is vital to the booting of the system (such as SCSI controller, etc.) is compiled in the kernel and not as a module, otherwise the system will not be able to boot completely.
</p><p>Next select the exact processor type. It is also recommended to enable MCE features (if available) so that users are able to be notified of any hardware problems. On some architectures (such as x86_64), these errors are not printed to <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">dmesg</span>, but to <span style="font-family: monospace; font-size: 95%">/dev/mcelog</span>. This requires the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/mcelog">app-admin/mcelog</a> package. 
</p><p>Also select <i>Maintain a devtmpfs file system to mount at /dev</i> so that critical device files are already available early in the boot process (<var>CONFIG_DEVTMPFS</var> and <var>CONFIG_DEVTMPFS_MOUNT</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Enabling devtmpfs support</strong></div><pre class="captioned">Device Drivers ---&gt;
  Generic Driver Options ---&gt;
    [*] Maintain a devtmpfs filesystem to mount at /dev
    [*]   Automount devtmpfs at /dev, after the kernel mounted the rootfs</pre>
<p>Verify SCSI disk support has been activated (<var>CONFIG_BLK_DEV_SD</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Enabling SCSI disk support</strong></div><pre class="captioned">Device Drivers ---&gt;
   SCSI device support  ---&gt;
      &lt;*&gt; SCSI disk support</pre>
<p>Now go to File Systems and select support for the filesystems that will be used by the system. Do not compile the file system that is used for the root filesystem as module, otherwise the system may not be able to mount the partition. Also select <i>Virtual memory</i> and <i>/proc file system</i>. Select one or more of the following options as needed by the system (<var>CONFIG_EXT2_FS</var>, <var>CONFIG_EXT3_FS</var>, <var>CONFIG_EXT4_FS</var>, <var>CONFIG_MSDOS_FS</var>, <var>CONFIG_VFAT_FS</var>, <var>CONFIG_PROC_FS</var>, and <var>CONFIG_TMPFS</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Selecting necessary file systems</strong></div><pre class="captioned">File systems ---&gt;
  &lt;*&gt; Second extended fs support
  &lt;*&gt; The Extended 3 (ext3) filesystem
  &lt;*&gt; The Extended 4 (ext4) filesystem
  &lt;*&gt; Reiserfs support
  &lt;*&gt; JFS filesystem support
  &lt;*&gt; XFS filesystem support
  &lt;*&gt; Btrfs filesystem support
  DOS/FAT/NT Filesystems  ---&gt;
    &lt;*&gt; MSDOS fs support
    &lt;*&gt; VFAT (Windows-95) fs support
 
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [*] Tmpfs virtual memory file system support (former shm fs)</pre>
<p>If PPPoE is used to connect to the Internet, or a dial-up modem, then enable the following options (<var>CONFIG_PPP</var>, <var>CONFIG_PPP_ASYNC</var>, and <var>CONFIG_PPP_SYNC_TTY</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Selecting PPPoE necessary drivers</strong></div><pre class="captioned">Device Drivers ---&gt;
  Network device support ---&gt;
    &lt;*&gt; PPP (point-to-point protocol) support
    &lt;*&gt;   PPP support for async serial ports
    &lt;*&gt;   PPP support for sync tty ports</pre>
<p>The two compression options won't harm but are not definitely needed, neither does the PPP over Ethernet option, that might only be used by ppp when configured to do kernel mode PPPoE.
</p><p>Don't forget to include support in the kernel for the network (Ethernet or wireless) cards.
</p><p>Most systems also have multiple cores at their disposal, so it is important to activate <i>Symmetric multi-processing support</i>  (<var>CONFIG_SMP</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Activating SMP support</strong></div><pre class="captioned">Processor type and features  ---&gt;
  [*] Symmetric multi-processing support</pre>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />In multi-core systems, each core counts as one processor.</div>
<p>If USB input devices (like keyboard or mouse) or other USB devices will be used, do not forget to enable those as well (<var>CONFIG_HID_GENERIC</var> and <var>CONFIG_USB_HID</var>, <var>CONFIG_USB_SUPPORT</var>, <var>CONFIG_USB_XHCI_HCD</var>, <var>CONFIG_USB_EHCI_HCD</var>, <var>CONFIG_USB_OHCI_HCD</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Activating USB support for input devices</strong></div><pre class="captioned">Device Drivers ---&gt;
  HID support  ---&gt;
    -*- HID bus support
    &lt;*&gt;   Generic HID driver
    [*]   Battery level reporting for HID devices
      USB HID support  ---&gt;
        &lt;*&gt; USB HID transport layer
  [*] USB support  ---&gt;
    &lt;*&gt;     xHCI HCD (USB 3.0) support
    &lt;*&gt;     EHCI HCD (USB 2.0) support
    &lt;*&gt;     OHCI HCD (USB 1.1) support</pre>
<p><br />
</p>
<h3><span class="mw-headline" id="Architecture_specific_kernel_configuration">Architecture specific kernel configuration</span></h3>
<p>Make sure to select IA32 Emulation if 32-bit programs should be supported (<var>CONFIG_IA32_EMULATION</var>). Gentoo installs a multilib system (mixed 32-bit/64-bit computing) by default, so unless a no-multilib profile is used, this option is required.
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Selecting processor types and features</strong></div><pre class="captioned">Processor type and features  ---&gt;
   [ ] Machine Check / overheating reporting 
   [ ]   Intel MCE Features
   [ ]   AMD MCE Features
   Processor family (AMD-Opteron/Athlon64)  ---&gt;
      ( ) Opteron/Athlon64/Hammer/K8
      ( ) Intel P4 / older Netburst based Xeon
      ( ) Core 2/newer Xeon
      ( ) Intel Atom
      ( ) Generic-x86-64
Binary Emulations ---&gt;
   [*] IA32 Emulation</pre>
<p>Enable GPT partition label support if that was used previously when partitioning the disk (<var>CONFIG_PARTITION_ADVANCED</var> and <var>CONFIG_EFI_PARTITION</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Enable support for GPT</strong></div><pre class="captioned">-*- Enable the block layer ---&gt;
   Partition Types ---&gt;
      [*] Advanced partition selection
      [*] EFI GUID Partition support</pre>
<p>Enable EFI stub support, EFI variables and EFI Framebuffer in the Linux kernel if UEFI is used to boot the system (<var>CONFIG_EFI</var>, <var>CONFIG_EFI_STUB</var>, <var>CONFIG_EFI_MIXED</var>, <var>CONFIG_EFI_VARS</var>, and <var>CONFIG_EFI_FB</var>):
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #4E9A06">KERNEL</span> <strong>Enable support for UEFI</strong></div><pre class="captioned">Processor type and features  ---&gt;
    [*] EFI runtime service support 
    [*]   EFI stub support
    [*]     EFI mixed-mode support
 
Device Drivers
    Firmware Drivers  ---&gt;
        EFI (Extensible Firmware Interface) Support  ---&gt;
            &lt;*&gt; EFI Variable Support via sysfs
    Graphics support  ---&gt;
        Frame buffer Devices  ---&gt;
            &lt;*&gt; Support for frame buffer devices  ---&gt;
                [*]   EFI-based Framebuffer Support</pre>
<h3><span class="mw-headline" id="Compiling_and_installing">Compiling and installing</span></h3>
<p>With the configuration now done, it is time to compile and install the kernel. Exit the configuration and start the compilation process:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>make &amp;&amp; make modules_install</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />It is possible to enable parallel builds using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">make -jX</span> with <code>X</code> being an integer number of parallel tasks that the build process is allowed to launch. This is similar to the instructions about <span style="font-family: monospace; font-size: 95%">/etc/portage/make.conf</span> earlier, with the <var>MAKEOPTS</var> variable.</div>
<p>When the kernel has finished compiling, copy the kernel image to <span style="font-family: monospace; font-size: 95%">/boot/</span>. This is handled by the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">make install</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>make install</code></div></div>
<p>This will copy the kernel image into <span style="font-family: monospace; font-size: 95%">/boot/</span> together with the <span style="font-family: monospace; font-size: 95%">System.map</span> file and the kernel configuration file.
</p><p><br />
</p>
<h4><span class="mw-headline" id="Optional:_Building_an_initramfs">Optional: Building an initramfs</span></h4>
<p>In certain cases it is necessary to build an initramfs - an <b>i</b>nitial <b>ram</b>-based <b>f</b>ile <b>s</b>ystem. The most common reason is when important file system locations (like <span style="font-family: monospace; font-size: 95%">/usr/</span> or <span style="font-family: monospace; font-size: 95%">/var/</span>) are on separate partitions. With an initramfs, these partitions can be mounted using the tools available inside the initramfs.
</p><p>Without an initramfs, there is a risk that the system will not boot properly as the tools that are responsible for mounting the file systems require information that resides on unmounted file systems. An initramfs will pull in the necessary files into an archive which is used right after the kernel boots, but before the control is handed over to the init tool. Scripts on the initramfs will then make sure that the partitions are properly mounted before the system continues booting.
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />If using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span>, it should be used for both building the kernel <i>and</i> the initramfs. When using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> only for generating an initramfs, it is crucial to pass <code>--kernel-config=/path/to/kernel.config</code> to <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> or the generated initramfs <b>may not work</b> with a manually built kernel. Note that manually built kernels go beyond the scope of support for the handbook. See the <a href="/wiki/Kernel/Configuration" title="Kernel/Configuration">kernel configuration</a> article for more information.</div>
<p>To install an initramfs, install <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/dracut">sys-kernel/dracut</a> first, then have it generate an initramfs:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/dracut</code></div></div> 
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>dracut --kver=5.15.52-gentoo</code></div></div>
<p>The initramfs will be stored in <span style="font-family: monospace; font-size: 95%">/boot/</span>. The resulting file can be found by simply listing the files starting with <i>initramfs</i>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls /boot/initramfs*</code></div></div>
<p>Now continue with <a href="#Kernel_modules">Kernel modules</a>.
</p>
<h2><span class="mw-headline" id="Alternative:_Using_genkernel">Alternative: Using genkernel</span></h2>
<p>If a manual configuration looks too daunting, then consider using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span>. It will configure and build the kernel automatically.
</p><p><span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> works by configuring a kernel nearly identically to the way the installation CD kernel is configured. This means that when <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> is used to build the kernel, the system will generally detect hardware it was built for support with at boot-time, just like the installation CD does. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> may be a useful solution for those users who may not be comfortable compiling their own kernels. Note that genkernel does <b>not</b> automatically generate a custom kernel configuration the hardware on which it is being run.
</p><p>Now, let's see how to use genkernel. First, emerge the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-kernel/genkernel">sys-kernel/genkernel</a> ebuild:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/genkernel</code></div></div> 
<p>Next, edit the <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> file so that the line containing <span style="font-family: monospace; font-size: 95%">/boot/</span> as second field has the first field pointing to the right device. If the partitioning example from the handbook is followed, then this device is most likely /dev/sda1 with the ext4 file system. This would make the entry in the file look like so:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/fstab</code></div></div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/fstab</code></strong><strong>Configuring the /boot mountpoint</strong></div><pre class="captioned">/dev/sda1	/boot	ext4	defaults	0 2</pre>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Further in the Gentoo installation, <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> will be configured again. The <span style="font-family: monospace; font-size: 95%">/boot</span> setting is needed right now as the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> application reads in this configuration.</div>
<p>Now, compile the kernel sources by running <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel all</span>. Be aware though, as <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> compiles a kernel that supports almost all hardware, this compilation will take quite a while to finish!
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If the root partition/volume doesn't use ext4 as filesystem it <i>might</i> be necessary to manually configure the kernel using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel --menuconfig all</span> and add support for this particular filesystem in the kernel (i.e. not as a module). Users of LVM2 will probably want to add <code>--lvm</code> as an argument as well.</div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>genkernel all</code></div></div>
<p>Once genkernel completes, a kernel, full set of modules and initial ram disk (initramfs) will be created. We will use the kernel and initrd when configuring a boot loader later in this document. Write down the names of the kernel and initrd as this information is used when the boot loader configuration file is edited. The initrd will be started immediately after booting to perform hardware autodetection (just like on the installation CD) before the "real" system starts up.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ls /boot/vmlinu* /boot/initramfs*</code></div></div>
<h2><span class="mw-headline" id="Alternative:_Using_distribution_kernels">Alternative: Using distribution kernels</span></h2>
<p><i><a href="/wiki/Project:Distribution_Kernel" title="Project:Distribution Kernel">Distribution Kernels</a></i> are ebuilds that cover the complete process of unpacking, configuring, compiling, and installing the kernel. The primary advantage of this method is that the kernels are upgraded to new versions as part of @world upgrade without a need for manual action. Distribution kernels default to a configuration supporting the majority of hardware but they can be customized via <span style="font-family: monospace; font-size: 95%">/etc/portage/savedconfig</span>.
</p><p>There are other methods available to customize the kernel config such as <a href="/wiki/Project:Distribution_Kernel#Using_.2Fetc.2Fkernel.2Fconfig.d" title="Project:Distribution Kernel">config snippets</a>.
</p>
<h4><span class="mw-headline" id="Installing_correct_installkernel">Installing correct installkernel</span></h4>
<p>Before using the distribution kernels, please verify that the correct installkernel package for the system is installed. When using <a href="/wiki/Systemd-boot" title="Systemd-boot">systemd-boot</a> (formerly gummiboot), install:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/installkernel-systemd-boot</code></div></div> 
<p>When using a traditional <span style="font-family: monospace; font-size: 95%">/boot</span> layout (e.g. GRUB, LILO, etc.), the <i>gentoo</i> variant should be installed by default. If in doubt:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/installkernel-gentoo</code></div></div> 
<h4><span class="mw-headline" id="Installing_a_distribution_kernel">Installing a distribution kernel</span></h4>
<p>To build a kernel with Gentoo patches from source, type:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/gentoo-kernel</code></div></div> 
<p>System administrators who want to avoid compiling the kernel sources locally can instead use precompiled kernel images:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-kernel/gentoo-kernel-bin</code></div></div> 
<h4><span class="mw-headline" id="Upgrading_and_cleaning_up">Upgrading and cleaning up</span></h4>
<p>Once the kernel is installed, the package manager will automatically upgrade it to newer versions. The previous versions will be kept until the package manager is requested to clean up stale packages. Please remember to periodically run:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --depclean</code></div></div>
<p>to save space. Alternatively, to specifically clean up old kernel versions:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --prune sys-kernel/gentoo-kernel sys-kernel/gentoo-kernel-bin</code></div></div>
<h4><span id="Post-install/upgrade_tasks"></span><span class="mw-headline" id="Post-install.2Fupgrade_tasks">Post-install/upgrade tasks</span></h4>
<p>Distribution kernels are now capable of rebuilding kernel modules installed by other packages. <code>linux-mod.eclass</code> provides <code>USE=dist-kernel</code> which controls a subslot dependency on <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/virtual/dist-kernel">virtual/dist-kernel</a>.
</p><p>Enabling this on packages like <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/zfs">sys-fs/zfs</a> and <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/zfs-kmod">sys-fs/zfs-kmod</a> allows them to automatically be rebuilt against the new kernel and re-generate the initramfs if applicable accordingly!
</p>
<h5><span class="mw-headline" id="Manually_rebuilding_the_initramfs">Manually rebuilding the initramfs</span></h5>
<p>If required, manually trigger such rebuilds by, after a kernel upgrade, executing:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask @module-rebuild</code></div></div> 
<p>If any of these modules (e.g. ZFS) are needed at early boot, rebuild the initramfs afterward:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --config sys-kernel/gentoo-kernel</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --config sys-kernel/gentoo-kernel-bin</code></div></div>
<h2><span class="mw-headline" id="Kernel_modules">Kernel modules</span></h2>
<h3><span class="mw-headline" id="Configuring_the_modules">Configuring the modules</span></h3>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Hardware modules are optional to be listed manually. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">udev</span> will normally load all hardware modules that are detected to be connected in most cases.  However, it is not harmful for automatically detected modules to be listed.  Sometimes exotic hardware requires help to load their drivers.</div>
<p>List the modules that need to be loaded automatically in <span style="font-family: monospace; font-size: 95%">/etc/modules-load.d/*.conf</span> files one module per line. Extra options for the modules, if necessary, should be set in <span style="font-family: monospace; font-size: 95%">/etc/modprobe.d/*.conf</span> files.
</p><p>To view all available modules, run the following <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">find</span> command. Don't forget to substitute "&lt;kernel version&gt;" with the version of the kernel just compiled:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>find /lib/modules/&lt;kernel version&gt;/ -type f -iname '*.o' -or -iname '*.ko' | less</code></div></div>
<p>For instance, to automatically load the <span style="font-family: monospace; font-size: 95%">3c59x.ko</span> module (which is the driver for a specific 3Com network card family), edit the <span style="font-family: monospace; font-size: 95%">/etc/modules-load.d/network.conf</span> file and enter the module name in it. The actual file name is insignificant to the loader.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkdir -p /etc/modules-load.d
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/modules-load.d/network.conf
</code></div></div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/modules-load.d/network.conf</code></strong><strong>Force loading 3c59x module</strong></div><pre class="captioned">3c59x</pre>
<p>Continue the installation with <a href="/wiki/Handbook:AMD64/Installation/System" title="Handbook:AMD64/Installation/System">Configuring the system</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Filesystem_information">Filesystem information</span></h2>
<h3><span class="mw-headline" id="About_fstab">About fstab</span></h3>
<p>Under Linux, all partitions used by the system must be listed in <span style="font-family: monospace; font-size: 95%"><a href="/wiki//etc/fstab" title="/etc/fstab">/etc/fstab</a></span>. This file contains the mount points of those partitions (where they are seen in the file system structure), how they should be mounted and with what special options (automatically or not, whether users can mount them or not, etc.)
</p>
<h3><span class="mw-headline" id="Creating_the_fstab_file">Creating the fstab file</span></h3>
<p>The <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> file uses a table-like syntax. Every line consists of six fields, separated by whitespace (space(s), tabs, or a mixture of the two). Each field has its own meaning:
</p>
<ol><li>The first field shows the block special device or remote filesystem to be mounted. Several kinds of device identifiers are available for block special device nodes, including paths to device files, filesystem labels and UUIDs, and partition labels and UUIDs.</li>
<li>The second field shows the mount point at which the partition should be mounted.</li>
<li>The third field shows the filesystem used by the partition.</li>
<li>The fourth field shows the mount options used by <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mount</span> when it wants to mount the partition. As every filesystem has its own mount options, so system admins are encouraged to read the mount man page (<span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">man mount</span>) for a full listing. Multiple mount options are comma-separated.</li>
<li>The fifth field is used by dump to determine if the partition needs to be dumped or not. This can generally be left as <code>0</code> (zero).</li>
<li>The sixth field is used by <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">fsck</span> to determine the order in which filesystems should be checked if the system wasn't shut down properly. The root filesystem should have <code>1</code> while the rest should have <code>2</code> (or <code>0</code> if a filesystem check is not necessary).</li></ol>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />The default <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> file provided in Gentoo stage files is <i>not</i> a valid <span style="font-family: monospace; font-size: 95%">fstab</span> file but instead a template that can be used to enter in relevant values.</div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/fstab</code></div></div>
<p>In the remainder of the text, the default <span style="font-family: monospace; font-size: 95%">/dev/sd*</span> block device files will be used as partition identifiers.
</p>
<h4><span class="mw-headline" id="Filesystem_labels_and_UUIDs">Filesystem labels and UUIDs</span></h4>
<p>Both MBR (BIOS) and GPT include support for <i>filesystem</i> labels and <i>filesystem</i> UUIDs. These attributes can be defined in <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> as alternatives for the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mount</span> command to use when attempting to find and mount block devices. Filesystem labels and UUIDs are identified by the <var>LABEL</var> and <var>UUID</var> prefix and can be viewed with the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">blkid</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>blkid</code></div></div>
<div class="alert alert-danger gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-triangle"></i> Warning</strong><br />If the filesystem inside a partition is wiped, then the filesystem label and the UUID values will be subsequently altered or removed.</div>
<p>Because of uniqueness, readers that are using an MBR-style partition table are recommended to use UUIDs over labels to define mountable volumes in <span style="font-family: monospace; font-size: 95%">/etc/fstab</span>.
</p>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />UUIDs of the filesystem on a LVM volume and its LVM snapshots are identical, therefore using UUIDs to mount LVM volumes should be avoided.</div>
<h4><span class="mw-headline" id="Partition_labels_and_UUIDs">Partition labels and UUIDs</span></h4>
<p>Users who have gone the GPT route have a couple more 'robust' options available to define partitions in <span style="font-family: monospace; font-size: 95%">/etc/fstab</span>. Partition labels and partition UUIDs can be used to identify the block device's individual partition(s), regardless of what filesystem has been chosen for the partition itself. Partition labels and UUIDs are identified by the <var>PARTLABEL</var> and <var>PARTUUID</var> prefixes respectively and can be viewed nicely in the terminal by running the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">blkid</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>blkid</code></div></div>
<p>While not always true for partition labels, using a UUID to identify a partition in <span style="font-family: monospace; font-size: 95%">fstab</span> provides a guarantee that the bootloader will not be confused when looking for a certain volume, even if the filesystem would be changed in the future. Using the older default block device files (<span style="font-family: monospace; font-size: 95%">/dev/sd*N</span>) for defining the partitions in <span style="font-family: monospace; font-size: 95%">fstab</span> is risky for systems that are restarted often and have SATA block devices added and removed regularly.
</p><p>The naming for block device files depends on a number of factors, including how and in what order the disks are attached to the system. They also could show up in a different order depending on which of the devices are detected by the kernel first during the early boot process. With this being stated, unless one intends to constantly fiddle with the disk ordering, using default block device files is a simple and straightforward approach.
</p><p><br />
Let us take a look at how to write down the options for the <span style="font-family: monospace; font-size: 95%">/boot/</span> partition. This is just an example, and should be modified according to the partitioning decisions made earlier in the installation.
In our amd64 partitioning example, <span style="font-family: monospace; font-size: 95%">/boot/</span> is usually the <span style="font-family: monospace; font-size: 95%">/dev/sda1</span> partition, with ext4 as filesystem. It needs to be checked during boot, so we would write down:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/fstab</code></strong><strong>An example /boot line for /etc/fstab</strong></div><pre class="captioned"># Adjust any formatting difference from the Preparing the disks step
/dev/sda1   /boot     vfat    defaults        0 2</pre>
<p>Some users don't want their <span style="font-family: monospace; font-size: 95%">/boot/</span> partition to be mounted automatically to improve their system's security. Those people should substitute <i>defaults</i> with <i>noauto</i>. This does mean that those users will need to manually mount this partition every time they want to use it.
</p><p>Add the rules that match the previously decided partitioning scheme and append rules for devices such as CD-ROM drive(s), and of course, if other partitions or drives are used, for those too.
</p><p>Below is a more elaborate example of an <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> file:
</p><p><br />
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/fstab</code></strong><strong>A full /etc/fstab example</strong></div><pre class="captioned"># Adjust any formatting difference and additional partitions created from the Preparing the disks step
/dev/sda1   /boot        vfat    defaults,noatime     0 2
/dev/sda2   none         swap    sw                   0 0
/dev/sda3   /            ext4    noatime              0 1
  
/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0</pre>
<p>When <code>auto</code> is used in the third field, it makes the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">mount</span> command guess what the filesystem would be. This is recommended for removable media as they can be created with one of many filesystems. The <code>user</code> option in the fourth field makes it possible for non-root users to mount the CD.
</p><p>To improve performance, most users would want to add the <code>noatime</code> mount option, which results in a faster system since access times are not registered (those are not needed generally anyway). This is also recommended for systems with solid state drives (SSDs).
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />Due to degradation in performance, defining the <code>discard</code> mount option in <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> is not recommended. It is generally better to schedule block discards on a periodic basis using a job scheduler such as <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">cron</span> or a timer (systemd). See <a href="/wiki/SSD#Periodic_fstrim_jobs" title="SSD">Periodic fstrim jobs</a> for more information.</div>
<p>Double-check the <span style="font-family: monospace; font-size: 95%">/etc/fstab</span> file, save and quit to continue.
</p>
<h2><span class="mw-headline" id="Networking_information">Networking information</span></h2>
<p>It is important to note the following sections are provided to help the reader quickly setup their system to partake in a local area network.
</p><p>For systems running OpenRC, a more detailed reference for network setup is available in the <a href="/wiki/Handbook:AMD64/Networking/Introduction" title="Handbook:AMD64/Networking/Introduction">advanced network configuration</a> section, which is covered near the end of the handbook. Systems with more specific network needs may need to skip ahead, then return here to continue with the rest of the installation.
</p><p>For more specific systemd network setup, please review see the <a href="/wiki/Systemd#Network" title="Systemd">networking portion</a> of the <a href="/wiki/Systemd" title="Systemd">systemd</a> article.
</p>
<h3><span class="mw-headline" id="Host_and_domain_information">Host and domain information</span></h3>
<p>One of the choices the system administrator has to make is name their PC. This seems to be quite easy, but lots of users are having difficulties finding the appropriate name for the hostname. To speed things up, know that the decision is not final - it can be changed afterwards. In the examples below, the hostname <i>tux</i> is used within the domain <i>homenetwork</i>.
</p>
<h4><span class="mw-headline" id="OpenRC_3">OpenRC</span></h4>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/hostname</code></div><pre># Set the hostname variable to the selected host name
hostname="tux"
</pre></div>
<p>Second, if a domain name is needed, set it in <span style="font-family: monospace; font-size: 95%">/etc/conf.d/net</span>. This is only necessary if the ISP or network administrator says so, or if the network has a DNS server but not a DHCP server. Don't worry about DNS or domain names if the system uses DHCP for dynamic IP address allocation and network configuration.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The <span style="font-family: monospace; font-size: 95%">/etc/conf.d/net</span> file does not exist by default, so needs to be created.</div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/net</code></div><pre># Set the dns_domain_lo variable to the selected domain name
dns_domain_lo="homenetwork"
</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If no domain name is configured, then users will notice they get "This is hostname.(none)" messages at their login screen. This should then be fixed by editing <span style="font-family: monospace; font-size: 95%">/etc/issue</span> and deleting the string <code>.\O</code> from that file.</div>
<p>If a NIS domain is needed (users that do not know this will not need one), define that one too:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/net</code></div><pre># Set the nis_domain_lo variable to the selected NIS domain name
nis_domain_lo="my-nisdomain"
</pre></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />For more information on configuring DNS and NIS, please read the examples provided in <span style="font-family: monospace; font-size: 95%">/usr/share/doc/netifrc-*/net.example.bz2</span> which can be read using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">bzless</span>. Also, it might be interesting to install <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-dns/openresolv">net-dns/openresolv</a> to help manage the DNS/NIS setup.</div>
<h4><span class="mw-headline" id="systemd_3">systemd</span></h4>
<p>To set the system hostname on systemd on a <i>running</i> system, the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">hostnamectl</span> utility is used. During the installation process however, <a href="/wiki/Handbook:AMD64/Installation/System#systemd_2" title="Handbook:AMD64/Installation/System">firstboot</a> must be used instead (see later on in handbook).
</p><p>For setting the hostname to "tux", one would run:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>hostnamectl hostname tux</code></div></div>
<p>View help by running <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">hostnamectl --help</span> or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">man 1 hostnamectl</span>.
</p>
<h3><span class="mw-headline" id="Network">Network</span></h3>
<p>There are <i>many</i> options available for configuring network interfaces. This section covers a only a few methods. Choose the one which seems best suited to the setup needed.
</p>
<h4><span id="DHCP_via_dhcpcd_(any_init_system)"></span><span class="mw-headline" id="DHCP_via_dhcpcd_.28any_init_system.29">DHCP via dhcpcd (any init system)</span></h4>
<p>Most LAN networks operate a DHCP server. If this is the case, then using the dhcpcd program to obtain an IP address is recommended.
</p><p>To install:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask net-misc/dhcpcd</code></div></div> 
<p>To enable and then start the service on OpenRC systems:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add dhcpcd default
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-service dhcpcd start
</code></div></div>
<p>To enable and start the service on systemd systems:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable --now dhcpcd</code></div></div>
<p>With these steps completed, next time the system boots, dhcpcd should obtain an IP address from the DHCP server. See the <a href="/wiki/Dhcpcd" title="Dhcpcd">Dhcpcd</a> article for more details.
</p>
<h4><span id="netifrc_(OpenRC)"></span><span class="mw-headline" id="netifrc_.28OpenRC.29">netifrc (OpenRC)</span></h4>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />This is one particular way of setting up the network using <a href="/wiki/Netifrc" title="Netifrc">Netifrc</a> on OpenRC. Other methods exist for simpler setups like <a href="/wiki/Dhcpcd" title="Dhcpcd">Dhcpcd</a>.</div>
<h5><span class="mw-headline" id="Configuring_the_network">Configuring the network</span></h5>
<p>During the Gentoo Linux installation, networking was already configured. However, that was for the live environment itself and not for the installed environment. Right now, the network configuration is made for the installed Gentoo Linux system.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />More detailed information about networking, including advanced topics like bonding, bridging, 802.1Q VLANs or wireless networking is covered in the <a href="/wiki/Handbook:AMD64/Networking/Introduction" title="Handbook:AMD64/Networking/Introduction">advanced network configuration</a> section.</div>
<p>All networking information is gathered in <span style="font-family: monospace; font-size: 95%">/etc/conf.d/net</span>. It uses a straightforward - yet perhaps not intuitive - syntax. Do not fear! Everything is explained below. A fully commented example that covers many different configurations is available in <span style="font-family: monospace; font-size: 95%">/usr/share/doc/netifrc-*/net.example.bz2</span>.
</p><p>First install <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-misc/netifrc">net-misc/netifrc</a>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask&#160;--noreplace net-misc/netifrc</code></div></div> 
<p>DHCP is used by default. For DHCP to work, a DHCP client needs to be installed. This is described later in Installing Necessary System Tools.
</p><p>If the network connection needs to be configured because of specific DHCP options or because DHCP is not used at all, then open <span style="font-family: monospace; font-size: 95%">/etc/conf.d/net</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/net</code></div></div>
<p>Set both <var>config_eth0</var> and <var>routes_eth0</var> to enter IP address information and routing information:
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />This assumes that the network interface will be called eth0. This is, however, very system dependent. It is recommended to assume that the interface is named the same as the interface name when booted from the installation media if the installation media is sufficiently recent. More information can be found in the <a href="/wiki/Handbook:AMD64/Networking/Advanced#Network_interface_naming" title="Handbook:AMD64/Networking/Advanced">Network interface naming</a> section.</div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/conf.d/net</code></strong><strong>Static IP definition</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">config_eth0</span><span class="o">=</span><span class="s2">&quot;192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255&quot;</span>
<span class="nv">routes_eth0</span><span class="o">=</span><span class="s2">&quot;default via 192.168.0.1&quot;</span>
</pre></div></pre>
<p>To use DHCP, define <var>config_eth0</var>:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/conf.d/net</code></strong><strong>DHCP definition</strong></div><pre class="captioned"><div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">config_eth0</span><span class="o">=</span><span class="s2">&quot;dhcp&quot;</span>
</pre></div></pre>
<p>Please read <span style="font-family: monospace; font-size: 95%">/usr/share/doc/netifrc-*/net.example.bz2</span> for a list of additional configuration options. Be sure to also read up on the DHCP client man page if specific DHCP options need to be set.
</p><p>If the system has several network interfaces, then repeat the above steps for <var>config_eth1</var>, <var>config_eth2</var>, etc.
</p><p>Now save the configuration and exit to continue.
</p>
<h5><span class="mw-headline" id="Automatically_start_networking_at_boot">Automatically start networking at boot</span></h5>
<p>To have the network interfaces activated at boot, they need to be added to the default runlevel.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cd /etc/init.d
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>ln -s net.lo net.eth0
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add net.eth0 default</code></div></div>
<p>If the system has several network interfaces, then the appropriate <span style="font-family: monospace; font-size: 95%">net.*</span> files need to be created just like we did with <span style="font-family: monospace; font-size: 95%">net.eth0</span>.
</p><p>If, after booting the system, it is discovered the network interface name (which is currently documented as <code>eth0</code>) was wrong, then execute the following steps to rectify:
</p>
<ol><li>Update the <span style="font-family: monospace; font-size: 95%">/etc/conf.d/net</span> file with the correct interface name (like <code>enp3s0</code> or <code>enp5s0</code>, instead of <code>eth0</code>).</li>
<li>Create new symbolic link (like <span style="font-family: monospace; font-size: 95%">/etc/init.d/net.enp3s0</span>).</li>
<li>Remove the old symbolic link (<span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">rm /etc/init.d/net.eth0</span>).</li>
<li>Add the new one to the default runlevel.</li>
<li>Remove the old one using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">rc-update del net.eth0 default</span>.</li></ol>
<h3><span class="mw-headline" id="The_hosts_file">The hosts file</span></h3>
<p>Next inform Linux about the network environment. This is defined in <span style="font-family: monospace; font-size: 95%">/etc/hosts</span> and helps in resolving host names to IP addresses for hosts that aren't resolved by the nameserver. 
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/hosts</code></div></div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/hosts</code></strong><strong>Filling in the networking information</strong></div><pre class="captioned"># This defines the current system and must be set
127.0.0.1     tux.homenetwork tux localhost
  
# Optional definition of extra systems on the network
192.168.0.5   jenny.homenetwork jenny
192.168.0.6   benny.homenetwork benny</pre>
<p>Save and exit the editor to continue.
</p>
<h3><span class="mw-headline" id="Optional:_Get_PCMCIA_working">Optional: Get PCMCIA working</span></h3>
<p>PCMCIA users should now install the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-apps/pcmciautils">sys-apps/pcmciautils</a> package.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-apps/pcmciautils</code></div></div> 
<h2><span class="mw-headline" id="System_information">System information</span></h2>
<h3><span class="mw-headline" id="Root_password">Root password</span></h3>
<p>Set the root password using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">passwd</span> command. 
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>passwd</code></div></div>
<p>The root Linux account is an all-powerful account, so pick a strong password. Later an additional regular user account will be created for daily operations.
</p>
<h3><span class="mw-headline" id="Init_and_boot_configuration">Init and boot configuration</span></h3>
<h4><span class="mw-headline" id="OpenRC_4">OpenRC</span></h4>
<p>When using OpenRC with Gentoo, it uses <span style="font-family: monospace; font-size: 95%">/etc/rc.conf</span> to configure the services, startup, and shutdown of a system. Open up <span style="font-family: monospace; font-size: 95%">/etc/rc.conf</span> and enjoy all the comments in the file. Review the settings and change where needed.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/rc.conf</code></div></div>
<p>Next, open <span style="font-family: monospace; font-size: 95%">/etc/conf.d/keymaps</span> to handle keyboard configuration. Edit it to configure and select the right keyboard.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/keymaps</code></div></div>
<p>Take special care with the <var>keymap</var> variable. If the wrong keymap is selected, then weird results will come up when typing on the keyboard.
</p><p>Finally, edit <span style="font-family: monospace; font-size: 95%">/etc/conf.d/hwclock</span> to set the clock options. Edit it according to personal preference.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/conf.d/hwclock</code></div></div>
<p>If the hardware clock is not using UTC, then it is necessary to set <code>clock="local"</code> in the file. Otherwise the system might show clock skew behavior.
</p>
<h4><span class="mw-headline" id="systemd_4">systemd</span></h4>
<p>First, it is recommended to run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">systemd-firstboot</span> which will prepare various components of the system are set correctly for the first boot into the new systemd environment. The passing the following options will include a prompt for the user to set a locale, timezone, hostname, root password, and root shell values. It will also assign a random machine ID to the installation:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemd-firstboot --prompt --setup-machine-id</code></div></div>
<p>Next users should run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">systemctl</span> to reset all installed unit files to the preset policy values:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl preset-all --preset-mode=enable-only</code></div></div>
<p>It's possible to run the full preset changes but this may reset any services which were already configured during the process:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl preset-all</code></div></div>
<p>These two steps will help ensure a smooth transition from the live environment to the installation's first boot.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="System_logger">System logger</span></h2>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />systemd users can usually skip this step unless they specifically want a syslog. systemd includes journald which handles the same functionality.</div>
<p>Some tools are missing from the stage3 archive because several packages provide the same functionality. It is now up to the user to choose which ones to install.
</p><p>The first tool to decide on has to provide logging facilities for the system. Unix and Linux have an excellent history of logging capabilities - if needed, everything that happens on the system can be logged in log files. This happens through the system logger.
</p><p>Gentoo offers several system logger utilities. A few of these include:
</p>
<ul><li><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/sysklogd">app-admin/sysklogd</a> - Offers the traditional set of system logging daemons. The default logging configuration works well out of the box which makes this package a good option for beginners.</li>
<li><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/syslog-ng">app-admin/syslog-ng</a> - An advanced system logger. Requires additional configuration for anything beyond logging to one big file. More advanced users may choose this package based on its logging potential; be aware additional configuration is a necessity for any kind of smart logging.</li>
<li><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/metalog">app-admin/metalog</a> - A highly-configurable system logger.</li></ul>
<p>Others are available through Portage as well - the number of available packages increases on a daily basis.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />If syslog-ng is going to be used, it is recommended to install and configure <a href="/wiki/Logrotate" title="Logrotate">logrotate</a> afterwards as it doesn't provide any rotation mechanism for the log files. Newer versions (&gt;= 2.0) of sysklogd however handle their own log rotation.</div>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />systemd provides its own logging facility called the "journal". Installing a separate syslog provider is optional on systems running systemd, and may require additional configuration to have the syslog daemon read messages from the journal.</div>
<p>To install the system logger of choice, emerge it. On OpenRC, add it to the default runlevel using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">rc-update</span>. The following example installs <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/sysklogd">app-admin/sysklogd</a>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask app-admin/sysklogd</code></div></div> 
<p>On OpenRC:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add sysklogd default</code></div></div>
<p>sysklogd does not install a systemd unit so systemd users either need to use the journal (built-in to systemd) or a different syslog daemon.
</p>
<h2><span class="mw-headline" id="Optional:_Cron_daemon">Optional: Cron daemon</span></h2>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />systemd does not <i>require</i> a cron daemon as it has <i>timers</i>, but it's still possible to run a cron daemon.</div>
<p>Next is the cron daemon. Although it is optional and not required for every system, it is wise to install one.
</p><p>A cron daemon executes scheduled commands. It is very handy if some command needs to be executed regularly (for instance daily, weekly or monthly).
</p><p>Gentoo offers several possible cron daemons, including <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-process/bcron">sys-process/bcron</a>, <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-process/dcron">sys-process/dcron</a>, <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-process/fcron">sys-process/fcron</a>, and <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-process/cronie">sys-process/cronie</a>. Installing one of them is similar to installing a system logger. The following example uses <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-process/cronie">sys-process/cronie</a>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-process/cronie</code></div></div> 
<p>On OpenRC:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add cronie default</code></div></div>
<p>Or on systemd:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable cronie</code></div></div>
<p>If dcron is used, an additional initialization command needs to be executed:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>crontab /etc/crontab</code></div></div>
<p>If fcron is used, an additional emerge step is required:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --config sys-process/fcron</code></div></div> 
<h2><span class="mw-headline" id="Optional:_File_indexing">Optional: File indexing</span></h2>
<p>In order to index the file system to provide faster file location capabilities, install <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-apps/mlocate">sys-apps/mlocate</a>.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-apps/mlocate</code></div></div> 
<h2><span class="mw-headline" id="Optional:_Remote_access">Optional: Remote access</span></h2>
<p>To be able to access the system remotely after installation, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">sshd</span> must be configured to start on boot.
</p><p>To add the <span style="font-family: monospace; font-size: 95%">sshd</span> init script to the default runlevel on OpenRC:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add sshd default</code></div></div>
<p>And on systemd:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable sshd</code></div></div>
<p>If serial console access is needed (which is possible in case of remote servers), <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">agetty</span> must be configured.
</p><p>On OpenRC, uncomment the serial console section in <span style="font-family: monospace; font-size: 95%">/etc/inittab</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/inittab</code></div><pre># SERIAL CONSOLES
s0:12345:respawn:/sbin/agetty 9600 ttyS0 vt100
s1:12345:respawn:/sbin/agetty 9600 ttyS1 vt100
</pre></div>
<p>On systemd, run:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable getty@tty1.service</code></div></div>
<h2><span class="mw-headline" id="Time_synchronization">Time synchronization</span></h2>
<p>It is important to use some method of synchronizing the system clock. This is usually done via the <a href="/wiki/NTP" class="mw-redirect" title="NTP">NTP</a> protocol and software. Other implementations using the NTP protocol exist, like <a href="/wiki/Chrony" title="Chrony">Chrony</a>.
</p><p>To set up Chrony, for example:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask net-misc/chrony</code></div></div> 
<p>On OpenRC, run:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rc-update add chronyd default</code></div></div>
<p>On systemd, run:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable chronyd.service</code></div></div>
<p>Alternatively, systemd users may wish to use the simpler <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">systemd-timesyncd</span> SNTP client which is installed by default.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>systemctl enable systemd-timesyncd.service</code></div></div>
<h2><span class="mw-headline" id="Filesystem_tools">Filesystem tools</span></h2>
<p>Depending on the filesystems used, it is necessary to install the required file system utilities (for checking the filesystem integrity, creating additional file systems etc.). Note that tools for managing ext4 filesystems (<a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/e2fsprogs">sys-fs/e2fsprogs</a>) are already installed as a part of the <a href="/wiki/System_set_(Portage)" title="System set (Portage)">@system set</a>.
</p><p>The following table lists the tools to install if a certain filesystem is used:
</p>
<table class="table table-condensed table-striped" style="text-align: left;">

<tbody><tr style="background-color:#dddaec">
<th scope="col" width="20%">Filesystem
</th>
<th>Package
</th></tr>
<tr>
<td>Ext 4
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/e2fsprogs">sys-fs/e2fsprogs</a>
</td></tr>
<tr>
<td>XFS
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/xfsprogs">sys-fs/xfsprogs</a>
</td></tr>
<tr>
<td>ReiserFS
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/reiserfsprogs">sys-fs/reiserfsprogs</a>
</td></tr>
<tr>
<td>JFS
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/jfsutils">sys-fs/jfsutils</a>
</td></tr>
<tr>
<td>VFAT (FAT32, ...)
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/dosfstools">sys-fs/dosfstools</a>
</td></tr>
<tr>
<td>Btrfs
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/btrfs-progs">sys-fs/btrfs-progs</a>
</td></tr>
<tr>
<td>ZFS
</td>
<td><a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-fs/zfs">sys-fs/zfs</a>
</td></tr></tbody></table>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />For more information on filesystems in Gentoo see the <a href="/wiki/Filesystem" title="Filesystem">filesystem article</a>.</div>
<h2><span class="mw-headline" id="Networking_tools">Networking tools</span></h2>
<p>If networking was previously configured in the <a href="/wiki/Handbook:AMD64/Installation/System" title="Handbook:AMD64/Installation/System">Configuring the system</a> step and network setup is complete, then this 'networking tools' section can be safely skipped. In this case, proceed with the section on <a href="/wiki/Handbook:AMD64/Installation/Bootloader" title="Handbook:AMD64/Installation/Bootloader">Configuring a bootloader</a>.
</p>
<h3><span class="mw-headline" id="Installing_a_DHCP_client">Installing a DHCP client</span></h3>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />Although optional, the majority of users will find that they need a DHCP client to connect to the DHCP server on their network. Please take this opportunity to install a DHCP client. If this step is forgotten, then the system might not be able to get on the network thus making it impossible to download a DHCP client afterward.</div>
<p>In order for the system to automatically obtain an IP address for one or more network interface(s) using netifrc scripts, it is necessary to install a DHCP client. We recommend the use of <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-misc/dhcpcd">net-misc/dhcpcd</a> although many other DHCP clients are available through the Gentoo repository:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask net-misc/dhcpcd</code></div></div> 
<p>More information on <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">dhcpcd</span> can be found in the <a href="/wiki/Dhcpcd" title="Dhcpcd">dhcpcd article</a>.
</p>
<h3><span class="mw-headline" id="Optional:_Installing_a_PPPoE_client">Optional: Installing a PPPoE client</span></h3>
<p>If PPP is used to connect to the internet, install the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-dialup/ppp">net-dialup/ppp</a> package:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask net-dialup/ppp</code></div></div> 
<h3><span class="mw-headline" id="Optional:_Install_wireless_networking_tools">Optional: Install wireless networking tools</span></h3>
<p>If the system will be connecting to wireless networks, install the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-wireless/iw">net-wireless/iw</a> package for Open or WEP networks and/or the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/net-wireless/wpa_supplicant">net-wireless/wpa_supplicant</a> package for WPA or WPA2 networks. <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">iw</span> is also a useful basic diagnostic tool for scanning wireless networks.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask net-wireless/iw net-wireless/wpa_supplicant</code></div></div> 
<p>Now continue with <a href="/wiki/Handbook:AMD64/Installation/Bootloader" title="Handbook:AMD64/Installation/Bootloader">Configuring the bootloader</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Selecting_a_boot_loader">Selecting a boot loader</span></h2>
<p>With the Linux kernel configured, system tools installed and configuration files edited, it is time to install the last important piece of a Linux installation: the boot loader.
</p><p>The boot loader is responsible for firing up the Linux kernel upon boot - without it, the system would not know how to proceed when the power button has been pressed.
</p><p>For <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b>, we document how to configure either <a href="#Default:_GRUB">GRUB</a> or <a href="#Alternative_1:_LILO">LILO</a> for BIOS based systems, and <a href="#Default:_GRUB">GRUB</a> or <a href="#Alternative_2:_efibootmgr">efibootmgr</a> for UEFI systems.
</p><p>In this section of the Handbook a delineation has been made between <i>emerging</i> the boot loader's package and <i>installing</i> a boot loader to a system disk. Here the term <i>emerge</i> will be used to ask <a href="/wiki/Portage" title="Portage">Portage</a> to make the software package available to the system. The term <i>install</i> will signify the boot loader copying files or physically modifying appropriate sections of the system's disk drive in order to render the boot loader <i>activated and ready to operate</i> on the next power cycle.
</p>
<h2><span class="mw-headline" id="Default:_GRUB">Default: GRUB</span></h2>
<p>By default, the majority of Gentoo systems now rely upon <a href="/wiki/GRUB" title="GRUB">GRUB</a> (found in the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-boot/grub">sys-boot/grub</a> package), which is the direct successor to <a href="/wiki/GRUB_Legacy" title="GRUB Legacy">GRUB Legacy</a>. With no additional configuration, GRUB gladly supports older BIOS ("pc") systems. With a small amount of configuration, necessary before build time, GRUB can support more than a half a dozen additional platforms. For more information, consult the <a href="/wiki/GRUB#Prerequisites" title="GRUB">Prerequisites section</a> of the <a href="/wiki/GRUB" title="GRUB">GRUB</a> article.
</p>
<h3><span class="mw-headline" id="Emerge">Emerge</span></h3>
<p>When using an older BIOS system supporting only MBR partition tables, no additional configuration is needed in order to emerge GRUB:
</p>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask&#160;--verbose sys-boot/grub</code></div></div></dd></dl>
<p>A note for UEFI users: running the above command will output the enabled <var>GRUB_PLATFORMS</var> values before emerging. When using UEFI capable systems, users will need to ensure <code>GRUB_PLATFORMS="efi-64"</code> is enabled (as it is the case by default). If that is not the case for the setup, <code>GRUB_PLATFORMS="efi-64"</code> will need to be added to the <span style="font-family: monospace; font-size: 95%">/etc/portage/make.conf</span> file <i>before</i> emerging GRUB so that the package will be built with EFI functionality:
</p>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>echo 'GRUB_PLATFORMS="efi-64"' &gt;&gt; /etc/portage/make.conf</code></div></div></dd></dl>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-boot/grub</code></div></div></dd></dl>
<dl><dd>If GRUB was somehow emerged without enabling <code>GRUB_PLATFORMS="efi-64"</code>, the line (as shown above) can be added to <span style="font-family: monospace; font-size: 95%">make.conf</span> and then dependencies for the <a href="/wiki/World_set_(Portage)" title="World set (Portage)">world package set</a> can be re-calculated by passing the <code>--update --newuse</code> options to <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">emerge</span>:</dd></dl>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask&#160;--update --newuse --verbose sys-boot/grub</code></div></div></dd></dl>
<p>The GRUB software has now been merged to the system, but not yet installed.
</p>
<h3><span class="mw-headline" id="Install">Install</span></h3>
<p>Next, install the necessary GRUB files to the <span style="font-family: monospace; font-size: 95%">/boot/grub/</span> directory via the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub-install</span> command. Presuming the first disk (the one where the system boots from) is <span style="font-family: monospace; font-size: 95%">/dev/sda</span>, one of the following commands will do:
</p>
<ul><li>When using BIOS:</li></ul>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>grub-install /dev/sda</code></div></div></dd></dl>
<ul><li>When using UEFI:</li></ul>
<dl><dd><div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />Make sure the EFI system partition has been mounted <i>before</i> running <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub-install</span>. It is possible for <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub-install</span> to install the GRUB EFI file (<span style="font-family: monospace; font-size: 95%">grubx64.efi</span>) into the wrong directory <b>without</b> providing <i>any</i> indication the wrong directory was used.</div></dd></dl>
<dl><dd><div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>grub-install --target=x86_64-efi --efi-directory=/boot</code></div></div></dd></dl>
<dl><dd><div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />Modify the <code>--efi-directory</code> option to the root of the EFI System Partition. This is necessary if the <span style="font-family: monospace; font-size: 95%">/boot</span> partition was not formatted as a FAT variant.</div></dd></dl>
<dl><dd><div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />If <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub_install</span> returns an error like <code>Could not prepare Boot variable: Read-only file system</code>, it may be necessary to remount the efivars special mount as read-write in order to succeed:  <div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mount -o remount,rw /sys/firmware/efi/efivars</code></div></div> </div></dd></dl>
<p>Some motherboard manufacturers seem to only support the <span style="font-family: monospace; font-size: 95%">/efi/boot/</span> directory location for the .EFI file in the EFI System Partition (ESP). The GRUB installer can perform this operation automatically with the <code>--removable</code> option. Verify the ESP is mounted before running the following commands. Presuming the ESP is mounted at <span style="font-family: monospace; font-size: 95%">/boot</span> (as suggested earlier), execute:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>grub-install --target=x86_64-efi --efi-directory=/boot --removable</code></div></div>
<p>This creates the default directory defined by the UEFI specification, and then copies the <span style="font-family: monospace; font-size: 95%">grubx64.efi</span> file to the 'default' EFI file location defined by the same specification.
</p>
<h3><span class="mw-headline" id="Configure">Configure</span></h3>
<p>Next, generate the GRUB configuration based on the user configuration specified in the <span style="font-family: monospace; font-size: 95%">/etc/default/grub</span> file and <span style="font-family: monospace; font-size: 95%">/etc/grub.d</span> scripts. In most cases, no configuration is needed by users as GRUB will automatically detect which kernel to boot (the highest one available in <span style="font-family: monospace; font-size: 95%">/boot/</span>) and what the root file system is. It is also possible to append kernel parameters in <span style="font-family: monospace; font-size: 95%">/etc/default/grub</span> using the <var>GRUB_CMDLINE_LINUX</var> variable.
</p><p>To generate the final GRUB configuration, run the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub-mkconfig</span> command:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>grub-mkconfig -o /boot/grub/grub.cfg</code></div><pre>Generating grub.cfg ...
Found linux image: /boot/vmlinuz-5.15.52-gentoo
Found initrd image: /boot/initramfs-genkernel-amd64-5.15.52-gentoo
done
</pre></div>
<p>The output of the command must mention that at least one Linux image is found, as those are needed to boot the system. If an initramfs is used or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> was used to build the kernel, the correct initrd image should be detected as well. If this is not the case, go to <span style="font-family: monospace; font-size: 95%">/boot/</span> and check the contents using the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">ls</span> command. If the files are indeed missing, go back to the kernel configuration and installation instructions.
</p>
<div class="alert alert-success gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-check-circle"></i> Tip</strong><br />The <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">os-prober</span> utility can be used in conjunction with GRUB to detect other operating systems from attached drives. Windows 7, 8.1, 10, and other distributions of Linux are detectable. Those desiring dual boot systems should emerge the <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-boot/os-prober">sys-boot/os-prober</a> package then re-run the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">grub-mkconfig</span> command (as seen above). If detection problems are encountered be sure to read the <a href="/wiki/GRUB" title="GRUB">GRUB</a> article in its entirety <i>before</i> asking the Gentoo community for support.</div>
<h2><span class="mw-headline" id="Alternative_1:_LILO">Alternative 1: LILO</span></h2>
<h3><span class="mw-headline" id="Emerge_2">Emerge</span></h3>
<p>LILO, the <b>LI</b>nux<b>LO</b>ader, is the tried and true workhorse of Linux boot loaders. However, it lacks features when compared to GRUB. LILO is still used because, on some systems, GRUB does not work and LILO does. Of course, it is also used because some people know LILO and want to stick with it. Either way, Gentoo supports both bootloaders.
</p><p>Installing LILO is a breeze; just use emerge.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-boot/lilo</code></div></div> 
<h3><span class="mw-headline" id="Configure_2">Configure</span></h3>
<p>To configure LILO, first create <span style="font-family: monospace; font-size: 95%">/etc/lilo.conf</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>nano -w /etc/lilo.conf</code></div></div>
<p>In the configuration file, sections are used to refer to the bootable kernel. Make sure that the kernel files (with kernel version) and initramfs files are known, as they need to be referred to in this configuration file.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If the root filesystem is JFS, add an <code>append="ro"</code> line after each boot item since JFS needs to replay its log before it allows read-write mounting.</div>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/lilo.conf</code></strong><strong>Example LILO configuration</strong></div><pre class="captioned"><pre>boot=/dev/sda             # Install LILO in the MBR
prompt                    # Give the user the chance to select another section
timeout=50                # Wait 5 (five) seconds before booting the default section
default=gentoo            # When the timeout has passed, boot the "gentoo" section
compact                   # This drastically reduces load time and keeps the map file smaller; may fail on some systems
  
image=/boot/vmlinuz-5.15.52-gentoo
  label=gentoo            # Name we give to this section
  read-only               # Start with a read-only root. Do not alter!
  root=/dev/sda3          # Location of the root filesystem
  
image=/boot/vmlinuz-5.15.52-gentoo
  label=gentoo.rescue     # Name we give to this section
  read-only               # Start with a read-only root. Do not alter!
  root=/dev/sda3         # Location of the root filesystem
  append="init=/bin/bb"   # Launch the Gentoo static rescue shell
  
# The next two lines are for dual booting with a Windows system.
# In this example, Windows is hosted on /dev/sda6.
other=/dev/sda6
  label=windows
</pre></pre>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />If a different partitioning scheme and/or kernel image is used, adjust accordingly.</div>
<p>If an initramfs is necessary, then change the configuration by referring to this initramfs file and telling the initramfs where the root device is located:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/lilo.conf</code></strong><strong>Adding initramfs information to a boot entry</strong></div><pre class="captioned"><pre>image=/boot/vmlinuz-5.15.52-gentoo
  label=gentoo
  read-only
  append="root=/dev/sda3"
  initrd=/boot/initramfs-genkernel-amd64-5.15.52-gentoo
</pre></pre>
<p>If additional options need to be passed to the kernel, use an <code>append</code> statement. For instance, to add the <code>video</code> statement to enable framebuffer:
</p>
<div class="box-caption"><span class="label" style="margin-right: .5em; background-color: #54487A">FILE</span> <strong><code style="border: none; background: none; color: #54487A; margin-right: .5em;">/etc/lilo.conf</code></strong><strong>Adding video parameter to the boot options</strong></div><pre class="captioned"><pre>image=/boot/vmlinuz-5.15.52-gentoo
  label=gentoo
  read-only
  root=/dev/sda3
  append="video=uvesafb:mtrr,ywrap,1024x768-32@85"
</pre></pre>
<p>Users that used <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">genkernel</span> should know that their kernels use the same boot options as is used for the installation CD. For instance, if SCSI device support needs to be enabled, add <code>doscsi</code> as kernel option.
</p><p>Now save the file and exit.
</p>
<h3><span class="mw-headline" id="Install_2">Install</span></h3>
<p>To finish up, run the <span style="font-family: monospace; font-size: 95%">/sbin/lilo</span> executable so LILO can apply the <span style="font-family: monospace; font-size: 95%">/etc/lilo.conf</span> settings to the system (i.e. install itself on the disk). Keep in mind that <span style="font-family: monospace; font-size: 95%">/sbin/lilo</span> must be executed each time a new kernel is installed or a change has been made to the <span style="font-family: monospace; font-size: 95%">lilo.conf</span> file in order for the system to boot if the filename of the kernel has changed.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>/sbin/lilo</code></div></div>
<h2><span class="mw-headline" id="Alternative_2:_efibootmgr">Alternative 2: efibootmgr</span></h2>
<p>On UEFI based systems, the UEFI firmware on the system (in other words the primary bootloader), can be directly manipulated to look for UEFI boot entries. Such systems do not need to have additional (also known as secondary) bootloaders like GRUB in order to help boot the system. With that being said, the reason EFI-based bootloaders such as GRUB exist is to <i>extend</i> the functionality of UEFI systems during the boot process. Using <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">efibootmgr</span> is really for those who desire to take a minimalist (although more rigid) approach to booting their system; using GRUB (see above) is easier for the majority of users because it offers a flexible approach when booting UEFI systems.
</p><p>Remember <a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/sys-boot/efibootmgr">sys-boot/efibootmgr</a> application is not a bootloader; it is a tool to interact with the UEFI firmware and update its settings, so that the Linux kernel that was previously installed can be booted with additional options (if necessary), or to allow multiple boot entries. This interaction is done through the EFI variables (hence the need for kernel support of EFI vars).
</p><p>Be sure to read through the <a href="/wiki/EFI_stub" title="EFI stub">EFI stub</a> kernel article <i>before</i> continuing. The kernel must have specific options enabled to be directly bootable by the system's UEFI firmware. It might be necessary to recompile the kernel. It is also a good idea to take a look at the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator"><a href="/wiki/Efibootmgr" title="Efibootmgr">efibootmgr</a></span> article.
</p>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />To reiterate, <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">efibootmgr</span> is <i>not</i> a requirement to boot an UEFI system. The Linux kernel itself can be booted immediately, and additional kernel command-line options can be built-in to the Linux kernel (there is a kernel configuration option called <var>CONFIG_CMDLINE</var> that allows the user to specify boot parameters as command-line options. Even an initramfs can be 'built-in' to the kernel.</div>
<p>Those that have decided to take this approach must install the software:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>emerge --ask sys-boot/efibootmgr</code></div></div> 
<p>Then, create the <span style="font-family: monospace; font-size: 95%">/boot/efi/boot/</span> location, and then copy the kernel into this location, calling it <span style="font-family: monospace; font-size: 95%">bootx64.efi</span>:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>mkdir -p /boot/efi/boot
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>cp /boot/vmlinuz-* /boot/efi/boot/bootx64.efi
</code></div></div>
<p>Next, tell the UEFI firmware that a boot entry called "Gentoo" is to be created, which has the freshly compiled EFI stub kernel:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>efibootmgr --create --disk /dev/sda --part 2 --label "Gentoo" --loader "\efi\boot\bootx64.efi"</code></div></div>
<p>If an initial RAM file system (initramfs) is used, add the proper boot option to it:
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>efibootmgr -c -d /dev/sda -p 2 -L "Gentoo" -l "\efi\boot\bootx64.efi" initrd='\initramfs-genkernel-amd64-5.15.52-gentoo'</code></div></div>
<div class="alert alert-info gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-sticky-note-o fa-rotate-180"></i> Note</strong><br />The use of <kbd style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;">\</kbd> as directory separator is mandatory when using UEFI definitions.</div>
<p>With these changes done, when the system reboots, a boot entry called "Gentoo" will be available.
</p>
<h2><span class="mw-headline" id="Alternative_3:_Syslinux">Alternative 3: Syslinux</span></h2>
<p>Syslinux is yet another bootloader alternative for the <b><span style="font-family: monospace; font-size: 95%; color: #54487a">amd64</span></b> architecture. It supports MBR and, as of version 6.00, it supports EFI boot. PXE (network) boot and lesser-known options are also supported. Although Syslinux is a popular bootloader for many it is unsupported by the Handbook. Readers can find information on emerging and then installing this bootloader in the <a href="/wiki/Syslinux" title="Syslinux">Syslinux</a> article.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Rebooting_the_system">Rebooting the system</span></h2>
<p>Exit the chrooted environment and unmount all mounted partitions. Then type in that one magical command that initiates the final, true test: <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">reboot</span>.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>exit</code></div></div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">cdimage ~#</code><span class="tripleclick-separator"></span><code>cd
</code></div><div><code style="color: #ef2929; font-weight: bold;">cdimage ~#</code><span class="tripleclick-separator"></span><code>umount -l /mnt/gentoo/dev{/shm,/pts,}
</code></div><div><code style="color: #ef2929; font-weight: bold;">cdimage ~#</code><span class="tripleclick-separator"></span><code>umount -R /mnt/gentoo
</code></div><div><code style="color: #ef2929; font-weight: bold;">cdimage ~#</code><span class="tripleclick-separator"></span><code>reboot</code></div></div>
<p>Do not forget to remove the bootable CD, otherwise the CD might be booted again instead of the new Gentoo system.
</p><p>Once rebooted in the freshly installed Gentoo environment, finish up with <a href="/wiki/Handbook:AMD64/Installation/Finalizing" title="Handbook:AMD64/Installation/Finalizing">Finalizing the Gentoo installation</a>.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<h2><span class="mw-headline" id="User_administration">User administration</span></h2>
<h3><span class="mw-headline" id="Adding_a_user_for_daily_use">Adding a user for daily use</span></h3>
<p>Working as root on a Unix/Linux system is dangerous and should be avoided as much as possible. Therefore it is strongly recommended to add a user for day-to-day use.
</p><p>The groups the user is member of define what activities the user can perform. The following table lists a number of important groups:
</p>
<table class="table table-condensed table-striped" style="text-align: left; width: auto;">

<tbody><tr style="background-color:#dddaec">
<th scope="col" width="25%">Group
</th>
<th scope="col" width="75%">Description
</th></tr>
<tr>
<td>audio
</td>
<td>Be able to access the audio devices.
</td></tr>
<tr>
<td>cdrom
</td>
<td>Be able to directly access optical devices.
</td></tr>
<tr>
<td>floppy
</td>
<td>Be able to directly access floppy devices.
</td></tr>
<tr>
<td>games
</td>
<td>Be able to play games.
</td></tr>
<tr>
<td>portage
</td>
<td>Be able to access portage restricted resources.
</td></tr>
<tr>
<td>usb
</td>
<td>Be able to access USB devices.
</td></tr>
<tr>
<td>video
</td>
<td>Be able to access video capturing hardware and doing hardware acceleration.
</td></tr>
<tr>
<td>wheel
</td>
<td>Be able to use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">su</span>.
</td></tr></tbody></table>
<p>For instance, to create a user called <a href="/wiki/User:Larry" title="User:Larry">larry</a> who is member of the <i>wheel</i>, <i>users</i>, and <i>audio</i> groups, log in as root first (only root can create users) and run <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">useradd</span>:
</p>
<div class="cmd-box"><div><code style="color: white; font-weight: bold;">Login:</code><span class="tripleclick-separator"></span><code>root</code></div><pre>Password: (Enter the root password)
</pre></div>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>useradd -m -G users,wheel,audio -s /bin/bash larry
</code></div><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>passwd larry</code></div><pre>Password: (Enter the password for larry)
Re-enter password: (Re-enter the password to verify)
</pre></div>
<p>If a user ever needs to perform some task as root, they can use <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">su -</span> to temporarily receive root privileges. Another way is to use the <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator"><a href="/wiki/Sudo" title="Sudo">sudo</a></span> (<a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/sudo">app-admin/sudo</a>) or <span style="font-family: monospace; font-size: 95%; font-weight: bold;" class="tripleclick-separator">doas</span> (<a rel="nofollow" class="external text" href="https://packages.gentoo.org/packages/app-admin/doas">app-admin/doas</a>) utilities which are, if correctly configured, very secure.
</p>
<h2><span class="mw-headline" id="Disk_cleanup">Disk cleanup</span></h2>
<h3><span class="mw-headline" id="Removing_tarballs">Removing tarballs</span></h3>
<p>With the Gentoo installation finished and the system rebooted, if everything has gone well, we can now remove the downloaded stage3 tarball from the hard disk. Remember that they were downloaded to the <span style="font-family: monospace; font-size: 95%">/</span> directory.
</p>
<div class="cmd-box"><div><code style="color: #ef2929; font-weight: bold;">root <span style="color:royalblue;">#</span></code><span class="tripleclick-separator"></span><code>rm /stage3-*.tar.*</code></div></div>
<h2><span class="mw-headline" id="Where_to_go_from_here">Where to go from here</span></h2>
<p>Not sure where to go from here? There are many paths to explore... Gentoo provides its users with lots of possibilities and therefore has lots of documented (and less documented) features to explore here on the wiki and on other Gentoo related sub-domains (see the <a href="#Gentoo_online">Gentoo online</a> section below).
</p>
<h3><span class="mw-headline" id="Additional_documentation">Additional documentation</span></h3>
<p>It is important to note that, due to the number of choices available in Gentoo, the documentation provided by the handbook is limited in scope - it mainly focuses on the basics of getting a Gentoo system up and running and basic system management activities. The handbook intentionally excludes instructions on graphical environments, details on hardening, and other important administrative tasks. That being stated, there are more sections of the handbook to assist readers with more basic functions. 
</p><p>Readers should definitely take a look at the next part of the handbook entitled <a href="/wiki/Handbook:AMD64/Working/Portage" title="Handbook:AMD64/Working/Portage">Working with Gentoo</a> which explains how to keep the software up to date, install additional software packages, details on USE flags, the OpenRC init system, and various other informative topics relating to managing a Gentoo system post-installation.
</p><p>Apart from the handbook, readers should also feel encouraged to explore other corners of the Gentoo wiki to find additional, community-provided documentation. The Gentoo wiki team also offers a <a href="/wiki/Main_Page#Documentation_topics" title="Main Page">documentation topic overview</a> which lists a selection of wiki articles by category. For instance, it refers to the <a href="/wiki/Localization/Guide" title="Localization/Guide">localization guide</a> to make a system feel more at home (particularly useful for users who speak English as a second language).
</p><p>The majority of users with desktop use cases will setup graphical environments in which to work natively. There are many community maintained 'meta' articles for supported <a href="/wiki/Desktop_environment" title="Desktop environment">desktop environments (DEs)</a> and <a href="/wiki/Window_manager" title="Window manager">window managers (WMs)</a>. Readers should be aware that each DE will require slightly different setup steps, which will lengthen add complexity to bootstrapping.
</p><p>Many other <a href="/wiki/Category:Meta" title="Category:Meta">Meta articles</a> exist to provide our readers with high level overviews of available software within Gentoo.
</p>
<h3><span class="mw-headline" id="Gentoo_online">Gentoo online</span></h3>
<div class="alert alert-warning gw-box" style="padding-top: 8px; padding-bottom: 8px;"><strong><i class="fa fa-exclamation-circle"></i> Important</strong><br />Readers should note that all official Gentoo sites online are governed by Gentoo's <a href="/wiki/Project:Council/Code_of_conduct" title="Project:Council/Code of conduct">code of conduct</a>. Being active in the Gentoo community is a privilege, not a right, and users should be aware that the code of conduct exists for a reason.</div>
<p>With the exception of the Libera.Chat hosted internet relay chat (IRC) network and the mailing lists, most Gentoo websites require an account on a per site basis in order to ask questions, open a discussion, or enter a bug.
</p>
<h4><span class="mw-headline" id="Forums_and_IRC">Forums and IRC</span></h4>
<p>Every user is welcome on our <a rel="nofollow" class="external text" href="https://forums.gentoo.org">Gentoo forums</a> or on one of our <a rel="nofollow" class="external text" href="https://www.gentoo.org/get-involved/irc-channels/">internet relay chat channels</a>. It is easy to search for the forums to see if an issue experienced on a fresh Gentoo install has been discovered in the past and resolved after some feedback. The likelihood of other users experiencing the installation issues by first-time Gentoo can be surprising. It is advised users search the forums and the wiki before asking for assistance in Gentoo support channels.
</p>
<h4><span class="mw-headline" id="Mailing_lists">Mailing lists</span></h4>
<p><a rel="nofollow" class="external text" href="https://www.gentoo.org/get-involved/mailing-lists/">Several mailing lists</a> are available to the community members who prefer to ask for support or feedback over email rather than create a user account on the forums or IRC. Users will need to follow the instructions in order to subscribe to specific mailing lists.
</p>
<h4><span class="mw-headline" id="Bugs">Bugs</span></h4>
<p>Sometimes after reviewing the wiki, searching the forums, and seeking support in the IRC channel or mailing lists there is no known solution to a problem. Generally this is a sign to open a bug on Gentoo's <a rel="nofollow" class="external text" href="https://bugs.gentoo.org">Bugzilla site</a>.
</p>
<h4><span class="mw-headline" id="Development_guide">Development guide</span></h4>
<p>Readers who desire to learn more about developing Gentoo can take a look at the <a rel="nofollow" class="external text" href="https://devmanual.gentoo.org/">Development guide</a>. This guide provides instructions on writing ebuilds, working with eclasses, and provides definitions for many <a rel="nofollow" class="external text" href="https://devmanual.gentoo.org/general-concepts/index.html">general concepts</a> behind Gentoo development.
</p>
<h3><span class="mw-headline" id="Closing_thoughts">Closing thoughts</span></h3>
<p>Gentoo is a robust, flexible, and excellently maintained distribution. The developer community is happy to hear feedback on how to make Gentoo an even <i>better</i> distribution.
</p><p>As a reminder, any feedback for <i>this handbook</i> should follow the guidelines detailed in the <a href="/wiki/Handbook:Main_Page#How_do_I_improve_the_Handbook.3F" title="Handbook:Main Page">How do I improve the Handbook?</a> section at the beginning of the handbook.
</p><p>We look forward to seeing how our users will choose to implement Gentoo to fit their unique use cases and needs.
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p><p><br />
</p>
<!-- 
NewPP limit report
Cached time: 20221121062337
Cache expiry: 86400
Dynamic content: false
Complications: []
[SMW] Intext annotation parser time: 0.073 seconds
CPU time usage: 3.407 seconds
Real time usage: 3.558 seconds
Preprocessor visited node count: 32917/1000000
Postexpand include size: 1564574/2097152 bytes
Template argument size: 162573/2097152 bytes
Highest expansion depth: 19/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 20900/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00% 1195.672      1 -total
100.00% 1195.672      1 Handbook:Parts/Full/Installation
 38.30%  457.981    180 Template:RootCmd
 36.27%  433.692    133 Template:Handbook_Variable
 31.66%  378.492    209 Template:GenericCmd
 20.84%  249.165      1 Handbook:AMD64/Installation/Base
 20.62%  246.491      1 Handbook:Parts/Installation/Base
 14.59%  174.460      1 Handbook:AMD64/Installation/Disks
 14.38%  171.997      1 Handbook:Parts/Installation/Disks
 12.79%  152.882      1 Handbook:AMD64/Installation/Bootloader
-->

<!-- Saved in parser cache with key gentoo?hwiki:pcache:idhash:72348-0!dateformat=default and timestamp 20221121062334 and revision id 229552
 -->
</div></div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://wiki.gentoo.org/index.php?title=Handbook:AMD64/Full/Installation&amp;oldid=229552">https://wiki.gentoo.org/index.php?title=Handbook:AMD64/Full/Installation&amp;oldid=229552</a>"</div>
<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>						</div>
					</div>
				</div>
			</div>
		</div>

			<footer>
		<div class="container">
			<div class="row">
				<div class="col-xs-12 col-md-offset-2 col-md-7">
											<div class="spacer"></div>
						<ul id="f-list">
							<li id="lastmod>"> This page was last edited on 4 January 2015, at 15:16.</li><li id="privacy>"><a href="/wiki/Gentoo_Wiki:Privacy_policy" class="mw-redirect" title="Gentoo Wiki:Privacy policy">Privacy policy</a></li><li id="about>"><a href="/wiki/Gentoo_Wiki:About" title="Gentoo Wiki:About">About Gentoo Wiki</a></li><li id="disclaimer>"><a href="/wiki/Gentoo_Wiki:General_disclaimer" title="Gentoo Wiki:General disclaimer">Disclaimers</a></li>						</ul>
									</div>
				<div class="col-xs-12 col-md-3">
					<!-- No questions or comments, the Wiki has enough information on how to contact us. -->
				</div>
			</div>
			<div class="row">
				<div class="col-xs-3 col-md-2">
					<ul class="footerlinks three-icons">
						<li><a href="https://twitter.com/gentoo" title="@Gentoo on Twitter"><span class="fa fa-twitter fa-fw"></span></a></li>
						<li><a href="https://www.facebook.com/gentoo.org" title="Gentoo on Facebook"><span class="fa fa-facebook fa-fw"></span></a></li>
						<li></li>
					</ul>
				</div>
				<div class="col-xs-9 col-md-9">
					<strong>&copy; 2001&ndash;2022 Gentoo Authors</strong><br />
					<small>
						Gentoo is a trademark of the Gentoo Foundation, Inc.
						The contents of this document, unless otherwise expressly stated, are licensed under the
						<a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC-BY-SA-4.0</a> license.
						The <a href="https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html">Gentoo Name and Logo Usage Guidelines</a> apply.
					</small>
				</div>
			</div>
		</div>
	</footer>
	
<script>
function defer(method) {
    if (window.jQuery) {
        method();
    } else {
        setTimeout(function() { defer(method) }, 50);
    }
}
defer(function() { mw.loader.load( 'https://assets.gentoo.org/tyrian/bootstrap.min.js'); });
</script>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"smw":{"limitreport-intext-parsertime":0.073},"limitreport":{"cputime":"3.407","walltime":"3.558","ppvisitednodes":{"value":32917,"limit":1000000},"postexpandincludesize":{"value":1564574,"limit":2097152},"templateargumentsize":{"value":162573,"limit":2097152},"expansiondepth":{"value":19,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":20900,"limit":5000000},"timingprofile":["100.00% 1195.672      1 -total","100.00% 1195.672      1 Handbook:Parts/Full/Installation"," 38.30%  457.981    180 Template:RootCmd"," 36.27%  433.692    133 Template:Handbook_Variable"," 31.66%  378.492    209 Template:GenericCmd"," 20.84%  249.165      1 Handbook:AMD64/Installation/Base"," 20.62%  246.491      1 Handbook:Parts/Installation/Base"," 14.59%  174.460      1 Handbook:AMD64/Installation/Disks"," 14.38%  171.997      1 Handbook:Parts/Installation/Disks"," 12.79%  152.882      1 Handbook:AMD64/Installation/Bootloader"]},"cachereport":{"timestamp":"20221121062337","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":146});});</script></body></html>